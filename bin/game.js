"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(A){let S=0,E=[],R=[];const I={baseUrl:""},P={};function d(A,E,R){let I=null,O={},z=null;"function"==typeof A?O=A:"string"==typeof A?(I=A,"function"==typeof E?O=E:E instanceof Array&&(z=E,O=R)):A instanceof Array&&(z=A,"function"==typeof E&&(O=E)),z=z||["require","exports","module"],null===I&&(I="unnamed-module-"+S++),I=g(I),z=(z||[]).map((A=>function(A,S){return A?b(S,A):S}(I,A))),P[I]||(P[I]={name:I,parent:null,dclamd:1,dependencies:z,handlers:[],exports:{},dependants:new Set}),P[I].dependencies=z,p(z,(function(A){const S=P[I];if(!S)throw new Error("Could not access registered module "+I);let E=S.exports;E="function"==typeof O?O.apply(globalObject,A)||E:O,S.exports=E,u(I)}),(A=>{if("function"!=typeof onerror)throw A;onerror(A)}),I)}function u(A){const S=P[A];if(!S)throw new Error("Could not access registered module "+A);S.dclamd=2;let E=S.handlers;if(E&&E.length)for(let S=0;S<E.length;S++)E[S](P[A])}function c(A,S,E){if(!P[A])return null;if(A==S||50==E)return[A];const R=P[A].dependencies;for(let I=0,P=R.length;I<P;I++){let P=c(R[I],S,E+1);if(null!==P)return P.push(A),P}return null}function a(A,S){let E=P[A];if(!E)return!1;let R={};for(let A in P)R[A]=!1;let I=[];for(I.push(E),R[A]=!0;I.length>0;){let A=I.shift().dependencies;if(A)for(let E=0,O=A.length;E<O;E++){let O=A[E];if(O===S)return!0;let z=P[O];z&&!R[O]&&(R[O]=!0,I.push(z))}}return!1}function p(A,S,E,I){let O=new Array(A.length).fill(null),z=0,k=!1;if("string"==typeof A){if(P[A]){if(1===P[A].dclamd)throw new Error(`Trying to load ${A} from ${I}. The first module is still loading.`);return P[A]}throw new Error(A+" has not been defined. Please include it as a dependency in "+I+"'s define()")}const U=A.length;for(let H=0;H<U;H++)switch(A[H]){case"require":let h=function(A,S,E){return p(A,S,E,I)};h.toUrl=function(A){return b(A,I)},O[H]=h,z++;break;case"exports":if(!P[I])throw new Error("Parent module "+I+" not registered yet");O[H]=P[I].exports,z++;break;case"module":O[H]={id:I,uri:b(I)},z++;break;default:{const V=A[H],m=()=>{O[H]=P[V].exports,z++,z===U&&S&&(k=!0,S(O))};if(a(V,I)){const A=c(V,I,0);A&&(A.reverse(),A.push(V),R.push(A)),w(V,(()=>{}),E,I),m()}else w(V,m,E,I);break}}!k&&z===U&&S&&S(O)}function h(A,S){return function(){return dcl.callRpc(A,S.name,E.slice.call(arguments,0))}}function w(A,S,E,R){if(P[A])return P[A].dependants.add(R),void(1===P[A].dclamd?S&&P[A].handlers.push(S):S&&S(P[A]));if(P[A]={name:A,parent:R,dclamd:1,handlers:[S],dependencies:[],dependants:new Set([R]),exports:{}},0===A.indexOf("@")){let S=P[A].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(A,S).then((E=>{for(let A in E.methods){const R=E.methods[A];S[R.name]=h(E.rpcHandle,R)}u(A)})).catch((A=>{E(A)}))}}function g(A){let S,E=A;for(S=/\/\.\//;S.test(E);)E=E.replace(S,"/");for(E=E.replace(/^\.\//g,""),S=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;S.test(E);)E=E.replace(S,"/");return E=E.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),E=E.replace(/^\//g,""),E}function b(A,S){switch(A){case"require":case"exports":case"module":return A}return S?function(A,S){let E=A;if(!E.startsWith("@")&&(E.startsWith("./")||E.startsWith("../"))){const A=S.split("/");A.pop(),E=g(A.join("/")+"/"+E)}return E}(A,S):g(A)}A.config=function(A){if("object"==typeof A)for(let S in A)A.hasOwnProperty(S)&&(I[S]=A[S])},A.define=d,function(A){A.amd={},A.modules=P}(d=A.define||(A.define={})),A.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const A=new Set,S=[];for(let E in P)P[E]&&(1===P[E].dclamd&&S.push(P[E]),P[E].dependencies.forEach((S=>{"require"!=S&&"exports"!=S&&"module"!=S&&(P[S]||A.add(S))})));const E=[];if(R.length&&E.push(`\n> Cyclic dependencies: ${R.map((A=>"\n  - "+A.join(" -> "))).join("")}`),A.size&&E.push(`\n> Undeclared/unknown modules: ${Array.from(A).map((A=>"\n  - "+A)).join("")}`),S.length&&E.push(`\n> These modules didn't load: ${S.map((A=>"\n  - "+A.name)).join("")}.\n`),E.length)throw new Error(E.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(A){var S=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(A){return A.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(A){return A.firstPersonCameraEntity}},t}(),n=function(A,S){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,S){A.__proto__=S}||function(A,S){for(var E in S)Object.prototype.hasOwnProperty.call(S,E)&&(A[E]=S[E])})(A,S)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function o(A,S){if("function"!=typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function o(){this.constructor=A}n(A,S),A.prototype=null===S?Object.create(S):(o.prototype=S.prototype,new o)}var i=function(){return(i=Object.assign||function(A){for(var S,E=1,R=arguments.length;E<R;E++)for(var I in S=arguments[E])Object.prototype.hasOwnProperty.call(S,I)&&(A[I]=S[I]);return A}).apply(this,arguments)};function r(A,S,E,R){var I,P=arguments.length,O=P<3?S:null===R?R=Object.getOwnPropertyDescriptor(S,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)O=Reflect.decorate(A,S,E,R);else for(var z=A.length-1;z>=0;z--)(I=A[z])&&(O=(P<3?I(O):P>3?I(S,E,O):I(S,E))||O);return P>3&&O&&Object.defineProperty(S,E,O),O}function u(A){var S="function"==typeof Symbol&&Symbol.iterator,E=S&&A[S],R=0;if(E)return E.call(A);if(A&&"number"==typeof A.length)return{next:function(){return A&&R>=A.length&&(A=void 0),{value:A&&A[R++],done:!A}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(A,S){var E="function"==typeof Symbol&&A[Symbol.iterator];if(!E)return A;var R,I,P=E.call(A),O=[];try{for(;(void 0===S||S-- >0)&&!(R=P.next()).done;)O.push(R.value)}catch(A){I={error:A}}finally{try{R&&!R.done&&(E=P.return)&&E.call(P)}finally{if(I)throw I.error}}return O}function h(A,S){for(var E=0,R=S.length,I=A.length;E<R;E++,I++)A[I]=S[E];return A}var E=0;function l(){for(var A=[],S=0;S<arguments.length;S++)A[S]=arguments[S];"undefined"!=typeof dcl?dcl.log.apply(dcl,h([],p(A))):console.log.apply(console,h(["DEBUG:"],p(A)))}function d(A,S){"undefined"!=typeof dcl?dcl.error(A,S):console.error("ERROR:",A,S)}function f(A){if(E++,0===A.length)throw new Error("newId(type: string): type cannot be empty");return A+E.toString(36)}function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(A){var S=16*Math.random()|0;return("x"===A?S:3&S|8).toString(16)}))}function v(A,S){for(var E=[],R=0;R<A;++R)E.push(S());return E}var R=[];function _(A){if(!("__event_name__"in A)||"string"!=typeof A.__event_name__)throw new Error("The EventConstructor is not registered");return A.__event_name__}var I=function(){function t(){this.listeners={}}return t.prototype.addListener=function(A,S,E){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var R=_(A),I=this.listeners[R];I||(I=this.listeners[R]=[]);for(var P=0;P<I.length;P++)if(I[P].listener===S)throw new Error("The provided listener is already registered");return I.push({listener:S,fn:E}),this},t.prototype.removeListener=function(A,S){if(!S||"function"!=typeof S)throw new Error("Invalid EventConstructor");var E=_(S),R=this.listeners[E];if(!R)return!1;for(var I=0;I<R.length;I++)if(R[I].listener===A)return R.splice(I,1),!0;return!1},t.prototype.fireEvent=function(A){var S=_(A.constructor),E=this.listeners[S];if(E)for(var R=0;R<E.length;R++)try{var I=E[R];I.fn.call(I.listener,A)}catch(A){d(A)}return this},t}();function x(){var A=f("EV");if(-1!==R.indexOf(A))throw new Error("The event name "+A+" is already taken");return R.push(A),function(S){return S.__event_name__=A,S}}var P,O=r([x()],(function(A,S,E){this.entity=A,this.componentName=S,this.component=E})),z=r([x()],(function(A,S,E){this.entity=A,this.componentName=S,this.classId=E})),k=r([x()],(function(A,S){this.entity=A,this.parent=S}));A.UIValueType=void 0,(P=A.UIValueType||(A.UIValueType={}))[P.PERCENT=0]="PERCENT",P[P.PIXELS=1]="PIXELS";var U=function(){function e(S){if(this.type=A.UIValueType.PIXELS,"string"==typeof S){var E=S;E.indexOf("px")>-1?this.type=A.UIValueType.PIXELS:E.indexOf("%")>-1&&(this.type=A.UIValueType.PERCENT),this.value=parseFloat(E)}else this.value=S}return e.prototype.toString=function(){var S=this.value.toString();return this.type===A.UIValueType.PERCENT?S+="%":S+="px",S},e}(),H="__name__symbol_",V="__classId__symbol_",G="__component__id_",X=r([x()],(function(A,S,E){this.componentId=A,this.componentName=S,this.classId=E})),Q=r([x()],(function(A){this.componentId=A})),Z=r([x()],(function(A,S){this.componentId=A,this.component=S}));function M(A,S){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+A);var R=E,i=function(){var E=Array.prototype.slice.call(arguments),I=new(R.bind.apply(R,h([void 0],p(E))));return Object.defineProperty(I,H,{enumerable:!1,writable:!1,configurable:!1,value:A}),void 0!==S&&Object.defineProperty(I,V,{enumerable:!1,writable:!1,configurable:!1,value:S}),I};return void 0!==S&&(i.__classId__symbol_=S),i.__name__symbol_=A,i.isComponent=!0,i.originalClassName=A,(i.prototype=E.prototype).constructor=E,i}}function F(A,S){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+A);if("number"!=typeof S||isNaN(S))throw new Error("classId: "+S+" is an invalid integer");var R=E,i=function(){if(!F.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var E=Array.prototype.slice.call(arguments),I=new(R.bind.apply(R,h([void 0],p(E)))),P=f("C");return Object.defineProperty(I,H,{enumerable:!1,writable:!1,configurable:!1,value:A}),Object.defineProperty(I,G,{enumerable:!1,writable:!1,configurable:!1,value:P}),void 0!==S&&Object.defineProperty(I,V,{enumerable:!1,writable:!1,configurable:!1,value:S}),F.engine&&F.engine.registerComponent(I),I};return void 0!==S&&(i.__classId__symbol_=S),i.__name__symbol_=A,i.isComponent=!0,i.isDisposableComponent=!0,i.originalClassName=A,(i.prototype=E.prototype).constructor=E,i}}function L(A){if(!A)throw new TypeError(A+" is not a component.");if(A.__name__symbol_)return A.__name__symbol_;throw new TypeError(A+" is not a registered component.")}function N(A){if(!A)throw new TypeError(A+" is not a component.");if(A.__classId__symbol_)return A.__classId__symbol_;if(!A.__name__symbol_)throw new TypeError(A+" is not a registered component.");return null}function D(A){if(!A)throw new TypeError(A+" is not a component.");if(A.__component__id_)return A.__component__id_;throw new TypeError(A+" is not a registered disposable component.")}!function(A){A.engine=null}(F||(F={}));var K=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(A,S){if(delete A[S]){var E=S+"_"+Math.random();A[E]=void 0,Object.defineProperty(A,E,i(i({},Object.getOwnPropertyDescriptor(A,E)),{enumerable:!1})),Object.defineProperty(A,S.toString(),{get:function(){return this[E]},set:function(A){var R=this[E];if(this.data[S]=A?D(A):null,this[E]=A,A!==R){this.dirty=!0;for(var I=0;I<this.subscriptions.length;I++)this.subscriptions[I](S,A,R)}},enumerable:!0})}},t.field=function(A,S){delete A[S]&&Object.defineProperty(A,S.toString(),{get:function(){return this.data[S]},set:function(A){var E=this.data[S];if(this.data[S]=A,A!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,A,E)}},enumerable:!0})},t.uiValue=function(A,S){delete A[S]&&Object.defineProperty(A,S.toString(),{get:function(){return this.data[S].toString()},set:function(A){var E=this.data[S],R=new U(A);if(this.data[S]=R,R!==E){this.dirty=!0;for(var I=0;I<this.subscriptions.length;I++)this.subscriptions[I](S,R,E)}},enumerable:!0})},t.readonly=function(A,S){delete A[S]&&Object.defineProperty(A,S.toString(),{get:function(){if(S in this.data==0)throw new Error("The field "+S+" is uninitialized");return this.data[S]},set:function(A){if(S in this.data)throw new Error("The field "+S+" is readonly");this.data[S]=A,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(A){return this.subscriptions.push(A),this},t.prototype.toJSON=function(){return this.data},t}();function B(A){return G in A}var J=function(){function t(){for(var A=[],S=0;S<arguments.length;S++)A[S]=arguments[S];if(this.entities=[],this.active=!1,this._requiresNames=[],!A)throw new Error("ComponentGroup: Could not load the requires list");if(!(A instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return A.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(S){var R=A[S],I=null;if(!R)throw new Error("ComponentGroup: the required component at location "+S+" is invalid");try{I=L(R)}catch(A){throw new Error("ComponentGroup: the required component at location "+S+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(E._requiresNames.some((function(A){return A===I})))throw new Error("ComponentGroup: the required component list has a repeated name "+I);E._requiresNames.push(I)},E=this,R=0;R<A.length;R++)n(R)}return t.prototype.hasEntity=function(A){return!!A.isAddedToEngine()&&-1!==this.entities.indexOf(A)},t.prototype.addEntity=function(A){if(!A.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(A)&&this.entities.push(A)},t.prototype.removeEntity=function(A){var S=this.entities.indexOf(A);-1!==S&&this.entities.splice(S,1)},t.prototype.componentRemoved=function(A,S){-1!==this._requiresNames.indexOf(S)&&this.removeEntity(A)},t.prototype.meetsRequirements=function(A){for(var S=0;S<this._requiresNames.length;S++)if(!(this._requiresNames[S]in A.components))return!1;return!0},t}(),$=function(){function t(A){this.name=A,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(A){if("function"==typeof A)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof A)throw new Error("You passed a "+typeof A+", an instance of component is expected");var S=L(A);if(this.components[S]){if(this.components[S]===A)return A;this.removeComponent(this.components[S],!1)}return this.addComponent(A)},t.prototype.hasComponent=function(A){var S=typeof A;if("string"!==S&&"object"!==S&&"function"!==S)throw new Error("Entity#has(component): component is not a class, name or instance");if(null==A)return!1;var E="string"===S?A:L(A),R=this.components[E];return!!R&&("object"===S?R===A:"function"!==S||R instanceof A)},t.prototype.getComponent=function(A){var S=typeof A;if("string"!==S&&"function"!==S)throw new Error("Entity#get(component): component is not a class or name");var E="string"===S?A:L(A),R=this.components[E];if(!R)throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'"');if("function"===S){if(R instanceof A)return R;throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'" (by instance)')}return R},t.prototype.getComponentOrNull=function(A){var S=typeof A;if("string"!==S&&"function"!==S)throw new Error("Entity#getOrNull(component): component is not a class or name");var E="string"===S?A:L(A),R=this.components[E];return R?"function"===S?R instanceof A?R:null:R:null},t.prototype.getComponentOrCreate=function(A){if("function"!=typeof A)throw new Error("Entity#getOrCreate(component): component is not a class");var S=this.getComponentOrNull(A);return S||(L(S=new A),this.addComponentOrReplace(S)),S},t.prototype.addComponent=function(A){if("object"!=typeof A)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var S=L(A),E=N(A);if(this.components[S])throw new Error('A component of type "'+S+'" is already present in entity "'+this.identifier+'"');this.components[S]=A,this.eventManager&&this.eventManager.fireEvent(new z(this,S,E));var R=A;return"function"==typeof R.addedToEntity&&R.addedToEntity(this),A},t.prototype.removeComponent=function(A,S){void 0===S&&(S=!0);var E=typeof A;if("string"!==E&&"function"!==E&&"object"!==E)throw new Error("Entity#remove(component): component is not a class, class or name");var R="string"===E?A:L(A),I=this.components[R];if(I){if("function"===E)return I instanceof A?(delete this.components[R],void(I&&(S&&this.eventManager&&this.eventManager.fireEvent(new O(this,R,I)),"function"==typeof I.removedFromEntity&&I.removedFromEntity(this)))):void l('Entity Warning: Trying to remove wrong (by constructor) component "'+R+'" from entity "'+this.identifier+'"');delete this.components[R],I&&(S&&this.eventManager&&this.eventManager.fireEvent(new O(this,R,I)),"function"==typeof I.removedFromEntity&&I.removedFromEntity(this))}else l('Entity Warning: Trying to remove inexisting component "'+R+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(A){var S;if(A&&"getEntityRepresentation"in A){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");S=A.getEntityRepresentation(this.engine)}else S=!A&&this.engine?this.engine.rootEntity:A;var E=this.getParent();if(S===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(S===E)return this;var R=this.getCircularAncestor(S);if(R)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+R+'")');return E&&delete E.children[this.uuid],null!==S&&"0"!==S.uuid&&(!S.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),S.isAddedToEngine()&&!this.isAddedToEngine()&&S.engine.addEntity(this)),this._parent=S||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new k(this,S)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(A){for(var S=this.engine?this.engine.rootEntity:null,E=A;E&&E!==S;){var R=E.getParent();if(R===this)return E.uuid;E=R}return null},t.prototype.registerAsChild=function(){var A=this.getParent();this.uuid&&A&&(A.children[this.uuid]=this)},t}(),et=function(){function t(A){this.eventManager=new I,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(z,this,this.componentAddedHandler),this.eventManager.addListener(O,this,this.componentRemovedHandler),this.rootEntity=A,this.firstPersonCameraEntity=new $,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new $,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(A){var S=A.getParent();if(A.isAddedToEngine())return A;for(var E in A.eventManager=this.eventManager,A.engine=this,this._entities[A.uuid]=A,this.checkRequirementsAndAdd(A),S?S.isAddedToEngine()||S===this.rootEntity||l("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+S.uuid):A.setParent(this.rootEntity),A.alive=!0,A.children){var R=A.children[E];R&&(R.isAddedToEngine()||this.addEntity(R))}return A},t.prototype.removeEntity=function(A){var S=A.uuid;if(A.isAddedToEngine()){for(var E in A.components){var R=this._componentGroups[E];if(R)for(var I in R)R[I].removeEntity(A);delete this.entityLists[E][S]}for(var P=0;P<this.simpleSystems.length;P++){var O=this.simpleSystems[P];O.onRemoveEntity&&O.onRemoveEntity(A)}for(var P in A.children){var z=A.children[P];z&&this.removeEntity(z)}return A.alive=!1,A.eventManager=null,delete this._entities[S],!0}for(var E in l("Engine: Trying to remove non existent entity from engine."),A.isAddedToEngine()?l("Engine: Entity id: "+S):l('Engine: Entity "'+A.uuid+'" has not been added to any engine yet.'),l("Engine: Entity's components:"),A.components)l(E);return!1},t.prototype.addSystem=function(A,S){if(void 0===S&&(S=0),-1!==this.addedSystems.indexOf(A))return l("Engine: Trying to add a system that is already added. Aborting"),A;if(this.systems.length>0)for(var E=0;E<this.systems.length;E++){var R=this.systems[E],I=E===this.systems.length-1;if(R.priority>S){this.addedSystems.push(A),this.systems.splice(E,0,{system:A,priority:S});break}if(I){this.addedSystems.push(A),this.systems.splice(E+1,0,{system:A,priority:S});break}}else this.addedSystems.push(A),this.systems.splice(1,0,{system:A,priority:S});return this.registerSystem(A),A},t.prototype.removeSystem=function(A){var S=this.addedSystems.indexOf(A);if(-1!==S){A.active=!1,A.deactivate&&A.deactivate(),this.addedSystems.splice(S,1);for(var E=0;E<this.systems.length;E++)this.systems[E].system===A&&this.systems.splice(E,1);return!0}return!1},t.prototype.update=function(A){for(var S in this.systems){var E=this.systems[S].system;if(E.active&&E.update)try{E.update(A)}catch(A){d(A)}}return this},t.prototype.getEntitiesWithComponent=function(A){var S="string"==typeof A?A:L(A);return S in this.entityLists?this.entityLists[S]:this.entityLists[S]={}},t.prototype.registerComponent=function(A){var S=D(A),E=L(A),R=N(A);this._disposableComponents[S]=A,null!==R&&(this.eventManager.fireEvent(new X(S,E,R)),this.eventManager.fireEvent(new Z(S,A)))},t.prototype.disposeComponent=function(A){var S=D(A);return delete this._disposableComponents[S]&&(this.eventManager.fireEvent(new Q(S)),A.onDispose&&A.onDispose(),!0)},t.prototype.updateComponent=function(A){this.eventManager.fireEvent(new Z(D(A),A))},t.prototype.getComponentGroup=function(){for(var A=[],S=0;S<arguments.length;S++)A[S]=arguments[S];var E=void 0;if(A.length>0&&(k=this._componentGroups[L(A[0])]))for(var R=A.slice(),I=0;I<k.length;I++){var P=k[I];if(R.length===P.requires.length){for(var O=0;O<R.length&&-1!==P.requires.indexOf(R[O]);O++)O===R.length-1&&(E=P);if(E)break}}if(E)return E;(E=new(J.bind.apply(J,h([void 0],p(A))))).active=!0;var z=E.requiresNames;for(I=0;I<z.length;I++){var k,U=z[I];(k=this._componentGroups[U])||(this._componentGroups[U]=k=[]),-1===k.indexOf(E)&&k.push(E)}for(var H in this._entities)this.checkRequirements(this._entities[H],E);return E},t.prototype.removeComponentGroup=function(A){if(A.active){A.active=!1;for(var S=A.requiresNames,E=0;E<S.length;E++){var R=S[E],I=this._componentGroups[R];if(I){var P=I.indexOf(A);-1!==P&&I.splice(P,1)}}return!0}return!1},t.prototype.registerSystem=function(A){A.active=!0,A.activate&&A.activate(this),this.simpleSystems.push(A)},t.prototype.checkRequirementsAndAdd=function(A){if(A.isAddedToEngine()){for(var S in A.components){S in this.entityLists||(this.entityLists[S]={}),this.entityLists[S][A.uuid]=A;var E=this._componentGroups[S];if(E)for(var R in E)this.checkRequirements(A,E[R])}for(var I=0;I<this.simpleSystems.length;I++){var P=this.simpleSystems[I];P.onAddEntity&&P.onAddEntity(A)}}},t.prototype.checkRequirements=function(A,S){S.meetsRequirements(A)?S.hasEntity(A)||S.addEntity(A):S.hasEntity(A)&&S.removeEntity(A)},t.prototype.componentAddedHandler=function(A){var S,E=A.entity,R=A.componentName;if(E.isAddedToEngine()){this.entityLists[R]?this.entityLists[R][E.uuid]=E:this.entityLists[R]=((S={})[E.uuid]=E,S);var I=this._componentGroups[R];if(I)for(var P in I)this.checkRequirements(E,I[P])}},t.prototype.componentRemovedHandler=function(A){var S=A.entity,E=A.componentName;if(S.isAddedToEngine()){delete this.entityLists[E][S.uuid];var R=this._componentGroups[E];if(R)for(var I in R)this.checkRequirements(S,R[I])}},t}(),nt=Promise.resolve().then.bind(Promise.resolve());function W(A){var S=nt(A);return S.isComplete=!1,S.then((function(A){S.isComplete=!0,S.result=A,S.didFail=!1})).catch((function(A){S.isComplete=!0,S.error=A,S.didFail=!0,d("executeTask: FAILED "+A.toString(),A)})),S}var it,ot,rt=function(){function t(A,S,E,R){void 0===S&&(S=!1),this.initalize(A,S,E,R)}return t.prototype.initalize=function(A,S,E,R){return void 0===S&&(S=!1),this.mask=A,this.skipNextObservers=S,this.target=E,this.currentTarget=R,this},t}(),Y=function(A,S,E){void 0===E&&(E=null),this.callback=A,this.mask=S,this.scope=E,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},st=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(A,S,E,R){var I,P;void 0===E&&(E=-1),void 0===R&&(R=null);var O=new t;O._observers=new Array,O._observables=A;try{for(var z=u(A),k=z.next();!k.done;k=z.next()){var U=k.value.add(S,E,!1,R);U&&O._observers.push(U)}}catch(A){I={error:A}}finally{try{k&&!k.done&&(P=z.return)&&P.call(z)}finally{if(I)throw I.error}}return O},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var A=0;A<this._observers.length;A++)this._observables[A].remove(this._observers[A]);this._observers=null,this._observables=null},t}(),at=function(){function t(A){this._observers=new Array,this._onObserverAdded=null,this._eventState=new rt(0),A&&(this._onObserverAdded=A)}return t.prototype.add=function(A,S,E,R,I){if(void 0===S&&(S=-1),void 0===E&&(E=!1),void 0===R&&(R=null),void 0===I&&(I=!1),!A)return null;var P=new Y(A,S,R);return P.unregisterOnNextCall=I,E?this._observers.unshift(P):this._observers.push(P),this._onObserverAdded&&this._onObserverAdded(P),P},t.prototype.addOnce=function(A){return this.add(A,void 0,void 0,void 0,!0)},t.prototype.remove=function(A){return!!A&&-1!==this._observers.indexOf(A)&&(this._deferUnregister(A),!0)},t.prototype.removeCallback=function(A,S){for(var E=0;E<this._observers.length;E++)if(this._observers[E].callback===A&&(!S||S===this._observers[E].scope))return this._deferUnregister(this._observers[E]),!0;return!1},t.prototype.notifyObservers=function(A,S,E,R){var I,P;if(void 0===S&&(S=-1),!this._observers.length)return!0;var O=this._eventState;O.mask=S,O.target=E,O.currentTarget=R,O.skipNextObservers=!1,O.lastReturnValue=A;try{for(var z=u(this._observers),k=z.next();!k.done;k=z.next()){var U=k.value;if(!U._willBeUnregistered&&(U.mask&S&&(U.scope?O.lastReturnValue=U.callback.apply(U.scope,[A,O]):O.lastReturnValue=U.callback(A,O),U.unregisterOnNextCall&&this._deferUnregister(U)),O.skipNextObservers))return!1}}catch(A){I={error:A}}finally{try{k&&!k.done&&(P=z.return)&&P.call(z)}finally{if(I)throw I.error}}return!0},t.prototype.notifyObserversWithPromise=function(A,S,E,R){var I=this;void 0===S&&(S=-1);var P=Promise.resolve(A);if(!this._observers.length)return P;var O=this._eventState;return O.mask=S,O.target=E,O.currentTarget=R,O.skipNextObservers=!1,this._observers.forEach((function(E){O.skipNextObservers||E._willBeUnregistered||E.mask&S&&(P=E.scope?P.then((function(S){return O.lastReturnValue=S,E.callback.apply(E.scope,[A,O])})):P.then((function(S){return O.lastReturnValue=S,E.callback(A,O)})),E.unregisterOnNextCall&&I._deferUnregister(E))})),P.then((function(){return A}))},t.prototype.notifyObserver=function(A,S,E){void 0===E&&(E=-1);var R=this._eventState;R.mask=E,R.skipNextObservers=!1,A.callback(S,R)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var A=new t;return A._observers=this._observers.slice(0),A},t.prototype.hasSpecificMask=function(A){var S,E;void 0===A&&(A=-1);try{for(var R=u(this._observers),I=R.next();!I.done;I=R.next()){var P=I.value;if(P.mask&A||P.mask===A)return!0}}catch(A){S={error:A}}finally{try{I&&!I.done&&(E=R.return)&&E.call(R)}finally{if(S)throw S.error}}return!1},t.prototype._deferUnregister=function(A){var S=this;A.unregisterOnNextCall=!1,A._willBeUnregistered=!0,W((function(){return function(A,S,E,R){return new(E||(E=Promise))((function(S,I){function s(A){try{u(R.next(A))}catch(A){I(A)}}function a(A){try{u(R.throw(A))}catch(A){I(A)}}function u(A){var R;A.done?S(A.value):(R=A.value,R instanceof E?R:new E((function(A){A(R)}))).then(s,a)}u((R=R.apply(A,[])).next())}))}(S,0,void 0,(function(){return function(A,S){var E,R,I,P,O={label:0,sent:function(){if(1&I[0])throw I[1];return I[1]},trys:[],ops:[]};return P={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(P[Symbol.iterator]=function(){return this}),P;function a(P){return function(z){return function(P){if(E)throw new TypeError("Generator is already executing.");for(;O;)try{if(E=1,R&&(I=2&P[0]?R.return:P[0]?R.throw||((I=R.return)&&I.call(R),0):R.next)&&!(I=I.call(R,P[1])).done)return I;switch(R=0,I&&(P=[2&P[0],I.value]),P[0]){case 0:case 1:I=P;break;case 4:return O.label++,{value:P[1],done:!1};case 5:O.label++,R=P[1],P=[0];continue;case 7:P=O.ops.pop(),O.trys.pop();continue;default:if(!((I=(I=O.trys).length>0&&I[I.length-1])||6!==P[0]&&2!==P[0])){O=0;continue}if(3===P[0]&&(!I||P[1]>I[0]&&P[1]<I[3])){O.label=P[1];break}if(6===P[0]&&O.label<I[1]){O.label=I[1],I=P;break}if(I&&O.label<I[2]){O.label=I[2],O.ops.push(P);break}I[2]&&O.ops.pop(),O.trys.pop();continue}P=S.call(A,O)}catch(A){P=[6,A],R=0}finally{E=I=0}if(5&P[0])throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}([P,z])}}}(this,(function(S){return[2,this._remove(A)]}))}))}))},t.prototype._remove=function(A){if(!A)return!1;var S=this._observers.indexOf(A);return-1!==S&&(this._observers.splice(S,1),!0)},t}(),ut=r([x()],(function(A,S){this.uuid=A,this.payload=S})),ht=r([x()],(function(A){this.payload=A})),pt=r([x()],(function(A){this.payload=A}));function tt(A){return function(){ot&&ot.subscribe(A)}}var lt=new at(tt("cameraModeChanged")),ct=new at(tt("idleStateChanged")),dt=new at(tt("onEnterScene")),ft=dt,gt=new at(tt("onLeaveScene")),mt=gt,vt=new at(tt("sceneStart")),bt=new at(tt("playerExpression")),xt=new at(tt("onPointerLock")),Tt=new at(tt("videoEvent")),wt=new at(tt("profileChanged")),_t=new at(tt("playerConnected")),Ct=new at(tt("playerDisconnected")),At=new at(tt("onRealmChanged"));function yt(A){(ot=A)&&ot.onEvent((function(A){switch(A.type){case"onEnterScene":return void dt.notifyObservers(A.data);case"onLeaveScene":return void gt.notifyObservers(A.data);case"cameraModeChanged":return void lt.notifyObservers(A.data);case"idleStateChanged":return void ct.notifyObservers(A.data);case"sceneStart":return void vt.notifyObservers(A.data);case"playerExpression":return void bt.notifyObservers(A.data);case"videoEvent":var S=A.data,E=F.engine.disposableComponents[S.componentId];return E&&E.update(S),void Tt.notifyObservers(S);case"profileChanged":return void wt.notifyObservers(A.data);case"onPointerLock":return void xt.notifyObservers(A.data);case"playerConnected":return void _t.notifyObservers(A.data);case"playerDisconnected":return void Ct.notifyObservers(A.data);case"onRealmChanged":return void At.notifyObservers(A.data)}}))}var St,Et,Rt=function(){function t(A){this.dcl=A,this.cachedComponents={}}return t.prototype.activate=function(A){var S=this;this.engine=A,A.eventManager.addListener(z,this,this.componentAdded),A.eventManager.addListener(O,this,this.componentRemoved),A.eventManager.addListener(X,this,this.disposableComponentCreated),A.eventManager.addListener(Q,this,this.disposableComponentRemoved),A.eventManager.addListener(Z,this,this.disposableComponentUpdated),A.eventManager.addListener(k,this,this.parentChanged);var E=A.rootEntity.uuid;this.dcl.addEntity(E),this.dcl.onUpdate((function(E){A.update(E),S.presentEntities()})),this.dcl.onEvent((function(S){var E=S.data;switch(S.type){case"uuidEvent":A.eventManager.fireEvent(new ut(E.uuid,E.payload));break;case"raycastResponse":("HitFirst"===E.queryType||"HitAll"===E.queryType)&&A.eventManager.fireEvent(new ht(E));break;case"actionButtonEvent":A.eventManager.fireEvent(new pt(E.payload))}}))},t.prototype.onAddEntity=function(A){if(A&&A.isAddedToEngine()){var S=A.uuid,E=A.getParent();for(var R in this.dcl.addEntity(S),E&&this.dcl.setParent(S,E.uuid),this.cachedComponents[S]={},A.components){var I=A.components[R],P=N(I);if(null!==P)if(B(I))this.dcl.attachEntityComponent(A.uuid,R,D(I));else{var O=JSON.stringify(I);this.dcl.updateEntityComponent(S,R,P,O),this.cachedComponents[S][R]=O}}}},t.prototype.onRemoveEntity=function(A){if(A.isAddedToEngine()){var S=A.uuid;this.dcl.removeEntity(S),delete this.cachedComponents[S]}},t.prototype.presentEntities=function(){for(var A in this.engine.entities){var S=this.engine.entities[A];for(var E in S.components){var R=N(O=S.components[E]);if(null!==R&&!B(O)){var I=this.getJsonIfDirty(S.uuid,E,O);I&&(this.dcl.updateEntityComponent(S.uuid,E,R,I),this.clearDirty(S.uuid,E,O,I))}}}for(var P in this.engine.disposableComponents){var O;(O=this.engine.disposableComponents[P])instanceof K&&O.dirty&&(this.dcl.componentUpdated(P,JSON.stringify(O)),O.dirty=!1)}},t.prototype.componentAdded=function(A){if(A.entity.isAddedToEngine()){var S=A.entity.components[A.componentName];if(B(S))this.dcl.attachEntityComponent(A.entity.uuid,A.componentName,D(S));else if(null!==A.classId){var E=JSON.stringify(S);this.dcl.updateEntityComponent(A.entity.uuid,A.componentName,A.classId,E),this.cachedComponents[A.entity.uuid][A.componentName]=E}}},t.prototype.componentRemoved=function(A){A.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(A.entity.uuid,A.componentName),delete this.cachedComponents[A.entity.uuid][A.componentName])},t.prototype.disposableComponentCreated=function(A){this.dcl.componentCreated(A.componentId,A.componentName,A.classId)},t.prototype.disposableComponentRemoved=function(A){this.dcl.componentDisposed(A.componentId)},t.prototype.disposableComponentUpdated=function(A){this.dcl.componentUpdated(A.componentId,JSON.stringify(A.component))},t.prototype.parentChanged=function(A){this.dcl.setParent(A.entity.uuid,A.parent?A.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(A,S,E){var R=JSON.stringify(E);return R!==this.cachedComponents[A][S]&&R},t.prototype.clearDirty=function(A,S,E,R){this.cachedComponents[A][S]=R},t}();A.Orientation=void 0,(St=A.Orientation||(A.Orientation={}))[St.CW=0]="CW",St[St.CCW=1]="CCW",A.Space=void 0,(Et=A.Space||(A.Space={}))[Et.LOCAL=0]="LOCAL",Et[Et.WORLD=1]="WORLD",Et[Et.BONE=2]="BONE";var It,Pt,Ot,zt,Dt=1/2.2,Lt=2.2,Mt=1e-6,Nt=Math.PI/180,kt=360/(2*Math.PI),Bt=function(){function t(){}return t.WithinEpsilon=function(A,S,E){void 0===E&&(E=1401298e-51);var R=A-S;return-E<=R&&R<=E},t.ToHex=function(A){var S=A.toString(16);return A<=15?("0"+S).toUpperCase():S.toUpperCase()},t.Sign=function(A){var S=+A;return 0===S||isNaN(S)?S:S>0?1:-1},t.Clamp=function(A,S,E){return void 0===S&&(S=0),void 0===E&&(E=1),Math.min(E,Math.max(S,A))},t.Log2=function(A){return Math.log(A)*Math.LOG2E},t.Repeat=function(A,S){return A-Math.floor(A/S)*S},t.Normalize=function(A,S,E){return(A-S)/(E-S)},t.Denormalize=function(A,S,E){return A*(E-S)+S},t.DeltaAngle=function(A,S){var E=t.Repeat(S-A,360);return E>180&&(E-=360),E},t.PingPong=function(A,S){var E=t.Repeat(A,2*S);return S-Math.abs(E-S)},t.SmoothStep=function(A,S,E){var R=t.Clamp(E);return S*(R=-2*R*R*R+3*R*R)+A*(1-R)},t.MoveTowards=function(A,S,E){return Math.abs(S-A)<=E?S:A+t.Sign(S-A)*E},t.MoveTowardsAngle=function(A,S,E){var R=t.DeltaAngle(A,S);return-E<R&&R<E?S:t.MoveTowards(A,A+R,E)},t.Lerp=function(A,S,E){return A+(S-A)*E},t.LerpAngle=function(A,S,E){var R=t.Repeat(S-A,360);return R>180&&(R-=360),A+R*t.Clamp(E)},t.InverseLerp=function(A,S,E){return A!==S?t.Clamp((E-A)/(S-A)):0},t.Hermite=function(A,S,E,R,I){var P=I*I,O=I*P;return A*(2*O-3*P+1)+E*(-2*O+3*P)+S*(O-2*P+I)+R*(O-P)},t.RandomRange=function(A,S){return A===S?A:Math.random()*(S-A)+A},t.RangeToPercent=function(A,S,E){return(A-S)/(E-S)},t.PercentToRange=function(A,S,E){return(E-S)*A+S},t.NormalizeRadians=function(A){return A-t.TwoPi*Math.floor((A+Math.PI)/t.TwoPi)},t.TwoPi=2*Math.PI,t}(),Ut=function(){function t(A,S,E,R){this.x=A,this.y=S,this.z=E,this.w=R}return t.Add=function(A,S){return new t(A.x,A.y,A.z,A.w).addInPlace(S)},t.FromArray=function(A,S){return void 0===S&&(S=0),new t(A[S],A[S+1],A[S+2],A[S+3])},t.FromArrayToRef=function(A,S,E){E.x=A[S],E.y=A[S+1],E.z=A[S+2],E.w=A[S+3]},t.FromFloatArrayToRef=function(A,S,E){t.FromArrayToRef(A,S,E)},t.FromFloatsToRef=function(A,S,E,R,I){I.x=A,I.y=S,I.z=E,I.w=R},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(A){var S=t.Zero();return t.NormalizeToRef(A,S),S},t.NormalizeToRef=function(A,S){S.copyFrom(A),S.normalize()},t.Minimize=function(A,S){var E=new t(A.x,A.y,A.z,A.w);return E.minimizeInPlace(S),E},t.Maximize=function(A,S){var E=new t(A.x,A.y,A.z,A.w);return E.maximizeInPlace(S),E},t.Distance=function(A,S){return Math.sqrt(t.DistanceSquared(A,S))},t.DistanceSquared=function(A,S){var E=A.x-S.x,R=A.y-S.y,I=A.z-S.z,P=A.w-S.w;return E*E+R*R+I*I+P*P},t.Center=function(A,S){var E=t.Add(A,S);return E.scaleInPlace(.5),E},t.TransformNormal=function(A,S){var E=t.Zero();return t.TransformNormalToRef(A,S,E),E},t.TransformNormalToRef=function(A,S,E){var R=S.m,I=A.x*R[0]+A.y*R[4]+A.z*R[8],P=A.x*R[1]+A.y*R[5]+A.z*R[9],O=A.x*R[2]+A.y*R[6]+A.z*R[10];E.x=I,E.y=P,E.z=O,E.w=A.w},t.TransformNormalFromFloatsToRef=function(A,S,E,R,I,P){var O=I.m;P.x=A*O[0]+S*O[4]+E*O[8],P.y=A*O[1]+S*O[5]+E*O[9],P.z=A*O[2]+S*O[6]+E*O[10],P.w=R},t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var A=this.x||0;return 397*(A=397*(A=397*A^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.toArray=function(A,S){return void 0===S&&(S=0),A[S]=this.x,A[S+1]=this.y,A[S+2]=this.z,A[S+3]=this.w,this},t.prototype.addInPlace=function(A){return this.x+=A.x,this.y+=A.y,this.z+=A.z,this.w+=A.w,this},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y,this.z+A.z,this.w+A.w)},t.prototype.addToRef=function(A,S){return S.x=this.x+A.x,S.y=this.y+A.y,S.z=this.z+A.z,S.w=this.w+A.w,this},t.prototype.subtractInPlace=function(A){return this.x-=A.x,this.y-=A.y,this.z-=A.z,this.w-=A.w,this},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y,this.z-A.z,this.w-A.w)},t.prototype.subtractToRef=function(A,S){return S.x=this.x-A.x,S.y=this.y-A.y,S.z=this.z-A.z,S.w=this.w-A.w,this},t.prototype.subtractFromFloats=function(A,S,E,R){return new t(this.x-A,this.y-S,this.z-E,this.w-R)},t.prototype.subtractFromFloatsToRef=function(A,S,E,R,I){return I.x=this.x-A,I.y=this.y-S,I.z=this.z-E,I.w=this.w-R,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},t.prototype.scale=function(A){return new t(this.x*A,this.y*A,this.z*A,this.w*A)},t.prototype.scaleToRef=function(A,S){return S.x=this.x*A,S.y=this.y*A,S.z=this.z*A,S.w=this.w*A,this},t.prototype.scaleAndAddToRef=function(A,S){return S.x+=this.x*A,S.y+=this.y*A,S.z+=this.z*A,S.w+=this.w*A,this},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y&&this.z===A.z&&this.w===A.w},t.prototype.equalsWithEpsilon=function(A,S){return void 0===S&&(S=Mt),A&&Bt.WithinEpsilon(this.x,A.x,S)&&Bt.WithinEpsilon(this.y,A.y,S)&&Bt.WithinEpsilon(this.z,A.z,S)&&Bt.WithinEpsilon(this.w,A.w,S)},t.prototype.equalsToFloats=function(A,S,E,R){return this.x===A&&this.y===S&&this.z===E&&this.w===R},t.prototype.multiplyInPlace=function(A){return this.x*=A.x,this.y*=A.y,this.z*=A.z,this.w*=A.w,this},t.prototype.multiply=function(A){return new t(this.x*A.x,this.y*A.y,this.z*A.z,this.w*A.w)},t.prototype.multiplyToRef=function(A,S){return S.x=this.x*A.x,S.y=this.y*A.y,S.z=this.z*A.z,S.w=this.w*A.w,this},t.prototype.multiplyByFloats=function(A,S,E,R){return new t(this.x*A,this.y*S,this.z*E,this.w*R)},t.prototype.divide=function(A){return new t(this.x/A.x,this.y/A.y,this.z/A.z,this.w/A.w)},t.prototype.divideToRef=function(A,S){return S.x=this.x/A.x,S.y=this.y/A.y,S.z=this.z/A.z,S.w=this.w/A.w,this},t.prototype.divideInPlace=function(A){return this.divideToRef(A,this)},t.prototype.minimizeInPlace=function(A){return A.x<this.x&&(this.x=A.x),A.y<this.y&&(this.y=A.y),A.z<this.z&&(this.z=A.z),A.w<this.w&&(this.w=A.w),this},t.prototype.maximizeInPlace=function(A){return A.x>this.x&&(this.x=A.x),A.y>this.y&&(this.y=A.y),A.z>this.z&&(this.z=A.z),A.w>this.w&&(this.w=A.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var A=this.length();return 0===A?this:this.scaleInPlace(1/A)},t.prototype.toVector3=function(){return new Vt(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this.w=A.w,this},t.prototype.copyFromFloats=function(A,S,E,R){return this.x=A,this.y=S,this.z=E,this.w=R,this},t.prototype.set=function(A,S,E,R){return this.copyFromFloats(A,S,E,R)},t.prototype.setAll=function(A){return this.x=this.y=this.z=this.w=A,this},t}(),Wt=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}return Object.defineProperty(t.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!1,configurable:!0}),t.FromArray=function(A,S){void 0===S&&(S=0);var E=new t;return t.FromArrayToRef(A,S,E),E},t.FromArrayToRef=function(A,S,E){for(var R=0;R<16;R++)E._m[R]=A[R+S];E._markAsUpdated()},t.FromFloatArrayToRefScaled=function(A,S,E,R){for(var I=0;I<16;I++)R._m[I]=A[I+S]*E;R._markAsUpdated()},t.FromValuesToRef=function(A,S,E,R,I,P,O,z,k,U,H,V,G,X,Q,Z,K){var J=K._m;J[0]=A,J[1]=S,J[2]=E,J[3]=R,J[4]=I,J[5]=P,J[6]=O,J[7]=z,J[8]=k,J[9]=U,J[10]=H,J[11]=V,J[12]=G,J[13]=X,J[14]=Q,J[15]=Z,K._markAsUpdated()},t.FromValues=function(A,S,E,R,I,P,O,z,k,U,H,V,G,X,Q,Z){var K=new t,J=K._m;return J[0]=A,J[1]=S,J[2]=E,J[3]=R,J[4]=I,J[5]=P,J[6]=O,J[7]=z,J[8]=k,J[9]=U,J[10]=H,J[11]=V,J[12]=G,J[13]=X,J[14]=Q,J[15]=Z,K._markAsUpdated(),K},t.Compose=function(A,S,E){var R=new t;return t.ComposeToRef(A,S,E,R),R},t.ComposeToRef=function(A,S,E,R){t.ScalingToRef(A.x,A.y,A.z,Gt.Matrix[1]),S.toRotationMatrix(Gt.Matrix[0]),Gt.Matrix[1].multiplyToRef(Gt.Matrix[0],R),R.setTranslation(E)},t.Identity=function(){var A=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return A._updateIdentityStatus(!0),A},t.IdentityToRef=function(A){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(!0)},t.Zero=function(){var A=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return A._updateIdentityStatus(!1),A},t.RotationX=function(A){var S=new t;return t.RotationXToRef(A,S),S},t.Invert=function(A){var S=new t;return A.invertToRef(S),S},t.RotationXToRef=function(A,S){var E=Math.sin(A),R=Math.cos(A);t.FromValuesToRef(1,0,0,0,0,R,E,0,0,-E,R,0,0,0,0,1,S),S._updateIdentityStatus(1===R&&0===E)},t.RotationY=function(A){var S=new t;return t.RotationYToRef(A,S),S},t.RotationYToRef=function(A,S){var E=Math.sin(A),R=Math.cos(A);t.FromValuesToRef(R,0,-E,0,0,1,0,0,E,0,R,0,0,0,0,1,S),S._updateIdentityStatus(1===R&&0===E)},t.RotationZ=function(A){var S=new t;return t.RotationZToRef(A,S),S},t.RotationZToRef=function(A,S){var E=Math.sin(A),R=Math.cos(A);t.FromValuesToRef(R,E,0,0,-E,R,0,0,0,0,1,0,0,0,0,1,S),S._updateIdentityStatus(1===R&&0===E)},t.RotationAxis=function(A,S){var E=new t;return t.RotationAxisToRef(A,S,E),E},t.RotationAxisToRef=function(A,S,E){var R=Math.sin(-S),I=Math.cos(-S),P=1-I;A.normalize();var O=E._m;O[0]=A.x*A.x*P+I,O[1]=A.x*A.y*P-A.z*R,O[2]=A.x*A.z*P+A.y*R,O[3]=0,O[4]=A.y*A.x*P+A.z*R,O[5]=A.y*A.y*P+I,O[6]=A.y*A.z*P-A.x*R,O[7]=0,O[8]=A.z*A.x*P-A.y*R,O[9]=A.z*A.y*P+A.x*R,O[10]=A.z*A.z*P+I,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,E._markAsUpdated()},t.RotationYawPitchRoll=function(A,S,E){var R=new t;return t.RotationYawPitchRollToRef(A,S,E,R),R},t.RotationYawPitchRollToRef=function(A,S,E,R){Ht.RotationYawPitchRollToRef(A,S,E,Gt.Quaternion[0]),Gt.Quaternion[0].toRotationMatrix(R)},t.Scaling=function(A,S,E){var R=new t;return t.ScalingToRef(A,S,E,R),R},t.ScalingToRef=function(A,S,E,R){t.FromValuesToRef(A,0,0,0,0,S,0,0,0,0,E,0,0,0,0,1,R),R._updateIdentityStatus(1===A&&1===S&&1===E)},t.Translation=function(A,S,E){var R=new t;return t.TranslationToRef(A,S,E,R),R},t.TranslationToRef=function(A,S,E,R){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,A,S,E,1,R),R._updateIdentityStatus(0===A&&0===S&&0===E)},t.Lerp=function(A,S,E){var R=new t;return t.LerpToRef(A,S,E,R),R},t.LerpToRef=function(A,S,E,R){for(var I=0;I<16;I++)R._m[I]=A._m[I]*(1-E)+S._m[I]*E;R._markAsUpdated()},t.DecomposeLerp=function(A,S,E){var R=new t;return t.DecomposeLerpToRef(A,S,E,R),R},t.DecomposeLerpToRef=function(A,S,E,R){var I=Gt.Vector3[0],P=Gt.Quaternion[0],O=Gt.Vector3[1];A.decompose(I,P,O);var z=Gt.Vector3[2],k=Gt.Quaternion[1],U=Gt.Vector3[3];S.decompose(z,k,U);var H=Gt.Vector3[4];Vt.LerpToRef(I,z,E,H);var V=Gt.Quaternion[2];Ht.SlerpToRef(P,k,E,V);var G=Gt.Vector3[5];Vt.LerpToRef(O,U,E,G),t.ComposeToRef(H,V,G,R)},t.LookAtLH=function(A,S,E){var R=new t;return t.LookAtLHToRef(A,S,E,R),R},t.LookAtLHToRef=function(A,S,E,R){var I=Gt.Vector3[0],P=Gt.Vector3[1],O=Gt.Vector3[2];S.subtractToRef(A,O),O.normalize(),Vt.CrossToRef(E,O,I);var z=I.lengthSquared();0===z?I.x=1:I.normalizeFromLength(Math.sqrt(z)),Vt.CrossToRef(O,I,P),P.normalize();var k=-Vt.Dot(I,A),U=-Vt.Dot(P,A),H=-Vt.Dot(O,A);t.FromValuesToRef(I.x,P.x,O.x,0,I.y,P.y,O.y,0,I.z,P.z,O.z,0,k,U,H,1,R)},t.LookAtRH=function(A,S,E){var R=new t;return t.LookAtRHToRef(A,S,E,R),R},t.LookAtRHToRef=function(A,S,E,R){var I=Gt.Vector3[0],P=Gt.Vector3[1],O=Gt.Vector3[2];A.subtractToRef(S,O),O.normalize(),Vt.CrossToRef(E,O,I);var z=I.lengthSquared();0===z?I.x=1:I.normalizeFromLength(Math.sqrt(z)),Vt.CrossToRef(O,I,P),P.normalize();var k=-Vt.Dot(I,A),U=-Vt.Dot(P,A),H=-Vt.Dot(O,A);t.FromValuesToRef(I.x,P.x,O.x,0,I.y,P.y,O.y,0,I.z,P.z,O.z,0,k,U,H,1,R)},t.OrthoLH=function(A,S,E,R){var I=new t;return t.OrthoLHToRef(A,S,E,R,I),I},t.OrthoLHToRef=function(A,S,E,R,I){var P=2/A,O=2/S,z=2/(R-E),k=-(R+E)/(R-E);t.FromValuesToRef(P,0,0,0,0,O,0,0,0,0,z,0,0,0,k,1,I),I._updateIdentityStatus(1===P&&1===O&&1===z&&0===k)},t.OrthoOffCenterLH=function(A,S,E,R,I,P){var O=new t;return t.OrthoOffCenterLHToRef(A,S,E,R,I,P,O),O},t.OrthoOffCenterLHToRef=function(A,S,E,R,I,P,O){var z=2/(S-A),k=2/(R-E),U=2/(P-I),H=-(P+I)/(P-I),V=(A+S)/(A-S),G=(R+E)/(E-R);t.FromValuesToRef(z,0,0,0,0,k,0,0,0,0,U,0,V,G,H,1,O),O._markAsUpdated()},t.OrthoOffCenterRH=function(A,S,E,R,I,P){var O=new t;return t.OrthoOffCenterRHToRef(A,S,E,R,I,P,O),O},t.OrthoOffCenterRHToRef=function(A,S,E,R,I,P,O){t.OrthoOffCenterLHToRef(A,S,E,R,I,P,O),O._m[10]*=-1},t.PerspectiveLH=function(A,S,E,R){var I=new t,P=2*E/A,O=2*E/S,z=(R+E)/(R-E),k=-2*R*E/(R-E);return t.FromValuesToRef(P,0,0,0,0,O,0,0,0,0,z,1,0,0,k,0,I),I._updateIdentityStatus(!1),I},t.PerspectiveFovLH=function(A,S,E,R){var I=new t;return t.PerspectiveFovLHToRef(A,S,E,R,I),I},t.PerspectiveFovLHToRef=function(A,S,E,R,I,P){void 0===P&&(P=!0);var O=E,z=R,k=1/Math.tan(.5*A),U=P?k/S:k,H=P?k:k*S,V=(z+O)/(z-O),G=-2*z*O/(z-O);t.FromValuesToRef(U,0,0,0,0,H,0,0,0,0,V,1,0,0,G,0,I),I._updateIdentityStatus(!1)},t.PerspectiveFovRH=function(A,S,E,R){var I=new t;return t.PerspectiveFovRHToRef(A,S,E,R,I),I},t.PerspectiveFovRHToRef=function(A,S,E,R,I,P){void 0===P&&(P=!0);var O=E,z=R,k=1/Math.tan(.5*A),U=P?k/S:k,H=P?k:k*S,V=-(z+O)/(z-O),G=-2*z*O/(z-O);t.FromValuesToRef(U,0,0,0,0,H,0,0,0,0,V,-1,0,0,G,0,I),I._updateIdentityStatus(!1)},t.PerspectiveFovWebVRToRef=function(A,S,E,R,I){void 0===I&&(I=!1);var P=I?-1:1,O=Math.tan(A.upDegrees*Math.PI/180),z=Math.tan(A.downDegrees*Math.PI/180),k=Math.tan(A.leftDegrees*Math.PI/180),U=Math.tan(A.rightDegrees*Math.PI/180),H=2/(k+U),V=2/(O+z),G=R._m;G[0]=H,G[1]=G[2]=G[3]=G[4]=0,G[5]=V,G[6]=G[7]=0,G[8]=(k-U)*H*.5,G[9]=-(O-z)*V*.5,G[10]=-E/(S-E),G[11]=1*P,G[12]=G[13]=G[15]=0,G[14]=-2*E*S/(E-S),R._markAsUpdated()},t.GetAsMatrix2x2=function(A){return[A._m[0],A._m[1],A._m[4],A._m[5]]},t.GetAsMatrix3x3=function(A){return[A._m[0],A._m[1],A._m[2],A._m[4],A._m[5],A._m[6],A._m[8],A._m[9],A._m[10]]},t.Transpose=function(A){var S=new t;return t.TransposeToRef(A,S),S},t.TransposeToRef=function(A,S){var E=S._m,R=A._m;E[0]=R[0],E[1]=R[4],E[2]=R[8],E[3]=R[12],E[4]=R[1],E[5]=R[5],E[6]=R[9],E[7]=R[13],E[8]=R[2],E[9]=R[6],E[10]=R[10],E[11]=R[14],E[12]=R[3],E[13]=R[7],E[14]=R[11],E[15]=R[15],S._updateIdentityStatus(A._isIdentity,A._isIdentityDirty)},t.Reflection=function(A){var S=new t;return t.ReflectionToRef(A,S),S},t.ReflectionToRef=function(A,S){A.normalize();var E=A.normal.x,R=A.normal.y,I=A.normal.z,P=-2*E,O=-2*R,z=-2*I;t.FromValuesToRef(P*E+1,O*E,z*E,0,P*R,O*R+1,z*R,0,P*I,O*I,z*I+1,0,P*A.d,O*A.d,z*A.d,1,S)},t.FromXYZAxesToRef=function(A,S,E,R){t.FromValuesToRef(A.x,A.y,A.z,0,S.x,S.y,S.z,0,E.x,E.y,E.z,0,0,0,0,1,R)},t.FromQuaternionToRef=function(A,S){var E=A.x*A.x,R=A.y*A.y,I=A.z*A.z,P=A.x*A.y,O=A.z*A.w,z=A.z*A.x,k=A.y*A.w,U=A.y*A.z,H=A.x*A.w;S._m[0]=1-2*(R+I),S._m[1]=2*(P+O),S._m[2]=2*(z-k),S._m[3]=0,S._m[4]=2*(P-O),S._m[5]=1-2*(I+E),S._m[6]=2*(U+H),S._m[7]=0,S._m[8]=2*(z+k),S._m[9]=2*(U-H),S._m[10]=1-2*(R+E),S._m[11]=0,S._m[12]=0,S._m[13]=0,S._m[14]=0,S._m[15]=1,S._markAsUpdated()},t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},t.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var A=this._m;this._isIdentity=1===A[0]&&0===A[1]&&0===A[2]&&0===A[3]&&0===A[4]&&1===A[5]&&0===A[6]&&0===A[7]&&0===A[8]&&0===A[9]&&1===A[10]&&0===A[11]&&0===A[12]&&0===A[13]&&0===A[14]&&1===A[15]}return this._isIdentity},t.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},t.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var A=this._m,S=A[0],E=A[1],R=A[2],I=A[3],P=A[4],O=A[5],z=A[6],k=A[7],U=A[8],H=A[9],V=A[10],G=A[11],X=A[12],Q=A[13],Z=A[14],K=A[15],J=V*K-Z*G,$=H*K-Q*G,et=H*Z-Q*V,nt=U*K-X*G,it=U*Z-V*X,ot=U*Q-X*H;return S*+(O*J-z*$+k*et)+E*-(P*J-z*nt+k*it)+R*+(P*$-O*nt+k*ot)+I*-(P*et-O*it+z*ot)},t.prototype.toArray=function(){return this._m},t.prototype.asArray=function(){return this._m},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},t.prototype.add=function(A){var S=new t;return this.addToRef(A,S),S},t.prototype.addToRef=function(A,S){for(var E=0;E<16;E++)S._m[E]=this._m[E]+A._m[E];return S._markAsUpdated(),this},t.prototype.addToSelf=function(A){for(var S=0;S<16;S++)this._m[S]+=A._m[S];return this._markAsUpdated(),this},t.prototype.invertToRef=function(A){if(!0===this._isIdentity)return t.IdentityToRef(A),this;var S=this._m,E=S[0],R=S[1],I=S[2],P=S[3],O=S[4],z=S[5],k=S[6],U=S[7],H=S[8],V=S[9],G=S[10],X=S[11],Q=S[12],Z=S[13],K=S[14],J=S[15],$=G*J-K*X,et=V*J-Z*X,nt=V*K-Z*G,it=H*J-Q*X,ot=H*K-G*Q,rt=H*Z-Q*V,st=+(z*$-k*et+U*nt),at=-(O*$-k*it+U*ot),ut=+(O*et-z*it+U*rt),ht=-(O*nt-z*ot+k*rt),pt=E*st+R*at+I*ut+P*ht;if(0===pt)return A.copyFrom(this),this;var lt=1/pt,ct=k*J-K*U,dt=z*J-Z*U,ft=z*K-Z*k,gt=O*J-Q*U,mt=O*K-Q*k,vt=O*Z-Q*z,bt=k*X-G*U,xt=z*X-V*U,Tt=z*G-V*k,wt=O*X-H*U,_t=O*G-H*k,Ct=O*V-H*z,At=-(R*$-I*et+P*nt),St=+(E*$-I*it+P*ot),Et=-(E*et-R*it+P*rt),Rt=+(E*nt-R*ot+I*rt),It=+(R*ct-I*dt+P*ft),Pt=-(E*ct-I*gt+P*mt),Ot=+(E*dt-R*gt+P*vt),zt=-(E*ft-R*mt+I*vt),Dt=-(R*bt-I*xt+P*Tt),Lt=+(E*bt-I*wt+P*_t),Mt=-(E*xt-R*wt+P*Ct),Nt=+(E*Tt-R*_t+I*Ct);return t.FromValuesToRef(st*lt,At*lt,It*lt,Dt*lt,at*lt,St*lt,Pt*lt,Lt*lt,ut*lt,Et*lt,Ot*lt,Mt*lt,ht*lt,Rt*lt,zt*lt,Nt*lt,A),this},t.prototype.addAtIndex=function(A,S){return this._m[A]+=S,this._markAsUpdated(),this},t.prototype.multiplyAtIndex=function(A,S){return this._m[A]*=S,this._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(A,S,E){return this._m[12]=A,this._m[13]=S,this._m[14]=E,this._markAsUpdated(),this},t.prototype.setTranslation=function(A){return this.setTranslationFromFloats(A.x,A.y,A.z)},t.prototype.getTranslation=function(){return new Vt(this._m[12],this._m[13],this._m[14])},t.prototype.getTranslationToRef=function(A){return A.x=this._m[12],A.y=this._m[13],A.z=this._m[14],this},t.prototype.removeRotationAndScaling=function(){var A=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,A[12],A[13],A[14],A[15],this),this._updateIdentityStatus(0===A[12]&&0===A[13]&&0===A[14]&&1===A[15]),this},t.prototype.multiply=function(A){var S=new t;return this.multiplyToRef(A,S),S},t.prototype.copyFrom=function(A){A.copyToArray(this._m);var S=A;return this._updateIdentityStatus(S._isIdentity,S._isIdentityDirty,S._isIdentity3x2,S._isIdentity3x2Dirty),this},t.prototype.copyToArray=function(A,S){void 0===S&&(S=0);for(var E=0;E<16;E++)A[S+E]=this._m[E];return this},t.prototype.multiplyToRef=function(A,S){return this._isIdentity?(S.copyFrom(A),this):A._isIdentity?(S.copyFrom(this),this):(this.multiplyToArray(A,S._m,0),S._markAsUpdated(),this)},t.prototype.multiplyToArray=function(A,S,E){var R=this._m,I=A.m,P=R[0],O=R[1],z=R[2],k=R[3],U=R[4],H=R[5],V=R[6],G=R[7],X=R[8],Q=R[9],Z=R[10],K=R[11],J=R[12],$=R[13],et=R[14],nt=R[15],it=I[0],ot=I[1],rt=I[2],st=I[3],at=I[4],ut=I[5],ht=I[6],pt=I[7],lt=I[8],ct=I[9],dt=I[10],ft=I[11],gt=I[12],mt=I[13],vt=I[14],bt=I[15];return S[E]=P*it+O*at+z*lt+k*gt,S[E+1]=P*ot+O*ut+z*ct+k*mt,S[E+2]=P*rt+O*ht+z*dt+k*vt,S[E+3]=P*st+O*pt+z*ft+k*bt,S[E+4]=U*it+H*at+V*lt+G*gt,S[E+5]=U*ot+H*ut+V*ct+G*mt,S[E+6]=U*rt+H*ht+V*dt+G*vt,S[E+7]=U*st+H*pt+V*ft+G*bt,S[E+8]=X*it+Q*at+Z*lt+K*gt,S[E+9]=X*ot+Q*ut+Z*ct+K*mt,S[E+10]=X*rt+Q*ht+Z*dt+K*vt,S[E+11]=X*st+Q*pt+Z*ft+K*bt,S[E+12]=J*it+$*at+et*lt+nt*gt,S[E+13]=J*ot+$*ut+et*ct+nt*mt,S[E+14]=J*rt+$*ht+et*dt+nt*vt,S[E+15]=J*st+$*pt+et*ft+nt*bt,this},t.prototype.equals=function(A){var S=A;if(!S)return!1;if((this._isIdentity||S._isIdentity)&&!this._isIdentityDirty&&!S._isIdentityDirty)return this._isIdentity&&S._isIdentity;var E=this.m,R=S.m;return E[0]===R[0]&&E[1]===R[1]&&E[2]===R[2]&&E[3]===R[3]&&E[4]===R[4]&&E[5]===R[5]&&E[6]===R[6]&&E[7]===R[7]&&E[8]===R[8]&&E[9]===R[9]&&E[10]===R[10]&&E[11]===R[11]&&E[12]===R[12]&&E[13]===R[13]&&E[14]===R[14]&&E[15]===R[15]},t.prototype.clone=function(){var A=new t;return A.copyFrom(this),A},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var A=this._m[0]||0,S=1;S<16;S++)A=397*A^(this._m[S]||0);return A},t.prototype.decompose=function(A,S,E){if(this._isIdentity)return E&&E.setAll(0),A&&A.setAll(1),S&&S.copyFromFloats(0,0,0,1),!0;var R=this._m;E&&E.copyFromFloats(R[12],R[13],R[14]);var I=A||Gt.Vector3[0];if(I.x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),I.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),I.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),this.determinant()<=0&&(I.y*=-1),0===I.x||0===I.y||0===I.z)return S&&S.copyFromFloats(0,0,0,1),!1;if(S){var P=1/I.x,O=1/I.y,z=1/I.z;t.FromValuesToRef(R[0]*P,R[1]*P,R[2]*P,0,R[4]*O,R[5]*O,R[6]*O,0,R[8]*z,R[9]*z,R[10]*z,0,0,0,0,1,Gt.Matrix[0]),Ht.FromRotationMatrixToRef(Gt.Matrix[0],S)}return!0},t.prototype.getRow=function(A){if(A<0||A>3)return null;var S=4*A;return new Ut(this._m[S+0],this._m[S+1],this._m[S+2],this._m[S+3])},t.prototype.setRow=function(A,S){return this.setRowFromFloats(A,S.x,S.y,S.z,S.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(A){return t.TransposeToRef(this,A),this},t.prototype.setRowFromFloats=function(A,S,E,R,I){if(A<0||A>3)return this;var P=4*A;return this._m[P+0]=S,this._m[P+1]=E,this._m[P+2]=R,this._m[P+3]=I,this._markAsUpdated(),this},t.prototype.scale=function(A){var S=new t;return this.scaleToRef(A,S),S},t.prototype.scaleToRef=function(A,S){for(var E=0;E<16;E++)S._m[E]=this._m[E]*A;return S._markAsUpdated(),this},t.prototype.scaleAndAddToRef=function(A,S){for(var E=0;E<16;E++)S._m[E]+=this._m[E]*A;return S._markAsUpdated(),this},t.prototype.toNormalMatrix=function(A){var S=Gt.Matrix[0];this.invertToRef(S),S.transposeToRef(A);var E=A._m;t.FromValuesToRef(E[0],E[1],E[2],0,E[4],E[5],E[6],0,E[8],E[9],E[10],0,0,0,0,1,A)},t.prototype.getRotationMatrix=function(){var A=new t;return this.getRotationMatrixToRef(A),A},t.prototype.getRotationMatrixToRef=function(A){var S=Gt.Vector3[0];if(!this.decompose(S))return t.IdentityToRef(A),this;var E=this._m,R=1/S.x,I=1/S.y,P=1/S.z;return t.FromValuesToRef(E[0]*R,E[1]*R,E[2]*R,0,E[4]*I,E[5]*I,E[6]*I,0,E[8]*P,E[9]*P,E[10]*P,0,0,0,0,1,A),this},t.prototype.toggleModelMatrixHandInPlace=function(){var A=this._m;A[2]*=-1,A[6]*=-1,A[8]*=-1,A[9]*=-1,A[14]*=-1,this._markAsUpdated()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var A=this._m;A[8]*=-1,A[9]*=-1,A[10]*=-1,A[11]*=-1,this._markAsUpdated()},t.prototype._updateIdentityStatus=function(A,S,E,R){void 0===S&&(S=!1),void 0===E&&(E=!1),void 0===R&&(R=!0),this.updateFlag=t._updateFlagSeed++,this._isIdentity=A,this._isIdentity3x2=A||E,this._isIdentityDirty=!this._isIdentity&&S,this._isIdentity3x2Dirty=!this._isIdentity3x2&&R},t._updateFlagSeed=0,t._identityReadOnly=t.Identity(),t}(),Ht=function(){function t(A,S,E,R){void 0===A&&(A=0),void 0===S&&(S=0),void 0===E&&(E=0),void 0===R&&(R=1),this.x=A,this.y=S,this.z=E,this.w=R}return t.FromRotationMatrix=function(A){var S=new t;return t.FromRotationMatrixToRef(A,S),S},t.FromRotationMatrixToRef=function(A,S){var E,R=A.m,I=R[0],P=R[4],O=R[8],z=R[1],k=R[5],U=R[9],H=R[2],V=R[6],G=R[10],X=I+k+G;X>0?(E=.5/Math.sqrt(X+1),S.w=.25/E,S.x=(V-U)*E,S.y=(O-H)*E,S.z=(z-P)*E):I>k&&I>G?(E=2*Math.sqrt(1+I-k-G),S.w=(V-U)/E,S.x=.25*E,S.y=(P+z)/E,S.z=(O+H)/E):k>G?(E=2*Math.sqrt(1+k-I-G),S.w=(O-H)/E,S.x=(P+z)/E,S.y=.25*E,S.z=(U+V)/E):(E=2*Math.sqrt(1+G-I-k),S.w=(z-P)/E,S.x=(O+H)/E,S.y=(U+V)/E,S.z=.25*E)},t.Dot=function(A,S){return A.x*S.x+A.y*S.y+A.z*S.z+A.w*S.w},t.AreClose=function(A,S){return t.Dot(A,S)>=0},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(A){return new t(-A.x,-A.y,-A.z,A.w)},t.IsIdentity=function(A){return A&&0===A.x&&0===A.y&&0===A.z&&1===A.w},t.RotationAxis=function(A,S){var E=S*Nt;return t.RotationAxisToRef(A,E,new t)},t.RotationAxisToRef=function(A,S,E){var R=S*Nt,I=Math.sin(R/2);return A.normalize(),E.w=Math.cos(R/2),E.x=A.x*I,E.y=A.y*I,E.z=A.z*I,E},t.FromArray=function(A,S){return void 0===S&&(S=0),new t(A[S],A[S+1],A[S+2],A[S+3])},t.FromEulerAnglesRef=function(A,S,E,R){return t.RotationYawPitchRollToRef(S*Nt,A*Nt,E*Nt,R)},t.RotationYawPitchRoll=function(A,S,E){var R=new t;return t.RotationYawPitchRollToRef(A,S,E,R),R},t.RotationYawPitchRollToRef=function(A,S,E,R){var I=.5*S,P=.5*A,O=.5*E,z=Math.cos(I),k=Math.cos(P),U=Math.cos(O),H=Math.sin(I),V=Math.sin(P),G=Math.sin(O);R.x=k*H*U+V*z*G,R.y=V*z*U-k*H*G,R.z=k*z*G-V*H*U,R.w=k*z*U+V*H*G},t.RotationAlphaBetaGamma=function(A,S,E){var R=new t;return t.RotationAlphaBetaGammaToRef(A,S,E,R),R},t.RotationAlphaBetaGammaToRef=function(A,S,E,R){var I=.5*(E+A),P=.5*(E-A),O=.5*S;R.x=Math.cos(P)*Math.sin(O),R.y=Math.sin(P)*Math.sin(O),R.z=Math.sin(I)*Math.cos(O),R.w=Math.cos(I)*Math.cos(O)},t.RotationQuaternionFromAxis=function(A,S,E){var R=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(A,S,E,R),R},t.RotationQuaternionFromAxisToRef=function(A,S,E,R){var I=Gt.Matrix[0];Wt.FromXYZAxesToRef(A.normalize(),S.normalize(),E.normalize(),I),t.FromRotationMatrixToRef(I,R)},t.Slerp=function(A,S,E){var R=t.Identity;return t.SlerpToRef(A,S,E,R),R},t.SlerpToRef=function(A,S,E,R){var I,P,O=A.x*S.x+A.y*S.y+A.z*S.z+A.w*S.w,z=!1;if(O<0&&(z=!0,O=-O),O>.999999)P=1-E,I=z?-E:E;else{var k=Math.acos(O),U=1/Math.sin(k);P=Math.sin((1-E)*k)*U,I=z?-Math.sin(E*k)*U:Math.sin(E*k)*U}R.x=P*A.x+I*S.x,R.y=P*A.y+I*S.y,R.z=P*A.z+I*S.z,R.w=P*A.w+I*S.w},t.Hermite=function(A,S,E,R,I){var P=I*I,O=I*P,z=2*O-3*P+1,k=-2*O+3*P,U=O-2*P+I,H=O-P;return new t(A.x*z+E.x*k+S.x*U+R.x*H,A.y*z+E.y*k+S.y*U+R.y*H,A.z*z+E.z*k+S.z*U+R.z*H,A.w*z+E.w*k+S.w*U+R.w*H)},Object.defineProperty(t,"Identity",{get:function(){return new t(0,0,0,1)},enumerable:!1,configurable:!0}),t.Angle=function(A,S){var E=t.Dot(A,S);return 2*Math.acos(Math.min(Math.abs(E),1))*kt},t.Euler=function(A,S,E){return t.RotationYawPitchRoll(S*Nt,A*Nt,E*Nt)},t.LookRotation=function(A,S){void 0===S&&(S=Gt.staticUp);var E=Vt.Normalize(A),R=Vt.Normalize(Vt.Cross(S,E)),I=Vt.Cross(E,R),P=R.x,O=R.y,z=R.z,k=I.x,U=I.y,H=I.z,V=E.x,G=E.y,X=E.z,Q=P+U+X,Z=new t;if(Q>0){var K=Math.sqrt(Q+1);return Z.w=.5*K,K=.5/K,Z.x=(H-G)*K,Z.y=(V-z)*K,Z.z=(O-k)*K,Z}if(P>=U&&P>=X){var J=Math.sqrt(1+P-U-X),$=.5/J;return Z.x=.5*J,Z.y=(O+k)*$,Z.z=(z+V)*$,Z.w=(H-G)*$,Z}if(U>X){var et=Math.sqrt(1+U-P-X),nt=.5/et;return Z.x=(k+O)*nt,Z.y=.5*et,Z.z=(G+H)*nt,Z.w=(V-z)*nt,Z}var it=Math.sqrt(1+X-P-U),ot=.5/it;return Z.x=(V+z)*ot,Z.y=(G+H)*ot,Z.z=.5*it,Z.w=(O-k)*ot,Z},t.RotateTowards=function(A,S,E){var R=t.Angle(A,S);if(0===R)return S;var I=Math.min(1,E/R);return t.Slerp(A,S,I)},t.FromToRotation=function(A,S,E){void 0===E&&(E=Gt.staticUp);var R=A.normalize(),I=S.normalize(),P=Vt.Cross(R,I),O=Math.sqrt(R.lengthSquared()*I.lengthSquared())+Vt.Dot(R,I);return P.lengthSquared()<1e-4?Math.abs(O)<1e-4?new t(E.x,E.y,E.z,0).normalized:t.Identity:new t(P.x,P.y,P.z,O).normalized},Object.defineProperty(t.prototype,"normalized",{get:function(){return this.normalize()},enumerable:!1,configurable:!0}),t.prototype.setFromToRotation=function(A,S,E){void 0===E&&(E=Gt.staticUp);var R=t.FromToRotation(A,S,E);this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w},Object.defineProperty(t.prototype,"eulerAngles",{get:function(){var A=new Vt,S=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,E=this.x*this.w-this.y*this.z;return E>.4995*S?(A.x=Math.PI/2,A.y=2*Math.atan2(this.y,this.x),A.z=0):E<-.4995*S?(A.x=-Math.PI/2,A.y=-2*Math.atan2(this.y,this.x),A.z=0):(A.x=Math.asin(2*(this.w*this.x-this.y*this.z)),A.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),A.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),A.x*=kt,A.y*=kt,A.z*=kt,A.x=Bt.Repeat(A.x,360),A.y=Bt.Repeat(A.y,360),A.z=Bt.Repeat(A.z,360),A},set:function(A){this.setEuler(A.x,A.y,A.z)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var A=this.x||0;return 397*(A=397*(A=397*A^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y&&this.z===A.z&&this.w===A.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this.w=A.w,this},t.prototype.copyFromFloats=function(A,S,E,R){return this.x=A,this.y=S,this.z=E,this.w=R,this},t.prototype.set=function(A,S,E,R){return this.copyFromFloats(A,S,E,R)},t.prototype.setEuler=function(A,S,E){return t.RotationYawPitchRollToRef(S*Nt,A*Nt,E*Nt,this),this},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y,this.z+A.z,this.w+A.w)},t.prototype.addInPlace=function(A){return this.x+=A.x,this.y+=A.y,this.z+=A.z,this.w+=A.w,this},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y,this.z-A.z,this.w-A.w)},t.prototype.scale=function(A){return new t(this.x*A,this.y*A,this.z*A,this.w*A)},t.prototype.scaleToRef=function(A,S){return S.x=this.x*A,S.y=this.y*A,S.z=this.z*A,S.w=this.w*A,this},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},t.prototype.scaleAndAddToRef=function(A,S){return S.x+=this.x*A,S.y+=this.y*A,S.z+=this.z*A,S.w+=this.w*A,this},t.prototype.multiply=function(A){var S=new t(0,0,0,1);return this.multiplyToRef(A,S),S},t.prototype.multiplyToRef=function(A,S){var E=this.x*A.w+this.y*A.z-this.z*A.y+this.w*A.x,R=-this.x*A.z+this.y*A.w+this.z*A.x+this.w*A.y,I=this.x*A.y-this.y*A.x+this.z*A.w+this.w*A.z,P=-this.x*A.x-this.y*A.y-this.z*A.z+this.w*A.w;return S.copyFromFloats(E,R,I,P),this},t.prototype.multiplyInPlace=function(A){return this.multiplyToRef(A,this),this},t.prototype.conjugateToRef=function(A){return A.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){return new t(-this.x,-this.y,-this.z,this.w)},t.prototype.normalize=function(){var A=1/this.length;return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},t.prototype.angleAxis=function(A,S){if(0===S.lengthSquared())return t.Identity;var E=t.Identity,R=A*Nt;R*=.5;var I=S.normalize();return I=S.scaleInPlace(Math.sin(R)),E.x=I.x,E.y=I.y,E.z=I.z,E.w=Math.cos(R),E.normalize()},t.prototype.toRotationMatrix=function(A){return Wt.FromQuaternionToRef(this,A),this},t.prototype.fromRotationMatrix=function(A){return t.FromRotationMatrixToRef(A,this),this},t}(),Vt=function(){function t(A,S,E){void 0===A&&(A=0),void 0===S&&(S=0),void 0===E&&(E=0),this.x=A,this.y=S,this.z=E}return Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var A=Math.abs(this.x),S=Math.abs(this.y);if(A!==S)return!0;var E=Math.abs(this.z);return A!==E||S!==E},enumerable:!1,configurable:!0}),t.Add=function(A,S){return new t(A.x,A.y,A.z).addInPlace(S)},t.GetClipFactor=function(A,S,E,R){var I=t.Dot(A,E)-R;return I/(I-(t.Dot(S,E)-R))},t.GetAngleBetweenVectors=function(A,S,E){var R=A.normalizeToRef(Gt.Vector3[1]),I=S.normalizeToRef(Gt.Vector3[2]),P=t.Dot(R,I),O=Gt.Vector3[3];return t.CrossToRef(R,I,O),t.Dot(O,E)>0?Math.acos(P):-Math.acos(P)},t.FromArray=function(A,S){return void 0===S&&(S=0),new t(A[S],A[S+1],A[S+2])},t.FromFloatArray=function(A,S){return t.FromArray(A,S)},t.FromArrayToRef=function(A,S,E){E.x=A[S],E.y=A[S+1],E.z=A[S+2]},t.FromFloatArrayToRef=function(A,S,E){return t.FromArrayToRef(A,S,E)},t.FromFloatsToRef=function(A,S,E,R){R.copyFromFloats(A,S,E)},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},t.Down=function(){return new t(0,-1,0)},t.Forward=function(){return new t(0,0,1)},t.Backward=function(){return new t(0,0,-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(A,S){var E=t.Zero();return t.TransformCoordinatesToRef(A,S,E),E},t.TransformCoordinatesToRef=function(A,S,E){return t.TransformCoordinatesFromFloatsToRef(A.x,A.y,A.z,S,E)},t.TransformCoordinatesFromFloatsToRef=function(A,S,E,R,I){var P=R.m,O=A*P[0]+S*P[4]+E*P[8]+P[12],z=A*P[1]+S*P[5]+E*P[9]+P[13],k=A*P[2]+S*P[6]+E*P[10]+P[14],U=1/(A*P[3]+S*P[7]+E*P[11]+P[15]);I.x=O*U,I.y=z*U,I.z=k*U},t.TransformNormal=function(A,S){var E=t.Zero();return t.TransformNormalToRef(A,S,E),E},t.TransformNormalToRef=function(A,S,E){this.TransformNormalFromFloatsToRef(A.x,A.y,A.z,S,E)},t.TransformNormalFromFloatsToRef=function(A,S,E,R,I){var P=R.m;I.x=A*P[0]+S*P[4]+E*P[8],I.y=A*P[1]+S*P[5]+E*P[9],I.z=A*P[2]+S*P[6]+E*P[10]},t.CatmullRom=function(A,S,E,R,I){var P=I*I,O=I*P;return new t(.5*(2*S.x+(-A.x+E.x)*I+(2*A.x-5*S.x+4*E.x-R.x)*P+(-A.x+3*S.x-3*E.x+R.x)*O),.5*(2*S.y+(-A.y+E.y)*I+(2*A.y-5*S.y+4*E.y-R.y)*P+(-A.y+3*S.y-3*E.y+R.y)*O),.5*(2*S.z+(-A.z+E.z)*I+(2*A.z-5*S.z+4*E.z-R.z)*P+(-A.z+3*S.z-3*E.z+R.z)*O))},t.Clamp=function(A,S,E){var R=new t;return t.ClampToRef(A,S,E,R),R},t.ClampToRef=function(A,S,E,R){var I=A.x;I=(I=I>E.x?E.x:I)<S.x?S.x:I;var P=A.y;P=(P=P>E.y?E.y:P)<S.y?S.y:P;var O=A.z;O=(O=O>E.z?E.z:O)<S.z?S.z:O,R.copyFromFloats(I,P,O)},t.Hermite=function(A,S,E,R,I){var P=I*I,O=I*P,z=2*O-3*P+1,k=-2*O+3*P,U=O-2*P+I,H=O-P;return new t(A.x*z+E.x*k+S.x*U+R.x*H,A.y*z+E.y*k+S.y*U+R.y*H,A.z*z+E.z*k+S.z*U+R.z*H)},t.Lerp=function(A,S,E){var R=new t(0,0,0);return t.LerpToRef(A,S,E,R),R},t.LerpToRef=function(A,S,E,R){R.x=A.x+(S.x-A.x)*E,R.y=A.y+(S.y-A.y)*E,R.z=A.z+(S.z-A.z)*E},t.Dot=function(A,S){return A.x*S.x+A.y*S.y+A.z*S.z},t.Cross=function(A,S){var E=t.Zero();return t.CrossToRef(A,S,E),E},t.CrossToRef=function(A,S,E){var R=A.y*S.z-A.z*S.y,I=A.z*S.x-A.x*S.z,P=A.x*S.y-A.y*S.x;E.copyFromFloats(R,I,P)},t.Normalize=function(A){var S=t.Zero();return t.NormalizeToRef(A,S),S},t.NormalizeToRef=function(A,S){A.normalizeToRef(S)},t.Minimize=function(A,S){var E=new t(A.x,A.y,A.z);return E.minimizeInPlace(S),E},t.Maximize=function(A,S){var E=new t(A.x,A.y,A.z);return E.maximizeInPlace(S),E},t.Distance=function(A,S){return Math.sqrt(t.DistanceSquared(A,S))},t.DistanceSquared=function(A,S){var E=A.x-S.x,R=A.y-S.y,I=A.z-S.z;return E*E+R*R+I*I},t.Center=function(A,S){var E=t.Add(A,S);return E.scaleInPlace(.5),E},t.RotationFromAxis=function(A,S,E){var R=t.Zero();return t.RotationFromAxisToRef(A,S,E,R),R},t.RotationFromAxisToRef=function(A,S,E,R){var I=Gt.Quaternion[0];Ht.RotationQuaternionFromAxisToRef(A,S,E,I),R.copyFrom(I.eulerAngles)},t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var A=this.x||0;return 397*(A=397*A^(this.y||0))^(this.z||0)},t.prototype.asArray=function(){var A=[];return this.toArray(A,0),A},t.prototype.toArray=function(A,S){return void 0===S&&(S=0),A[S]=this.x,A[S+1]=this.y,A[S+2]=this.z,this},t.prototype.toQuaternion=function(){return Ht.Identity.setEuler(this.y,this.x,this.z)},t.prototype.addInPlace=function(A){return this.addInPlaceFromFloats(A.x,A.y,A.z)},t.prototype.addInPlaceFromFloats=function(A,S,E){return this.x+=A,this.y+=S,this.z+=E,this},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y,this.z+A.z)},t.prototype.addToRef=function(A,S){return S.copyFromFloats(this.x+A.x,this.y+A.y,this.z+A.z)},t.prototype.subtractInPlace=function(A){return this.x-=A.x,this.y-=A.y,this.z-=A.z,this},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y,this.z-A.z)},t.prototype.subtractToRef=function(A,S){return this.subtractFromFloatsToRef(A.x,A.y,A.z,S)},t.prototype.subtractFromFloats=function(A,S,E){return new t(this.x-A,this.y-S,this.z-E)},t.prototype.subtractFromFloatsToRef=function(A,S,E,R){return R.copyFromFloats(this.x-A,this.y-S,this.z-E)},t.prototype.applyMatrix4=function(A){this.applyMatrix4ToRef(A,this)},t.prototype.applyMatrix4ToRef=function(A,S){var E=this,R=E.x,I=E.y,P=E.z,O=A.m,z=1/(O[3]*R+O[7]*I+O[11]*P+O[15]);return S.x=(O[0]*R+O[4]*I+O[8]*P+O[12])*z,S.y=(O[1]*R+O[5]*I+O[9]*P+O[13])*z,S.z=(O[2]*R+O[6]*I+O[10]*P+O[14])*z,S},t.prototype.rotate=function(A){return this.rotateToRef(A,this)},t.prototype.rotateToRef=function(A,S){var E=this,R=E.x,I=E.y,P=E.z,O=A.x,z=A.y,k=A.z,U=A.w,H=U*R+z*P-k*I,V=U*I+k*R-O*P,G=U*P+O*I-z*R,X=-O*R-z*I-k*P;return S.x=H*U+X*-O+V*-k-G*-z,S.y=V*U+X*-z+G*-O-H*-k,S.z=G*U+X*-k+H*-z-V*-O,S},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this.z*=A,this},t.prototype.scale=function(A){return new t(this.x*A,this.y*A,this.z*A)},t.prototype.scaleToRef=function(A,S){return S.copyFromFloats(this.x*A,this.y*A,this.z*A)},t.prototype.scaleAndAddToRef=function(A,S){return S.addInPlaceFromFloats(this.x*A,this.y*A,this.z*A)},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y&&this.z===A.z},t.prototype.equalsWithEpsilon=function(A,S){return void 0===S&&(S=Mt),A&&Bt.WithinEpsilon(this.x,A.x,S)&&Bt.WithinEpsilon(this.y,A.y,S)&&Bt.WithinEpsilon(this.z,A.z,S)},t.prototype.equalsToFloats=function(A,S,E){return this.x===A&&this.y===S&&this.z===E},t.prototype.multiplyInPlace=function(A){return this.x*=A.x,this.y*=A.y,this.z*=A.z,this},t.prototype.multiply=function(A){return this.multiplyByFloats(A.x,A.y,A.z)},t.prototype.multiplyToRef=function(A,S){return S.copyFromFloats(this.x*A.x,this.y*A.y,this.z*A.z)},t.prototype.multiplyByFloats=function(A,S,E){return new t(this.x*A,this.y*S,this.z*E)},t.prototype.divide=function(A){return new t(this.x/A.x,this.y/A.y,this.z/A.z)},t.prototype.divideToRef=function(A,S){return S.copyFromFloats(this.x/A.x,this.y/A.y,this.z/A.z)},t.prototype.divideInPlace=function(A){return this.divideToRef(A,this)},t.prototype.minimizeInPlace=function(A){return this.minimizeInPlaceFromFloats(A.x,A.y,A.z)},t.prototype.maximizeInPlace=function(A){return this.maximizeInPlaceFromFloats(A.x,A.y,A.z)},t.prototype.minimizeInPlaceFromFloats=function(A,S,E){return A<this.x&&(this.x=A),S<this.y&&(this.y=S),E<this.z&&(this.z=E),this},t.prototype.maximizeInPlaceFromFloats=function(A,S,E){return A>this.x&&(this.x=A),S>this.y&&(this.y=S),E>this.z&&(this.z=E),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){return this.normalizeFromLength(this.length())},t.prototype.normalizeFromLength=function(A){return 0===A||1===A?this:this.scaleInPlace(1/A)},t.prototype.normalizeToNew=function(){var A=new t(0,0,0);return this.normalizeToRef(A),A},t.prototype.normalizeToRef=function(A){var S=this.length();return 0===S||1===S?A.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/S,A)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(A){return this.copyFromFloats(A.x,A.y,A.z)},t.prototype.copyFromFloats=function(A,S,E){return this.x=A,this.y=S,this.z=E,this},t.prototype.set=function(A,S,E){return this.copyFromFloats(A,S,E)},t.prototype.setAll=function(A){return this.x=this.y=this.z=A,this},t}(),Gt={Vector3:v(6,Vt.Zero),Matrix:v(2,Wt.Identity),Quaternion:v(3,Ht.Zero),staticUp:Vt.Up(),tmpMatrix:Wt.Zero()},qt=function(){function t(A){this._radians=A,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(A,S){var E=S.subtract(A);return new t(Math.atan2(E.y,E.x))},t.FromRadians=function(A){return new t(A)},t.FromDegrees=function(A){return new t(A*Math.PI/180)},t.prototype.degrees=function(){return 180*this._radians/Math.PI},t.prototype.radians=function(){return this._radians},t}(),Yt=function(){function t(A,S){void 0===A&&(A=0),void 0===S&&(S=0),this.x=A,this.y=S}return t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.Add=function(A,S){return new t(A.x,A.y).addInPlace(S)},t.FromArray=function(A,S){return void 0===S&&(S=0),new t(A[S],A[S+1])},t.FromArrayToRef=function(A,S,E){E.x=A[S],E.y=A[S+1]},t.CatmullRom=function(A,S,E,R,I){var P=I*I,O=I*P;return new t(.5*(2*S.x+(-A.x+E.x)*I+(2*A.x-5*S.x+4*E.x-R.x)*P+(-A.x+3*S.x-3*E.x+R.x)*O),.5*(2*S.y+(-A.y+E.y)*I+(2*A.y-5*S.y+4*E.y-R.y)*P+(-A.y+3*S.y-3*E.y+R.y)*O))},t.Clamp=function(A,S,E){var R=A.x;R=(R=R>E.x?E.x:R)<S.x?S.x:R;var I=A.y;return new t(R,I=(I=I>E.y?E.y:I)<S.y?S.y:I)},t.Hermite=function(A,S,E,R,I){var P=I*I,O=I*P,z=2*O-3*P+1,k=-2*O+3*P,U=O-2*P+I,H=O-P;return new t(A.x*z+E.x*k+S.x*U+R.x*H,A.y*z+E.y*k+S.y*U+R.y*H)},t.Lerp=function(A,S,E){return new t(A.x+(S.x-A.x)*E,A.y+(S.y-A.y)*E)},t.Dot=function(A,S){return A.x*S.x+A.y*S.y},t.Normalize=function(A){var S=new t(A.x,A.y);return S.normalize(),S},t.Minimize=function(A,S){return new t(A.x<S.x?A.x:S.x,A.y<S.y?A.y:S.y)},t.Maximize=function(A,S){return new t(A.x>S.x?A.x:S.x,A.y>S.y?A.y:S.y)},t.Transform=function(A,S){var E=t.Zero();return t.TransformToRef(A,S,E),E},t.TransformToRef=function(A,S,E){var R=S.m,I=A.x*R[0]+A.y*R[4]+R[12],P=A.x*R[1]+A.y*R[5]+R[13];E.x=I,E.y=P},t.PointInTriangle=function(A,S,E,R){var I=.5*(-E.y*R.x+S.y*(-E.x+R.x)+S.x*(E.y-R.y)+E.x*R.y),P=I<0?-1:1,O=(S.y*R.x-S.x*R.y+(R.y-S.y)*A.x+(S.x-R.x)*A.y)*P,z=(S.x*E.y-S.y*E.x+(S.y-E.y)*A.x+(E.x-S.x)*A.y)*P;return O>0&&z>0&&O+z<2*I*P},t.Distance=function(A,S){return Math.sqrt(t.DistanceSquared(A,S))},t.DistanceSquared=function(A,S){var E=A.x-S.x,R=A.y-S.y;return E*E+R*R},t.Center=function(A,S){var E=t.Add(A,S);return E.scaleInPlace(.5),E},t.DistanceOfPointFromSegment=function(A,S,E){var R=t.DistanceSquared(S,E);if(0===R)return t.Distance(A,S);var I=E.subtract(S),P=Math.max(0,Math.min(1,t.Dot(A.subtract(S),I)/R)),O=S.add(I.multiplyByFloats(P,P));return t.Distance(A,O)},t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){return 397*(this.x||0)^(this.y||0)},t.prototype.toArray=function(A,S){return void 0===S&&(S=0),A[S]=this.x,A[S+1]=this.y,this},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.copyFrom=function(A){return this.x=A.x,this.y=A.y,this},t.prototype.copyFromFloats=function(A,S){return this.x=A,this.y=S,this},t.prototype.set=function(A,S){return this.copyFromFloats(A,S)},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y)},t.prototype.addToRef=function(A,S){return S.x=this.x+A.x,S.y=this.y+A.y,this},t.prototype.addInPlace=function(A){return this.x+=A.x,this.y+=A.y,this},t.prototype.addVector3=function(A){return new t(this.x+A.x,this.y+A.y)},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y)},t.prototype.subtractToRef=function(A,S){return S.x=this.x-A.x,S.y=this.y-A.y,this},t.prototype.subtractInPlace=function(A){return this.x-=A.x,this.y-=A.y,this},t.prototype.multiplyInPlace=function(A){return this.x*=A.x,this.y*=A.y,this},t.prototype.multiply=function(A){return new t(this.x*A.x,this.y*A.y)},t.prototype.multiplyToRef=function(A,S){return S.x=this.x*A.x,S.y=this.y*A.y,this},t.prototype.multiplyByFloats=function(A,S){return new t(this.x*A,this.y*S)},t.prototype.divide=function(A){return new t(this.x/A.x,this.y/A.y)},t.prototype.divideToRef=function(A,S){return S.x=this.x/A.x,S.y=this.y/A.y,this},t.prototype.divideInPlace=function(A){return this.divideToRef(A,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this},t.prototype.scale=function(A){var S=new t(0,0);return this.scaleToRef(A,S),S},t.prototype.scaleToRef=function(A,S){return S.x=this.x*A,S.y=this.y*A,this},t.prototype.scaleAndAddToRef=function(A,S){return S.x+=this.x*A,S.y+=this.y*A,this},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y},t.prototype.equalsWithEpsilon=function(A,S){return void 0===S&&(S=Mt),A&&Bt.WithinEpsilon(this.x,A.x,S)&&Bt.WithinEpsilon(this.y,A.y,S)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var A=this.length();if(0===A)return this;var S=1/A;return this.x*=S,this.y*=S,this},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),Ft=function(S,E,R){this.startPoint=S,this.midPoint=E,this.endPoint=R;var I=Math.pow(E.x,2)+Math.pow(E.y,2),P=(Math.pow(S.x,2)+Math.pow(S.y,2)-I)/2,O=(I-Math.pow(R.x,2)-Math.pow(R.y,2))/2,z=(S.x-E.x)*(E.y-R.y)-(E.x-R.x)*(S.y-E.y);this.centerPoint=new Yt((P*(E.y-R.y)-O*(S.y-E.y))/z,((S.x-E.x)*O-(E.x-R.x)*P)/z),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=qt.BetweenTwoPoints(this.centerPoint,this.startPoint);var k=this.startAngle.degrees(),U=qt.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),H=qt.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();U-k>180&&(U-=360),U-k<-180&&(U+=360),H-U>180&&(H-=360),H-U<-180&&(H+=360),this.orientation=U-k<0?A.Orientation.CW:A.Orientation.CCW,this.angle=qt.FromDegrees(this.orientation===A.Orientation.CW?k-H:H-k)},jt=function(){function t(){}return t.X=new Vt(1,0,0),t.Y=new Vt(0,1,0),t.Z=new Vt(0,0,1),t}(),Xt=function(){function t(){}return t.Interpolate=function(A,S,E,R,I){for(var P=1-3*R+3*S,O=3*R-6*S,z=3*S,k=A,U=0;U<5;U++){var H=k*k;k-=1/(3*P*H+2*O*k+z)*(P*(H*k)+O*H+z*k-A),k=Math.min(1,Math.max(0,k))}return 3*Math.pow(1-k,2)*k*E+3*(1-k)*Math.pow(k,2)*I+Math.pow(k,3)},t}(),Qt=function(){function t(A,S,E,R){void 0===A&&(A=0),void 0===S&&(S=0),void 0===E&&(E=0),void 0===R&&(R=1),this.r=A,this.g=S,this.b=E,this.a=R}return t.FromHexString=function(A){if("#"!==A.substring(0,1)||9!==A.length)return new t(0,0,0,0);var S=parseInt(A.substring(1,3),16),E=parseInt(A.substring(3,5),16),R=parseInt(A.substring(5,7),16),I=parseInt(A.substring(7,9),16);return t.FromInts(S,E,R,I)},t.Lerp=function(A,S,E){var R=new t(0,0,0,0);return t.LerpToRef(A,S,E,R),R},t.LerpToRef=function(A,S,E,R){R.r=A.r+(S.r-A.r)*E,R.g=A.g+(S.g-A.g)*E,R.b=A.b+(S.b-A.b)*E,R.a=A.a+(S.a-A.a)*E},t.Red=function(){return new t(1,0,0,1)},t.Green=function(){return new t(0,1,0,1)},t.Blue=function(){return new t(0,0,1,1)},t.Black=function(){return new t(0,0,0,1)},t.White=function(){return new t(1,1,1,1)},t.Purple=function(){return new t(.5,0,.5,1)},t.Magenta=function(){return new t(1,0,1,1)},t.Yellow=function(){return new t(1,1,0,1)},t.Gray=function(){return new t(.5,.5,.5,1)},t.Teal=function(){return new t(0,1,1,1)},t.Clear=function(){return new t(0,0,0,0)},t.FromColor3=function(A,S){return void 0===S&&(S=1),new t(A.r,A.g,A.b,S)},t.FromArray=function(A,S){return void 0===S&&(S=0),new t(A[S],A[S+1],A[S+2],A[S+3])},t.FromInts=function(A,S,E,R){return new t(A/255,S/255,E/255,R/255)},t.CheckColors4=function(A,S){if(A.length===3*S){for(var E=[],R=0;R<A.length;R+=3){var I=R/3*4;E[I]=A[R],E[I+1]=A[R+1],E[I+2]=A[R+2],E[I+3]=1}return E}return A},t.prototype.addInPlace=function(A){return this.r+=A.r,this.g+=A.g,this.b+=A.b,this.a+=A.a,this},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.toArray=function(A,S){return void 0===S&&(S=0),A[S]=this.r,A[S+1]=this.g,A[S+2]=this.b,A[S+3]=this.a,this},t.prototype.add=function(A){return new t(this.r+A.r,this.g+A.g,this.b+A.b,this.a+A.a)},t.prototype.subtract=function(A){return new t(this.r-A.r,this.g-A.g,this.b-A.b,this.a-A.a)},t.prototype.subtractToRef=function(A,S){return S.r=this.r-A.r,S.g=this.g-A.g,S.b=this.b-A.b,S.a=this.a-A.a,this},t.prototype.scale=function(A){return new t(this.r*A,this.g*A,this.b*A,this.a*A)},t.prototype.scaleToRef=function(A,S){return S.r=this.r*A,S.g=this.g*A,S.b=this.b*A,S.a=this.a*A,this},t.prototype.scaleAndAddToRef=function(A,S){return S.r+=this.r*A,S.g+=this.g*A,S.b+=this.b*A,S.a+=this.a*A,this},t.prototype.clampToRef=function(A,S,E){return void 0===A&&(A=0),void 0===S&&(S=1),E.r=Bt.Clamp(this.r,A,S),E.g=Bt.Clamp(this.g,A,S),E.b=Bt.Clamp(this.b,A,S),E.a=Bt.Clamp(this.a,A,S),this},t.prototype.multiply=function(A){return new t(this.r*A.r,this.g*A.g,this.b*A.b,this.a*A.a)},t.prototype.multiplyToRef=function(A,S){return S.r=this.r*A.r,S.g=this.g*A.g,S.b=this.b*A.b,S.a=this.a*A.a,S},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var A=this.r||0;return 397*(A=397*(A=397*A^(this.g||0))^(this.b||0))^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(A){return this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a,this},t.prototype.copyFromFloats=function(A,S,E,R){return this.r=A,this.g=S,this.b=E,this.a=R,this},t.prototype.set=function(A,S,E,R){return this.copyFromFloats(A,S,E,R)},t.prototype.toHexString=function(){var A=255*this.r|0,S=255*this.g|0,E=255*this.b|0,R=255*this.a|0;return"#"+Bt.ToHex(A)+Bt.ToHex(S)+Bt.ToHex(E)+Bt.ToHex(R)},t.prototype.toLinearSpace=function(){var A=new t;return this.toLinearSpaceToRef(A),A},t.prototype.toLinearSpaceToRef=function(A){return A.r=Math.pow(this.r,Lt),A.g=Math.pow(this.g,Lt),A.b=Math.pow(this.b,Lt),A.a=this.a,this},t.prototype.toGammaSpace=function(){var A=new t;return this.toGammaSpaceToRef(A),A},t.prototype.toGammaSpaceToRef=function(A){return A.r=Math.pow(this.r,Dt),A.g=Math.pow(this.g,Dt),A.b=Math.pow(this.b,Dt),A.a=this.a,this},t}(),Zt=function(){function t(A,S,E){void 0===A&&(A=0),void 0===S&&(S=0),void 0===E&&(E=0),this.r=A,this.g=S,this.b=E}return t.FromHexString=function(A){if("#"!==A.substring(0,1)||7!==A.length)return new t(0,0,0);var S=parseInt(A.substring(1,3),16),E=parseInt(A.substring(3,5),16),R=parseInt(A.substring(5,7),16);return t.FromInts(S,E,R)},t.FromArray=function(A,S){return void 0===S&&(S=0),new t(A[S],A[S+1],A[S+2])},t.FromInts=function(A,S,E){return new t(A/255,S/255,E/255)},t.Lerp=function(A,S,E){var R=new t(0,0,0);return t.LerpToRef(A,S,E,R),R},t.LerpToRef=function(A,S,E,R){R.r=A.r+(S.r-A.r)*E,R.g=A.g+(S.g-A.g)*E,R.b=A.b+(S.b-A.b)*E},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var A=this.r||0;return 397*(A=397*A^(this.g||0))^(this.b||0)},t.prototype.toArray=function(A,S){return void 0===S&&(S=0),A[S]=this.r,A[S+1]=this.g,A[S+2]=this.b,this},t.prototype.toColor4=function(A){return void 0===A&&(A=1),new Qt(this.r,this.g,this.b,A)},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(A){return new t(this.r*A.r,this.g*A.g,this.b*A.b)},t.prototype.multiplyToRef=function(A,S){return S.r=this.r*A.r,S.g=this.g*A.g,S.b=this.b*A.b,this},t.prototype.equals=function(A){return A&&this.r===A.r&&this.g===A.g&&this.b===A.b},t.prototype.equalsFloats=function(A,S,E){return this.r===A&&this.g===S&&this.b===E},t.prototype.scale=function(A){return new t(this.r*A,this.g*A,this.b*A)},t.prototype.scaleToRef=function(A,S){return S.r=this.r*A,S.g=this.g*A,S.b=this.b*A,this},t.prototype.scaleAndAddToRef=function(A,S){return S.r+=this.r*A,S.g+=this.g*A,S.b+=this.b*A,this},t.prototype.clampToRef=function(A,S,E){return void 0===A&&(A=0),void 0===S&&(S=1),E.r=Bt.Clamp(this.r,A,S),E.g=Bt.Clamp(this.g,A,S),E.b=Bt.Clamp(this.b,A,S),this},t.prototype.add=function(A){return new t(this.r+A.r,this.g+A.g,this.b+A.b)},t.prototype.addToRef=function(A,S){return S.r=this.r+A.r,S.g=this.g+A.g,S.b=this.b+A.b,this},t.prototype.subtract=function(A){return new t(this.r-A.r,this.g-A.g,this.b-A.b)},t.prototype.subtractToRef=function(A,S){return S.r=this.r-A.r,S.g=this.g-A.g,S.b=this.b-A.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(A){return this.r=A.r,this.g=A.g,this.b=A.b,this},t.prototype.copyFromFloats=function(A,S,E){return this.r=A,this.g=S,this.b=E,this},t.prototype.set=function(A,S,E){return this.copyFromFloats(A,S,E)},t.prototype.toHexString=function(){var A=255*this.r|0,S=255*this.g|0,E=255*this.b|0;return"#"+Bt.ToHex(A)+Bt.ToHex(S)+Bt.ToHex(E)},t.prototype.toLinearSpace=function(){var A=new t;return this.toLinearSpaceToRef(A),A},t.prototype.toLinearSpaceToRef=function(A){return A.r=Math.pow(this.r,Lt),A.g=Math.pow(this.g,Lt),A.b=Math.pow(this.b,Lt),this},t.prototype.toGammaSpace=function(){var A=new t;return this.toGammaSpaceToRef(A),A},t.prototype.toGammaSpaceToRef=function(A){return A.r=Math.pow(this.r,Dt),A.g=Math.pow(this.g,Dt),A.b=Math.pow(this.b,Dt),this},t.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b}},t}(),Jt=function(){function t(A){this._length=0,this._points=A,this._length=this._computeLength(A)}return t.CreateQuadraticBezier=function(A,S,E,R){R=R>2?R:3;for(var I=new Array,s=function(A,S,E,R){return(1-A)*(1-A)*S+2*A*(1-A)*E+A*A*R},P=0;P<=R;P++)I.push(new Vt(s(P/R,A.x,S.x,E.x),s(P/R,A.y,S.y,E.y),s(P/R,A.z,S.z,E.z)));return new t(I)},t.CreateCubicBezier=function(A,S,E,R,I){I=I>3?I:4;for(var P=new Array,a=function(A,S,E,R,I){return(1-A)*(1-A)*(1-A)*S+3*A*(1-A)*(1-A)*E+3*A*A*(1-A)*R+A*A*A*I},O=0;O<=I;O++)P.push(new Vt(a(O/I,A.x,S.x,E.x,R.x),a(O/I,A.y,S.y,E.y,R.y),a(O/I,A.z,S.z,E.z,R.z)));return new t(P)},t.CreateHermiteSpline=function(A,S,E,R,I){for(var P=new Array,O=1/I,z=0;z<=I;z++)P.push(Vt.Hermite(A,S,E,R,z*O));return new t(P)},t.CreateCatmullRomSpline=function(A,S,E){var R=new Array,I=1/S,P=0;if(E){for(var O=A.length,z=0;z<O;z++){P=0;for(var k=0;k<S;k++)R.push(Vt.CatmullRom(A[z%O],A[(z+1)%O],A[(z+2)%O],A[(z+3)%O],P)),P+=I}R.push(R[0])}else{var U=new Array;for(U.push(A[0].clone()),Array.prototype.push.apply(U,A),U.push(A[A.length-1].clone()),z=0,z=0;z<U.length-3;z++)for(P=0,k=0;k<S;k++)R.push(Vt.CatmullRom(U[z],U[z+1],U[z+2],U[z+3],P)),P+=I;z--,R.push(Vt.CatmullRom(U[z],U[z+1],U[z+2],U[z+3],P))}return new t(R)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype.continue=function(A){for(var S=this._points[this._points.length-1],E=this._points.slice(),R=A.getPoints(),I=1;I<R.length;I++)E.push(R[I].subtract(R[0]).add(S));return new t(E)},t.prototype._computeLength=function(A){for(var S=0,E=1;E<A.length;E++)S+=A[E].subtract(A[E-1]).length();return S},t}(),$t=function(){function t(A,S,E,R){this.normal=new Vt(A,S,E),this.d=R}return t.FromArray=function(A){return new t(A[0],A[1],A[2],A[3])},t.FromPoints=function(A,S,E){var R=new t(0,0,0,0);return R.copyFromPoints(A,S,E),R},t.FromPositionAndNormal=function(A,S){var E=new t(0,0,0,0);return S.normalize(),E.normal=S,E.d=-(S.x*A.x+S.y*A.y+S.z*A.z),E},t.SignedDistanceToPlaneFromPositionAndNormal=function(A,S,E){var R=-(S.x*A.x+S.y*A.y+S.z*A.z);return Vt.Dot(E,S)+R},t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){return 397*this.normal.getHashCode()^(this.d||0)},t.prototype.normalize=function(){var A=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),S=0;return 0!==A&&(S=1/A),this.normal.x*=S,this.normal.y*=S,this.normal.z*=S,this.d*=S,this},t.prototype.transform=function(A){var S=Gt.Matrix[0];Wt.TransposeToRef(A,S);var E=S.m,R=this.normal.x,I=this.normal.y,P=this.normal.z,O=this.d;return new t(R*E[0]+I*E[1]+P*E[2]+O*E[3],R*E[4]+I*E[5]+P*E[6]+O*E[7],R*E[8]+I*E[9]+P*E[10]+O*E[11],R*E[12]+I*E[13]+P*E[14]+O*E[15])},t.prototype.dotCoordinate=function(A){return this.normal.x*A.x+this.normal.y*A.y+this.normal.z*A.z+this.d},t.prototype.copyFromPoints=function(A,S,E){var R,I=S.x-A.x,P=S.y-A.y,O=S.z-A.z,z=E.x-A.x,k=E.y-A.y,U=E.z-A.z,H=P*U-O*k,V=O*z-I*U,G=I*k-P*z,X=Math.sqrt(H*H+V*V+G*G);return R=0!==X?1/X:0,this.normal.x=H*R,this.normal.y=V*R,this.normal.z=G*R,this.d=-(this.normal.x*A.x+this.normal.y*A.y+this.normal.z*A.z),this},t.prototype.isFrontFacingTo=function(A,S){return Vt.Dot(this.normal,A)<=S},t.prototype.signedDistanceTo=function(A){return Vt.Dot(A,this.normal)+this.d},t}(),ee=function(){function t(){}return t.GetPlanes=function(A){for(var S=[],E=0;E<6;E++)S.push(new $t(0,0,0,0));return t.GetPlanesToRef(A,S),S},t.GetNearPlaneToRef=function(A,S){var E=A.m;S.normal.x=E[3]+E[2],S.normal.y=E[7]+E[6],S.normal.z=E[11]+E[10],S.d=E[15]+E[14],S.normalize()},t.GetFarPlaneToRef=function(A,S){var E=A.m;S.normal.x=E[3]-E[2],S.normal.y=E[7]-E[6],S.normal.z=E[11]-E[10],S.d=E[15]-E[14],S.normalize()},t.GetLeftPlaneToRef=function(A,S){var E=A.m;S.normal.x=E[3]+E[0],S.normal.y=E[7]+E[4],S.normal.z=E[11]+E[8],S.d=E[15]+E[12],S.normalize()},t.GetRightPlaneToRef=function(A,S){var E=A.m;S.normal.x=E[3]-E[0],S.normal.y=E[7]-E[4],S.normal.z=E[11]-E[8],S.d=E[15]-E[12],S.normalize()},t.GetTopPlaneToRef=function(A,S){var E=A.m;S.normal.x=E[3]-E[1],S.normal.y=E[7]-E[5],S.normal.z=E[11]-E[9],S.d=E[15]-E[13],S.normalize()},t.GetBottomPlaneToRef=function(A,S){var E=A.m;S.normal.x=E[3]+E[1],S.normal.y=E[7]+E[5],S.normal.z=E[11]+E[9],S.d=E[15]+E[13],S.normalize()},t.GetPlanesToRef=function(A,S){t.GetNearPlaneToRef(A,S[0]),t.GetFarPlaneToRef(A,S[1]),t.GetLeftPlaneToRef(A,S[2]),t.GetRightPlaneToRef(A,S[3]),t.GetTopPlaneToRef(A,S[4]),t.GetBottomPlaneToRef(A,S[5])},t}(),ne=function(){function e(A,S){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Yt(A,S))}return e.StartingAt=function(A,S){return new e(A,S)},e.prototype.addLineTo=function(A,S){if(this.closed)return this;var E=new Yt(A,S),R=this._points[this._points.length-1];return this._points.push(E),this._length+=E.subtract(R).length(),this},e.prototype.addArcTo=function(S,E,R,I,P){if(void 0===P&&(P=36),this.closed)return this;var O=this._points[this._points.length-1],z=new Yt(S,E),k=new Yt(R,I),U=new Ft(O,z,k),H=U.angle.radians()/P;U.orientation===A.Orientation.CW&&(H*=-1);for(var V=U.startAngle.radians()+H,G=0;G<P;G++){var X=Math.cos(V)*U.radius+U.centerPoint.x,Q=Math.sin(V)*U.radius+U.centerPoint.y;this.addLineTo(X,Q),V+=H}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var A=this._length;if(!this.closed){var S=this._points[this._points.length-1];A+=this._points[0].subtract(S).length()}return A},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(A){if(A<0||A>1)return Yt.Zero();for(var S=A*this.length(),E=0,R=0;R<this._points.length;R++){var I=(R+1)%this._points.length,P=this._points[R],O=this._points[I].subtract(P),z=O.length()+E;if(S>=E&&S<=z){var k=O.normalize(),U=S-E;return new Yt(P.x+k.x*U,P.y+k.y*U)}E=z}return Yt.Zero()},e}(),ie=function(){function t(A,S,E){void 0===S&&(S=null),this.path=A,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var R=0;R<A.length;R++)this._curve[R]=A[R].clone();this._raw=E||!1,this._compute(S)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(A,S){void 0===S&&(S=null);for(var E=0;E<A.length;E++)this._curve[E].x=A[E].x,this._curve[E].y=A[E].y,this._curve[E].z=A[E].z;return this._compute(S),this},t.prototype._compute=function(A){var S=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[S-1]=this._curve[S-1].subtract(this._curve[S-2]),this._raw||this._tangents[S-1].normalize();var E,R,I,P,O=this._tangents[0],z=this._normalVector(this._curve[0],O,A);this._normals[0]=z,this._raw||this._normals[0].normalize(),this._binormals[0]=Vt.Cross(O,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var k=1;k<S;k++)E=this._getLastNonNullVector(k),k<S-1&&(R=this._getFirstNonNullVector(k),this._tangents[k]=E.add(R),this._tangents[k].normalize()),this._distances[k]=this._distances[k-1]+E.length(),I=this._tangents[k],P=this._binormals[k-1],this._normals[k]=Vt.Cross(P,I),this._raw||this._normals[k].normalize(),this._binormals[k]=Vt.Cross(I,this._normals[k]),this._raw||this._binormals[k].normalize()},t.prototype._getFirstNonNullVector=function(A){for(var S=1,E=this._curve[A+S].subtract(this._curve[A]);0===E.length()&&A+S+1<this._curve.length;)S++,E=this._curve[A+S].subtract(this._curve[A]);return E},t.prototype._getLastNonNullVector=function(A){for(var S=1,E=this._curve[A].subtract(this._curve[A-S]);0===E.length()&&A>S+1;)S++,E=this._curve[A].subtract(this._curve[A-S]);return E},t.prototype._normalVector=function(A,S,E){var R,I,P=S.length();(0===P&&(P=1),null==E)?(I=Bt.WithinEpsilon(Math.abs(S.y)/P,1,Mt)?Bt.WithinEpsilon(Math.abs(S.x)/P,1,Mt)?Bt.WithinEpsilon(Math.abs(S.z)/P,1,Mt)?Vt.Zero():new Vt(0,0,1):new Vt(1,0,0):new Vt(0,-1,0),R=Vt.Cross(S,I)):(R=Vt.Cross(S,E),Vt.CrossToRef(R,S,R));return R.normalize(),R},t}(),oe=function(){function t(A,S){this.width=A,this.height=S}return Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),t.Zero=function(){return new t(0,0)},t.Lerp=function(A,S,E){return new t(A.width+(S.width-A.width)*E,A.height+(S.height-A.height)*E)},t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){return 397*(this.width||0)^(this.height||0)},t.prototype.copyFrom=function(A){this.width=A.width,this.height=A.height},t.prototype.copyFromFloats=function(A,S){return this.width=A,this.height=S,this},t.prototype.set=function(A,S){return this.copyFromFloats(A,S)},t.prototype.multiplyByFloats=function(A,S){return new t(this.width*A,this.height*S)},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(A){return!!A&&this.width===A.width&&this.height===A.height},t.prototype.add=function(A){return new t(this.width+A.width,this.height+A.height)},t.prototype.subtract=function(A){return new t(this.width-A.width,this.height-A.height)},t}(),re={looping:!0,speed:1,weight:1,layer:0},se=function(A){function e(S,E){void 0===E&&(E=re);var R=A.call(this)||this;return R.isAnimationClip=!0,R.looping=re.looping,R.weight=re.weight,R.playing=!1,R.shouldReset=!1,R.speed=re.speed,R.name=f("AnimClip"),R.layer=re.layer,R.clip=S,R.setParams(i({},E)),R}return o(e,A),e.prototype.setParams=function(A){return this.looping=void 0!==A.looping?A.looping:this.looping,this.speed=A.speed||this.speed,this.weight=A.weight||this.weight,this.layer=A.layer||this.layer,this},e.prototype.toJSON=function(){var S=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),S},e.prototype.play=function(A){var S;void 0===A&&(A=!1),null===(S=this.owner)||void 0===S||S.play(this,A)},e.prototype.pause=function(){var A;null===(A=this.owner)||void 0===A||A.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var A;null===(A=this.owner)||void 0===A||A.stop(this)},r([K.readonly],e.prototype,"clip",void 0),r([K.field],e.prototype,"looping",void 0),r([K.field],e.prototype,"weight",void 0),r([K.field],e.prototype,"playing",void 0),r([K.field],e.prototype,"shouldReset",void 0),r([K.field],e.prototype,"speed",void 0),r([K.readonly],e.prototype,"name",void 0),e}(K);A.InputEventType=void 0,(It=A.InputEventType||(A.InputEventType={}))[It.DOWN=0]="DOWN",It[It.UP=1]="UP",A.CameraMode=void 0,(Pt=A.CameraMode||(A.CameraMode={}))[Pt.FirstPerson=0]="FirstPerson",Pt[Pt.ThirdPerson=1]="ThirdPerson",Pt[Pt.BuildingToolGodMode=2]="BuildingToolGodMode",A.LandRole=void 0,(Ot=A.LandRole||(A.LandRole={})).OWNER="owner",Ot.OPERATOR="operator",A.ActionButton=void 0,(zt=A.ActionButton||(A.ActionButton={})).POINTER="POINTER",zt.PRIMARY="PRIMARY",zt.SECONDARY="SECONDARY",zt.ANY="ANY",zt.FORWARD="FORWARD",zt.BACKWARD="BACKWARD",zt.RIGHT="RIGHT",zt.LEFT="LEFT",zt.JUMP="JUMP",zt.WALK="WALK",zt.ACTION_3="ACTION_3",zt.ACTION_4="ACTION_4",zt.ACTION_5="ACTION_5",zt.ACTION_6="ACTION_6";var ae,ue,Kt=function(A){if(this.callback=A,!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");le.ensureInstance()},he=function(A){function e(){return null!==A&&A.apply(this,arguments)||this}return o(e,A),r([M("pointerDown")],e)}(Kt),pe=function(A){function e(){return null!==A&&A.apply(this,arguments)||this}return o(e,A),r([M("pointerUp")],e)}(Kt),te=function(A,S){this.fn=A,this.useRaycast=S},le=function(){function e(){this.buttonIdMapping=[A.ActionButton.POINTER,A.ActionButton.PRIMARY,A.ActionButton.SECONDARY,A.ActionButton.ANY,A.ActionButton.FORWARD,A.ActionButton.BACKWARD,A.ActionButton.RIGHT,A.ActionButton.LEFT,A.ActionButton.JUMP,A.ActionButton.WALK,A.ActionButton.ACTION_3,A.ActionButton.ACTION_4,A.ActionButton.ACTION_5,A.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(A,S){var E;return i(i({},A),((E={})[S]={BUTTON_DOWN:[],BUTTON_UP:[]},E))}),{}),this.internalState=this.buttonIdMapping.reduce((function(A,S){var E;return i(i({},A),((E={})[S]={BUTTON_DOWN:!1},E))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(A){return this.internalState[A]},e.prototype.subscribe=function(A,S,E,R){var I=this;return this.subscriptions[S][A].push(new te(R,E)),function(){I.unsubscribe(A,S,R)}},e.prototype.unsubscribe=function(A,S,E){var R=this.getSubscriptionId(A,S,E);return R>-1&&this.subscriptions[S][A].splice(R,1)},e.prototype.handlePointerEvent=function(S){var E=this.getPointerById(S.buttonId);if(E){var R=i(i({},S),{button:E,direction:(new Vt).copyFrom(S.direction),origin:(new Vt).copyFrom(S.origin),hit:void 0}),I=S.hit?i(i({},S.hit),{hitPoint:(new Vt).copyFrom(S.hit.hitPoint),normal:(new Vt).copyFrom(S.hit.normal),worldNormal:(new Vt).copyFrom(S.hit.worldNormal)}):void 0;if(S.type===A.InputEventType.DOWN){this.internalState[E].BUTTON_DOWN=!0;for(var P=0;P<this.subscriptions[E].BUTTON_DOWN.length;P++)(O=this.subscriptions[E].BUTTON_DOWN[P]).useRaycast?R.hit=I:R.hit=void 0,O.fn(R);I&&I.entityId&&F.engine&&(k=(z=F.engine.entities[I.entityId])&&z.getComponentOrNull(he))&&(R.hit=I,k.callback(R))}else{for(this.internalState[E].BUTTON_DOWN=!1,P=0;P<this.subscriptions[E].BUTTON_UP.length;P++){var O;(O=this.subscriptions[E].BUTTON_UP[P]).useRaycast?R.hit=I:R.hit=void 0,O.fn(R)}var z,k;I&&I.entityId&&F.engine&&(k=(z=F.engine.entities[I.entityId])&&z.getComponentOrNull(pe))&&(R.hit=I,k.callback(R))}}},e.prototype.getSubscriptionId=function(A,S,E){for(var R=0;R<this.subscriptions[S][A].length;R++)if(this.subscriptions[S][A][R].fn===E)return R;return-1},e.prototype.getPointerById=function(S){if(S<0||S>=this.buttonIdMapping.length)return null;var E=this.buttonIdMapping[S];return E===A.ActionButton.ANY?null:E},e}();A.CLASS_ID=void 0,(ae=A.CLASS_ID||(A.CLASS_ID={}))[ae.TRANSFORM=1]="TRANSFORM",ae[ae.UUID_CALLBACK=8]="UUID_CALLBACK",ae[ae.BOX_SHAPE=16]="BOX_SHAPE",ae[ae.SPHERE_SHAPE=17]="SPHERE_SHAPE",ae[ae.PLANE_SHAPE=18]="PLANE_SHAPE",ae[ae.CONE_SHAPE=19]="CONE_SHAPE",ae[ae.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",ae[ae.TEXT_SHAPE=21]="TEXT_SHAPE",ae[ae.NFT_SHAPE=22]="NFT_SHAPE",ae[ae.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",ae[ae.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",ae[ae.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",ae[ae.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",ae[ae.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",ae[ae.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",ae[ae.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",ae[ae.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",ae[ae.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",ae[ae.BILLBOARD=32]="BILLBOARD",ae[ae.ANIMATION=33]="ANIMATION",ae[ae.FONT=34]="FONT",ae[ae.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",ae[ae.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",ae[ae.GLTF_SHAPE=54]="GLTF_SHAPE",ae[ae.OBJ_SHAPE=55]="OBJ_SHAPE",ae[ae.AVATAR_SHAPE=56]="AVATAR_SHAPE",ae[ae.BASIC_MATERIAL=64]="BASIC_MATERIAL",ae[ae.PBR_MATERIAL=65]="PBR_MATERIAL",ae[ae.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",ae[ae.SOUND=67]="SOUND",ae[ae.TEXTURE=68]="TEXTURE",ae[ae.VIDEO_CLIP=70]="VIDEO_CLIP",ae[ae.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",ae[ae.AUDIO_CLIP=200]="AUDIO_CLIP",ae[ae.AUDIO_SOURCE=201]="AUDIO_SOURCE",ae[ae.AUDIO_STREAM=202]="AUDIO_STREAM",ae[ae.GIZMOS=203]="GIZMOS",ae[ae.SMART_ITEM=204]="SMART_ITEM",ae[ae.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",ae[ae.NAME=300]="NAME",ae[ae.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",ae[ae.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",A.AvatarModifiers=void 0,(ue=A.AvatarModifiers||(A.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",ue.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var ce,de=function(S){function n(A){var E=S.call(this)||this;return E.area=A.area,E.modifiers=A.modifiers,E}return o(n,S),r([K.field],n.prototype,"area",void 0),r([K.field],n.prototype,"modifiers",void 0),r([M("engine.avatarModifierArea",A.CLASS_ID.AVATAR_MODIFIER_AREA)],n)}(K),fe=function(S){function n(A){void 0===A&&(A={});var E=S.call(this)||this;return E.position=A.position||Vt.Zero(),E.rotation=A.rotation||Ht.Identity,E.scale=A.scale||new Vt(1,1,1),E}return o(n,S),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(A,S){void 0===S&&(S=Gt.staticUp);var E=new Wt;return Wt.LookAtLHToRef(this.position,A,S,E),E.invert(),Ht.FromRotationMatrixToRef(E,this.rotation),this},n.prototype.rotate=function(A,S){return this.rotation.multiplyInPlace(this.rotation.angleAxis(S,A)),this},n.prototype.translate=function(A){return this.position.addInPlace(A),this},r([K.field],n.prototype,"position",void 0),r([K.field],n.prototype,"rotation",void 0),r([K.field],n.prototype,"scale",void 0),r([M("engine.transform",A.CLASS_ID.TRANSFORM)],n)}(K),ye=function(S){function n(A,E,R){void 0===A&&(A=!0),void 0===E&&(E=!0),void 0===R&&(R=!0);var I=S.call(this)||this;return I.x=!0,I.y=!0,I.z=!0,I.x=A,I.y=E,I.z=R,I}return o(n,S),r([K.field],n.prototype,"x",void 0),r([K.field],n.prototype,"y",void 0),r([K.field],n.prototype,"z",void 0),r([M("engine.billboard",A.CLASS_ID.BILLBOARD)],n)}(K),ge=function(A){function e(){var S=null!==A&&A.apply(this,arguments)||this;return S.withCollisions=!0,S.isPointerBlocker=!0,S.visible=!0,S}return o(e,A),r([K.field],e.prototype,"withCollisions",void 0),r([K.field],e.prototype,"isPointerBlocker",void 0),r([K.field],e.prototype,"visible",void 0),e}(K),me=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return o(n,S),r([K.field],n.prototype,"uvs",void 0),r([F("engine.shape",A.CLASS_ID.BOX_SHAPE)],n)}(ge),ve=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return o(n,S),r([F("engine.shape",A.CLASS_ID.SPHERE_SHAPE)],n)}(ge),be=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return o(n,S),r([K.field],n.prototype,"segments",void 0),r([K.field],n.prototype,"arc",void 0),r([F("engine.shape",A.CLASS_ID.CIRCLE_SHAPE)],n)}(ge),xe=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.width=1,A.height=1,A}return o(n,S),r([K.field],n.prototype,"width",void 0),r([K.field],n.prototype,"height",void 0),r([K.field],n.prototype,"uvs",void 0),r([F("engine.shape",A.CLASS_ID.PLANE_SHAPE)],n)}(ge),Te=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.radiusTop=0,A.radiusBottom=1,A.segmentsHeight=1,A.segmentsRadial=36,A.openEnded=!1,A.radius=null,A.arc=360,A}return o(n,S),r([K.field],n.prototype,"radiusTop",void 0),r([K.field],n.prototype,"radiusBottom",void 0),r([K.field],n.prototype,"segmentsHeight",void 0),r([K.field],n.prototype,"segmentsRadial",void 0),r([K.field],n.prototype,"openEnded",void 0),r([K.field],n.prototype,"radius",void 0),r([K.field],n.prototype,"arc",void 0),r([F("engine.shape",A.CLASS_ID.CONE_SHAPE)],n)}(ge),we=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.radiusTop=1,A.radiusBottom=1,A.segmentsHeight=1,A.segmentsRadial=36,A.openEnded=!1,A.radius=null,A.arc=360,A}return o(n,S),r([K.field],n.prototype,"radiusTop",void 0),r([K.field],n.prototype,"radiusBottom",void 0),r([K.field],n.prototype,"segmentsHeight",void 0),r([K.field],n.prototype,"segmentsRadial",void 0),r([K.field],n.prototype,"openEnded",void 0),r([K.field],n.prototype,"radius",void 0),r([K.field],n.prototype,"arc",void 0),r([F("engine.shape",A.CLASS_ID.CYLINDER_SHAPE)],n)}(ge),_e=function(S){function n(A){var E=S.call(this)||this;return E.src=A,E}return o(n,S),r([ge.readonly],n.prototype,"src",void 0),r([F("engine.shape",A.CLASS_ID.GLTF_SHAPE)],n)}(ge);A.PictureFrameStyle=void 0,(ce=A.PictureFrameStyle||(A.PictureFrameStyle={}))[ce.Classic=0]="Classic",ce[ce.Baroque_Ornament=1]="Baroque_Ornament",ce[ce.Diamond_Ornament=2]="Diamond_Ornament",ce[ce.Minimal_Wide=3]="Minimal_Wide",ce[ce.Minimal_Grey=4]="Minimal_Grey",ce[ce.Blocky=5]="Blocky",ce[ce.Gold_Edges=6]="Gold_Edges",ce[ce.Gold_Carved=7]="Gold_Carved",ce[ce.Gold_Wide=8]="Gold_Wide",ce[ce.Gold_Rounded=9]="Gold_Rounded",ce[ce.Metal_Medium=10]="Metal_Medium",ce[ce.Metal_Wide=11]="Metal_Wide",ce[ce.Metal_Slim=12]="Metal_Slim",ce[ce.Metal_Rounded=13]="Metal_Rounded",ce[ce.Pins=14]="Pins",ce[ce.Minimal_Black=15]="Minimal_Black",ce[ce.Minimal_White=16]="Minimal_White",ce[ce.Tape=17]="Tape",ce[ce.Wood_Slim=18]="Wood_Slim",ce[ce.Wood_Wide=19]="Wood_Wide",ce[ce.Wood_Twigs=20]="Wood_Twigs",ce[ce.Canvas=21]="Canvas",ce[ce.None=22]="None";var Ce,Ae=function(S){function n(E,R){void 0===R&&(R={});var I=S.call(this)||this;I.src=E;var P=new Zt(.6404918,.611472,.8584906),O=A.PictureFrameStyle.Classic;return"r"in R?P=R:null!=R&&(R.color&&(P=R.color),R.style&&(O=R.style)),I.color=P,I.style=O,I}return o(n,S),r([ge.readonly],n.prototype,"src",void 0),r([ge.readonly],n.prototype,"style",void 0),r([K.field],n.prototype,"color",void 0),r([F("engine.shape",A.CLASS_ID.NFT_SHAPE)],n)}(ge),Se=function(S){function n(A,E){var R=S.call(this)||this;if(R.src=A,E)for(var I in E)R[I]=E[I];return R}return o(n,S),r([K.readonly],n.prototype,"src",void 0),r([K.readonly],n.prototype,"samplingMode",void 0),r([K.readonly],n.prototype,"wrap",void 0),r([K.readonly],n.prototype,"hasAlpha",void 0),r([F("engine.texture",A.CLASS_ID.TEXTURE)],n)}(K),Ee=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.states=[],A}return o(n,S),n.prototype.addClip=function(A){var S=this;return this.states.push(A),A.onChange((function(){S.dirty=!0})),A.owner=this,this},n.prototype.getClip=function(A){for(var S=0;S<this.states.length;S++){var E=this.states[S];if(E.clip===A)return E}var R=new se(A);return this.addClip(R),R},n.prototype.stop=function(A){if(A)A.playing=!1,A.shouldReset=!0;else for(var S=0;S<this.states.length;S++){var E=this.states[S];this.stop(E)}},n.prototype.play=function(A,S){void 0===S&&(S=!1);for(var E=0;E<this.states.length;E++){var R=this.states[E];R.layer===A.layer&&A!==R&&this.pause(R)}S&&(A.shouldReset=!0),A.playing=!0,A.dirty=!0,A.data.nonce=Math.random()},n.prototype.pause=function(A){if(A)A.playing=!1;else for(var S=0;S<this.states.length;S++){var E=this.states[S];this.pause(E)}},r([K.readonly],n.prototype,"states",void 0),r([M("engine.animator",A.CLASS_ID.ANIMATION)],n)}(ge),Re=function(S){function n(A){var E=S.call(this)||this;return E.src=A,E}return o(n,S),r([K.readonly],n.prototype,"src",void 0),r([F("engine.shape",A.CLASS_ID.OBJ_SHAPE)],n)}(ge),Ie=function(S){function n(A){void 0===A&&(A="");var E=S.call(this)||this;return E.src=A,E}return o(n,S),r([K.readonly],n.prototype,"src",void 0),r([F("engine.font",A.CLASS_ID.FONT)],n)}(K);A.Fonts=void 0,(Ce=A.Fonts||(A.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",Ce.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",Ce.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",Ce.LiberationSans="builtin:LiberationSans SDF",Ce.SansSerif="SansSerif",Ce.SansSerif_Heavy="SansSerif_Heavy",Ce.SansSerif_Bold="SansSerif_Bold",Ce.SansSerif_SemiBold="SansSerif_SemiBold";var Pe,Oe=function(S){function n(A){var E=S.call(this)||this;return E.outlineWidth=0,E.outlineColor=new Zt(1,1,1),E.color=new Zt(1,1,1),E.fontSize=10,E.opacity=1,E.value="",E.lineSpacing="0px",E.lineCount=0,E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=new Zt(1,1,1),E.hTextAlign="center",E.vTextAlign="center",E.width=1,E.height=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.billboard=!1,E.visible=!0,A&&(E.value=A),E}return o(n,S),r([K.field],n.prototype,"outlineWidth",void 0),r([K.field],n.prototype,"outlineColor",void 0),r([K.field],n.prototype,"color",void 0),r([K.field],n.prototype,"fontSize",void 0),r([K.component],n.prototype,"font",void 0),r([K.field],n.prototype,"opacity",void 0),r([K.field],n.prototype,"value",void 0),r([K.field],n.prototype,"lineSpacing",void 0),r([K.field],n.prototype,"lineCount",void 0),r([K.field],n.prototype,"textWrapping",void 0),r([K.field],n.prototype,"shadowBlur",void 0),r([K.field],n.prototype,"shadowOffsetX",void 0),r([K.field],n.prototype,"shadowOffsetY",void 0),r([K.field],n.prototype,"shadowColor",void 0),r([K.field],n.prototype,"hTextAlign",void 0),r([K.field],n.prototype,"vTextAlign",void 0),r([K.field],n.prototype,"width",void 0),r([K.field],n.prototype,"height",void 0),r([K.field],n.prototype,"paddingTop",void 0),r([K.field],n.prototype,"paddingRight",void 0),r([K.field],n.prototype,"paddingBottom",void 0),r([K.field],n.prototype,"paddingLeft",void 0),r([K.field],n.prototype,"billboard",void 0),r([K.field],n.prototype,"visible",void 0),r([M("engine.text",A.CLASS_ID.TEXT_SHAPE)],n)}(K);A.TransparencyMode=void 0,(Pe=A.TransparencyMode||(A.TransparencyMode={}))[Pe.OPAQUE=0]="OPAQUE",Pe[Pe.ALPHA_TEST=1]="ALPHA_TEST",Pe[Pe.ALPHA_BLEND=2]="ALPHA_BLEND",Pe[Pe.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Pe[Pe.AUTO=4]="AUTO";var ze,De=function(S){function n(){var E=null!==S&&S.apply(this,arguments)||this;return E.alphaTest=.5,E.castShadows=!0,E.transparencyMode=A.TransparencyMode.AUTO,E}return o(n,S),r([K.field],n.prototype,"alphaTest",void 0),r([K.field],n.prototype,"albedoColor",void 0),r([K.field],n.prototype,"emissiveColor",void 0),r([K.field],n.prototype,"metallic",void 0),r([K.field],n.prototype,"roughness",void 0),r([K.field],n.prototype,"reflectivityColor",void 0),r([K.field],n.prototype,"directIntensity",void 0),r([K.field],n.prototype,"microSurface",void 0),r([K.field],n.prototype,"emissiveIntensity",void 0),r([K.field],n.prototype,"specularIntensity",void 0),r([K.component],n.prototype,"albedoTexture",void 0),r([K.component],n.prototype,"alphaTexture",void 0),r([K.component],n.prototype,"emissiveTexture",void 0),r([K.component],n.prototype,"bumpTexture",void 0),r([K.field],n.prototype,"castShadows",void 0),r([K.field],n.prototype,"transparencyMode",void 0),r([F("engine.material",A.CLASS_ID.PBR_MATERIAL)],n)}(K),Fe=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.alphaTest=.5,A.castShadows=!0,A}return o(n,S),r([K.component],n.prototype,"texture",void 0),r([K.field],n.prototype,"alphaTest",void 0),r([K.field],n.prototype,"castShadows",void 0),r([F("engine.material",A.CLASS_ID.BASIC_MATERIAL)],n)}(K),Le=function(A){function e(S){var E=A.call(this)||this;if(E.uuid=f("UUID"),!S||!("apply"in S)||!("call"in S))throw new Error("Callback is not a function");return E.callback=S,E}return o(e,A),e.uuidEvent=function(A,S){if(delete A[S]){var E=S+"_"+Math.random();A[E]=void 0,Object.defineProperty(A,E,i(i({},Object.getOwnPropertyDescriptor(A,E)),{enumerable:!1})),Object.defineProperty(A,S.toString(),{get:function(){return this[E]},set:function(A){var R=this[E];if(A){if(!(A instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[S]=A.uuid}else this.data[S]=null;if(this[E]=A,A!==R){this.dirty=!0;for(var I=0;I<this.subscriptions.length;I++)this.subscriptions[I](S,A,R)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([K.field],e.prototype,"callback",void 0),e}(K),Me=function(S){function n(){var E=null!==S&&S.apply(this,arguments)||this;return E.button=A.ActionButton.ANY,E.hoverText="Interact",E.distance=10,E.showFeedback=!0,E}return o(n,S),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([K.field],n.prototype,"button",void 0),r([K.field],n.prototype,"hoverText",void 0),r([K.field],n.prototype,"distance",void 0),r([K.field],n.prototype,"showFeedback",void 0),n}(Le),Ne=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.type="onPointerLock",A}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onPointerLock",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),ke=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.type="onAnimationEnd",A}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onAnimationEnd",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),Be=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return o(n,S),r([M("engine.smartItem",A.CLASS_ID.SMART_ITEM)],n)}(K),Ue=function(S){function n(A){var E=S.call(this)||this;return E.url=A,E}return o(n,S),r([K.readonly],n.prototype,"url",void 0),r([F("engine.VideoClip",A.CLASS_ID.VIDEO_CLIP)],n)}(K);A.VideoStatus=void 0,(ze=A.VideoStatus||(A.VideoStatus={}))[ze.NONE=0]="NONE",ze[ze.ERROR=1]="ERROR",ze[ze.LOADING=2]="LOADING",ze[ze.READY=3]="READY",ze[ze.PLAYING=4]="PLAYING",ze[ze.BUFFERING=5]="BUFFERING";var We,He=function(S){function n(E,R){var I=S.call(this)||this;if(I.volume=1,I.playbackRate=1,I.loop=!1,I.seek=-1,I._position=-1,I._videoLength=-1,I._status=A.VideoStatus.NONE,I.playing=!1,!(E instanceof Ue))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(I.videoClipId=D(E),R)for(var P in R)I[P]=R[P];return I}return o(n,S),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(A){this.seek=A,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var A=JSON.parse(JSON.stringify(S.prototype.toJSON.call(this)));return this.seek=-1,A}return S.prototype.toJSON.call(this)},n.prototype.update=function(S){S.videoClipId==this.videoClipId&&(this._status=S.videoStatus||A.VideoStatus.NONE,this._videoLength=S.totalVideoLength,this._position=S.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([K.readonly],n.prototype,"videoClipId",void 0),r([K.readonly],n.prototype,"samplingMode",void 0),r([K.readonly],n.prototype,"wrap",void 0),r([K.field],n.prototype,"volume",void 0),r([K.field],n.prototype,"playbackRate",void 0),r([K.field],n.prototype,"loop",void 0),r([K.field],n.prototype,"seek",void 0),r([K.field],n.prototype,"playing",void 0),r([F("engine.VideoTexture",A.CLASS_ID.VIDEO_TEXTURE)],n)}(K),Ve=function(){function e(){var S=this;this.position=new Vt,this.rotation=new Ht,this.feetPosition=new Vt,this.worldPosition=new Vt,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=A.CameraMode.FirstPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(A){switch(A.type){case"positionChanged":S.positionChanged(A.data);break;case"rotationChanged":S.rotationChanged(A.data);break;case"cameraModeChanged":S.cameraModeChanged(A.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return S.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return S.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return S.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return S.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return S.lastEventPosition.y-S.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return S.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return S.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return S.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return S.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(A){this.lastEventPosition=A.position,this.lastEventWorldPosition=A.cameraPosition,this._playerHeight=A.playerHeight},e.prototype.rotationChanged=function(A){this.lastEventRotation=A.quaternion},e.prototype.cameraModeChanged=function(A){this._cameraMode=A.cameraMode},e}();!function(A){A.HitFirst="rqhf",A.HitAll="rqha"}(We||(We={}));var Ge,qe=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(A){var S=Ve.instance.rotation,E=Wt.Identity();S.toRotationMatrix(E);var R=Vt.TransformCoordinates(Vt.Forward(),E);return{origin:Ve.instance.position,direction:R,distance:A}},t.prototype.getRayFromPositions=function(A,S){var E=S.subtract(A),R=E.length();return{origin:A,direction:E.normalize(),distance:R}},t.prototype.hitFirst=function(A,S,E){var R="number"==typeof E?We.HitFirst+E:y();this.queries[R]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitFirst",ray:A})},t.prototype.hitAll=function(A,S,E){var R="number"==typeof E?We.HitAll+E:y();this.queries[R]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitAll",ray:A})},t.prototype.hitFirstAvatar=function(A,S){l("not implemented yet")},t.prototype.hitAllAvatars=function(A,S){l("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(A){this.queries[A.payload.queryId](A.payload.payload),delete this.queries[A.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(A){this.queries[A.payload.queryId](A.payload.payload),delete this.queries[A.payload.queryId]},t}(),Ye=function(){function t(){}return t.prototype.activate=function(A){A.eventManager.addListener(ht,this,(function(A){"HitFirst"===A.payload.queryType?qe.instance.handleRaycastHitFirstResponse(A):"HitAll"===A.payload.queryType&&qe.instance.handleRaycastHitAllResponse(A)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),je=function(){function t(){}return t.prototype.activate=function(A){A.eventManager.addListener(pt,this,(function(A){le.instance.handlePointerEvent(A.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),Xe=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(A){A.eventManager.addListener(ut,this,this.handleEvent),A.eventManager.addListener(z,this,this.componentAdded),A.eventManager.addListener(O,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(A){for(var S in A.components){var E=A.components[S];E instanceof Le&&(this.handlerMap[E.uuid]=E)}},t.prototype.onRemoveEntity=function(A){for(var S in A.components){var E=A.components[S];E instanceof Le&&delete this.handlerMap[E.uuid]}},t.prototype.componentAdded=function(A){if(A.entity.isAddedToEngine()){var S=A.entity.components[A.componentName];S instanceof Le&&(this.handlerMap[S.uuid]=S)}},t.prototype.componentRemoved=function(A){A.entity.isAddedToEngine()&&A.component instanceof Le&&delete this.handlerMap[A.component.uuid]},t.prototype.handleEvent=function(A){if(A.uuid in this.handlerMap){var S=this.handlerMap[A.uuid];S&&S.callback&&"call"in S.callback&&S.callback(A.payload)}},t}(),Qe=new Ye,Ze=new je,Ke=new Xe,Je=function(S){function n(A){var E=S.call(this)||this;return E.loop=!1,E.volume=1,E.url=A,E}return o(n,S),r([K.readonly],n.prototype,"url",void 0),r([K.field],n.prototype,"loop",void 0),r([K.field],n.prototype,"loadingCompleteEventId",void 0),r([K.field],n.prototype,"volume",void 0),r([F("engine.AudioClip",A.CLASS_ID.AUDIO_CLIP)],n)}(K),$e=function(S){function n(A){var E=S.call(this)||this;if(E.audioClip=A,E.loop=!1,E.volume=1,E.playing=!1,E.pitch=1,E.playedAtTimestamp=Date.now(),!(A instanceof Je))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return E.audioClipId=D(A),E}return o(n,S),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([K.readonly],n.prototype,"audioClipId",void 0),r([K.field],n.prototype,"loop",void 0),r([K.field],n.prototype,"volume",void 0),r([K.field],n.prototype,"playing",void 0),r([K.field],n.prototype,"pitch",void 0),r([K.field],n.prototype,"playedAtTimestamp",void 0),r([M("engine.AudioSource",A.CLASS_ID.AUDIO_SOURCE)],n)}(K),tn=function(S){function n(A){var E=S.call(this)||this;return E.playing=!1,E.volume=1,E.url=A,E.playing=!0,E}return o(n,S),r([K.readonly],n.prototype,"url",void 0),r([K.field],n.prototype,"playing",void 0),r([K.field],n.prototype,"volume",void 0),r([M("engine.AudioStream",A.CLASS_ID.AUDIO_STREAM)],n)}(K);A.Gizmo=void 0,(Ge=A.Gizmo||(A.Gizmo={})).MOVE="MOVE",Ge.ROTATE="ROTATE",Ge.SCALE="SCALE",Ge.NONE="NONE";var en,nn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.type="gizmoEvent",A}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.gizmoEvent",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),on=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.position=!0,A.rotation=!0,A.scale=!0,A.cycle=!0,A.localReference=!1,A}return o(n,S),r([K.field],n.prototype,"position",void 0),r([K.field],n.prototype,"rotation",void 0),r([K.field],n.prototype,"scale",void 0),r([K.field],n.prototype,"cycle",void 0),r([K.field],n.prototype,"selectedGizmo",void 0),r([K.field],n.prototype,"localReference",void 0),r([M("engine.gizmos",A.CLASS_ID.GIZMOS)],n)}(K),rn=function(S){function n(A){var E=S.call(this,A)||this;return E.type="onFocus",Ke.handlerMap[E.uuid]=E,E}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onFocus",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),sn=function(S){function n(A){var E=S.call(this,A)||this;return E.type="onTextSubmit",Ke.handlerMap[E.uuid]=E,E}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onTextSubmit",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),an=function(S){function n(A){var E=S.call(this,A)||this;return E.type="onBlur",Ke.handlerMap[E.uuid]=E,E}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onBlur",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),un=function(S){function n(A){var E=S.call(this,A)||this;return E.type="onEnter",Ke.handlerMap[E.uuid]=E,E}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onEnter",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),hn=function(S){function n(A){var E=S.call(this,A)||this;return E.type="onChange",Ke.handlerMap[E.uuid]=E,E}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onChange",A.CLASS_ID.UUID_CALLBACK)],n)}(Le),pn=function(S){function n(A,E){var R=S.call(this,A)||this;return R.type="onClick",Ke.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.onClick",A.CLASS_ID.UUID_CALLBACK)],n)}(Me),ln=function(S){function n(A,E){var R=S.call(this,A)||this;return R.type="pointerDown",Ke.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.pointerDown",A.CLASS_ID.UUID_CALLBACK)],n)}(Me),cn=function(S){function n(A,E){var R=S.call(this,A)||this;return R.type="pointerUp",Ke.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,S),r([K.readonly],n.prototype,"type",void 0),r([M("engine.pointerUp",A.CLASS_ID.UUID_CALLBACK)],n)}(Me),dn=function(A){function e(S){var E=A.call(this)||this;return E.name=null,E.visible=!0,E.opacity=1,E.hAlign="center",E.vAlign="center",E.width="100px",E.height="50px",E.positionX="0px",E.positionY="0px",E.isPointerBlocker=!0,S&&(E._parent=S,E.data.parentComponent=D(S)),E}return o(e,A),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([K.field],e.prototype,"name",void 0),r([K.field],e.prototype,"visible",void 0),r([K.field],e.prototype,"opacity",void 0),r([K.field],e.prototype,"hAlign",void 0),r([K.field],e.prototype,"vAlign",void 0),r([K.uiValue],e.prototype,"width",void 0),r([K.uiValue],e.prototype,"height",void 0),r([K.uiValue],e.prototype,"positionX",void 0),r([K.uiValue],e.prototype,"positionY",void 0),r([K.field],e.prototype,"isPointerBlocker",void 0),e}(K),fn=function(S){function n(){return S.call(this,null)||this}return o(n,S),r([F("engine.shape",A.CLASS_ID.UI_FULLSCREEN_SHAPE)],n)}(dn),yn=function(S){function n(){return S.call(this,null)||this}return o(n,S),r([F("engine.shape",A.CLASS_ID.UI_WORLD_SPACE_SHAPE)],n)}(dn),mn=function(S){function n(){return S.call(this,null)||this}return o(n,S),r([F("engine.shape",A.CLASS_ID.UI_SCREEN_SPACE_SHAPE)],n)}(dn),vn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.thickness=0,A.color=Qt.Clear(),A.alignmentUsesSize=!0,A}return o(n,S),r([K.field],n.prototype,"thickness",void 0),r([K.field],n.prototype,"color",void 0),r([K.field],n.prototype,"alignmentUsesSize",void 0),r([F("engine.shape",A.CLASS_ID.UI_CONTAINER_RECT)],n)}(dn);A.UIStackOrientation=void 0,(en=A.UIStackOrientation||(A.UIStackOrientation={}))[en.VERTICAL=0]="VERTICAL",en[en.HORIZONTAL=1]="HORIZONTAL";var bn=function(S){function n(){var E=null!==S&&S.apply(this,arguments)||this;return E.adaptWidth=!0,E.adaptHeight=!0,E.color=Qt.Clear(),E.stackOrientation=A.UIStackOrientation.VERTICAL,E.spacing=0,E}return o(n,S),r([K.field],n.prototype,"adaptWidth",void 0),r([K.field],n.prototype,"adaptHeight",void 0),r([K.field],n.prototype,"color",void 0),r([K.field],n.prototype,"stackOrientation",void 0),r([K.field],n.prototype,"spacing",void 0),r([F("engine.shape",A.CLASS_ID.UI_CONTAINER_STACK)],n)}(dn),xn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.fontSize=10,A.fontWeight="normal",A.thickness=0,A.cornerRadius=0,A.color=Qt.White(),A.background=Qt.White(),A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=Qt.Black(),A.text="button",A}return o(n,S),r([K.field],n.prototype,"fontSize",void 0),r([K.field],n.prototype,"fontWeight",void 0),r([K.field],n.prototype,"thickness",void 0),r([K.field],n.prototype,"cornerRadius",void 0),r([K.field],n.prototype,"color",void 0),r([K.field],n.prototype,"background",void 0),r([K.field],n.prototype,"paddingTop",void 0),r([K.field],n.prototype,"paddingRight",void 0),r([K.field],n.prototype,"paddingBottom",void 0),r([K.field],n.prototype,"paddingLeft",void 0),r([K.field],n.prototype,"shadowBlur",void 0),r([K.field],n.prototype,"shadowOffsetX",void 0),r([K.field],n.prototype,"shadowOffsetY",void 0),r([K.field],n.prototype,"shadowColor",void 0),r([K.field],n.prototype,"text",void 0),r([F("engine.shape",A.CLASS_ID.UI_BUTTON_SHAPE)],n)}(dn),Tn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.outlineWidth=0,A.outlineColor=Qt.White(),A.color=Qt.White(),A.fontSize=10,A.fontAutoSize=!1,A.value="",A.lineSpacing=0,A.lineCount=0,A.adaptWidth=!1,A.adaptHeight=!1,A.textWrapping=!1,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=Qt.Black(),A.hTextAlign="left",A.vTextAlign="bottom",A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A}return o(n,S),r([K.field],n.prototype,"outlineWidth",void 0),r([K.field],n.prototype,"outlineColor",void 0),r([K.field],n.prototype,"color",void 0),r([K.field],n.prototype,"fontSize",void 0),r([K.field],n.prototype,"fontAutoSize",void 0),r([K.component],n.prototype,"font",void 0),r([K.field],n.prototype,"value",void 0),r([K.field],n.prototype,"lineSpacing",void 0),r([K.field],n.prototype,"lineCount",void 0),r([K.field],n.prototype,"adaptWidth",void 0),r([K.field],n.prototype,"adaptHeight",void 0),r([K.field],n.prototype,"textWrapping",void 0),r([K.field],n.prototype,"shadowBlur",void 0),r([K.field],n.prototype,"shadowOffsetX",void 0),r([K.field],n.prototype,"shadowOffsetY",void 0),r([K.field],n.prototype,"shadowColor",void 0),r([K.field],n.prototype,"hTextAlign",void 0),r([K.field],n.prototype,"vTextAlign",void 0),r([K.field],n.prototype,"paddingTop",void 0),r([K.field],n.prototype,"paddingRight",void 0),r([K.field],n.prototype,"paddingBottom",void 0),r([K.field],n.prototype,"paddingLeft",void 0),r([F("engine.shape",A.CLASS_ID.UI_TEXT_SHAPE)],n)}(dn),wn=function(S){function n(A){var E=S.call(this,A)||this;return E.outlineWidth=0,E.outlineColor=Qt.Black(),E.color=Qt.Clear(),E.fontSize=10,E.value="",E.placeholder="",E.margin=10,E.hTextAlign="left",E.vTextAlign="bottom",E.focusedBackground=Qt.Black(),E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=Qt.White(),E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.onTextSubmit=null,E.onChanged=null,E.onFocus=null,E.onBlur=null,E.onTextChanged=new hn((function(A){var S=A.value,R=S.value,I=S.isSubmit,P=E.dirty;if(E.value=R,E.dirty=P,I&&E.onTextSubmit){var O={text:R};E.onTextSubmit.callback(O)}else if(!I&&E.onChanged){var z={value:R,pointerId:A.pointerId};E.onChanged.callback(z)}})),E}return o(n,S),r([K.field],n.prototype,"outlineWidth",void 0),r([K.field],n.prototype,"outlineColor",void 0),r([K.field],n.prototype,"color",void 0),r([K.field],n.prototype,"fontSize",void 0),r([K.component],n.prototype,"font",void 0),r([K.field],n.prototype,"value",void 0),r([K.field],n.prototype,"placeholder",void 0),r([K.field],n.prototype,"margin",void 0),r([K.field],n.prototype,"hTextAlign",void 0),r([K.field],n.prototype,"vTextAlign",void 0),r([K.field],n.prototype,"focusedBackground",void 0),r([K.field],n.prototype,"textWrapping",void 0),r([K.field],n.prototype,"shadowBlur",void 0),r([K.field],n.prototype,"shadowOffsetX",void 0),r([K.field],n.prototype,"shadowOffsetY",void 0),r([K.field],n.prototype,"shadowColor",void 0),r([K.field],n.prototype,"paddingTop",void 0),r([K.field],n.prototype,"paddingRight",void 0),r([K.field],n.prototype,"paddingBottom",void 0),r([K.field],n.prototype,"paddingLeft",void 0),r([Le.uuidEvent],n.prototype,"onTextChanged",void 0),r([Le.uuidEvent],n.prototype,"onFocus",void 0),r([Le.uuidEvent],n.prototype,"onBlur",void 0),r([F("engine.shape",A.CLASS_ID.UI_INPUT_TEXT_SHAPE)],n)}(dn),_n=function(S){function n(A,E){var R=S.call(this,A)||this;return R.sourceLeft=0,R.sourceTop=0,R.sourceWidth=1,R.sourceHeight=1,R.paddingTop=0,R.paddingRight=0,R.paddingBottom=0,R.paddingLeft=0,R.sizeInPixels=!0,R.onClick=null,R.source=E,R}return o(n,S),r([K.field],n.prototype,"sourceLeft",void 0),r([K.field],n.prototype,"sourceTop",void 0),r([K.field],n.prototype,"sourceWidth",void 0),r([K.field],n.prototype,"sourceHeight",void 0),r([K.component],n.prototype,"source",void 0),r([K.field],n.prototype,"paddingTop",void 0),r([K.field],n.prototype,"paddingRight",void 0),r([K.field],n.prototype,"paddingBottom",void 0),r([K.field],n.prototype,"paddingLeft",void 0),r([K.field],n.prototype,"sizeInPixels",void 0),r([Le.uuidEvent],n.prototype,"onClick",void 0),r([F("engine.shape",A.CLASS_ID.UI_IMAGE_SHAPE)],n)}(dn),Cn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.valueX=0,A.valueY=0,A.backgroundColor=Qt.Clear(),A.isHorizontal=!1,A.isVertical=!1,A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.onChanged=null,A}return o(n,S),r([K.field],n.prototype,"valueX",void 0),r([K.field],n.prototype,"valueY",void 0),r([K.field],n.prototype,"backgroundColor",void 0),r([K.field],n.prototype,"isHorizontal",void 0),r([K.field],n.prototype,"isVertical",void 0),r([K.field],n.prototype,"paddingTop",void 0),r([K.field],n.prototype,"paddingRight",void 0),r([K.field],n.prototype,"paddingBottom",void 0),r([K.field],n.prototype,"paddingLeft",void 0),r([Le.uuidEvent],n.prototype,"onChanged",void 0),r([F("engine.shape",A.CLASS_ID.UI_SLIDER_SHAPE)],n)}(dn),An=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.useDummyModel=!1,A.talking=!1,A}var E;return o(n,S),E=n,n.Dummy=function(){var A=new E;return A.useDummyModel=!0,A},r([K.field],n.prototype,"id",void 0),r([K.field],n.prototype,"name",void 0),r([K.field],n.prototype,"expressionTriggerId",void 0),r([K.field],n.prototype,"expressionTriggerTimestamp",void 0),r([K.field],n.prototype,"bodyShape",void 0),r([K.field],n.prototype,"wearables",void 0),r([K.field],n.prototype,"skinColor",void 0),r([K.field],n.prototype,"hairColor",void 0),r([K.field],n.prototype,"eyeColor",void 0),r([K.field],n.prototype,"useDummyModel",void 0),r([K.field],n.prototype,"talking",void 0),E=r([M("engine.avatarShape",A.CLASS_ID.AVATAR_SHAPE)],n)}(K),Sn=null,En=null,Rn=null;function gn(){return Rn||(Rn=new at),Rn}var In=function(){function t(){var A=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!En){(En=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(A){Sn=A}));var A=gn();dcl.subscribe("comms"),dcl.onEvent((function(S){"comms"===S.type&&A.notifyObservers(S.data)}))}return En}().then((function(S){A.connected=!0,A.flush()}))}return t.prototype.on=function(A,S){return gn().add((function(E){try{var R=JSON.parse(E.message);R.message===A&&S(R.payload,E.sender)}catch(E){dcl.error("Error parsing comms message "+(E.message||""),E)}}))},t.prototype.sendRaw=function(A){this.messageQueue.push(A),this.connected&&this.flush()},t.prototype.emit=function(A,S){var E=JSON.stringify({message:A,payload:S});this.sendRaw(E),gn().notifyObservers({message:E,sender:"self"})},t.prototype.flush=function(){var A=this;if(0!==this.messageQueue.length&&this.connected&&Sn&&!this.flushing){var S=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Sn.rpcHandle,"send",[S]).then((function(S){A.flushing=!1,A.flush()}),(function(S){A.flushing=!1,d("Error flushing MessageBus",S)}))}},t}(),Pn=new $("scene");Pn.uuid="0";var On=new et(Pn);F.engine=On,"undefined"!=typeof dcl&&(On.addSystem(new Rt(dcl),1/0),yt(dcl)),On.addSystem(Ke),On.addSystem(Ze),On.addSystem(Qe),A.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",A.Angle=qt,A.AnimationState=se,A.Animator=Ee,A.Arc2=Ft,A.Attachable=S,A.AudioClip=Je,A.AudioSource=$e,A.AudioStream=tn,A.AvatarModifierArea=de,A.AvatarShape=An,A.Axis=jt,A.BasicMaterial=Fe,A.BezierCurve=Xt,A.Billboard=ye,A.BoxShape=me,A.Camera=Ve,A.CircleShape=be,A.Color3=Zt,A.Color4=Qt,A.Component=M,A.ComponentAdded=z,A.ComponentGroup=J,A.ComponentRemoved=O,A.ConeShape=Te,A.Curve3=Jt,A.CylinderShape=we,A.DEG2RAD=Nt,A.DisposableComponent=F,A.DisposableComponentCreated=X,A.DisposableComponentRemoved=Q,A.DisposableComponentUpdated=Z,A.Engine=et,A.Entity=$,A.Epsilon=Mt,A.EventConstructor=x,A.EventManager=I,A.Font=Ie,A.Frustum=ee,A.GLTFShape=_e,A.Gizmos=on,A.GlobalPointerDown=he,A.GlobalPointerUp=pe,A.Input=le,A.Material=De,A.MathTmp=Gt,A.Matrix=Wt,A.MessageBus=In,A.MultiObserver=st,A.NFTShape=Ae,A.OBJShape=Re,A.Observable=at,A.ObservableComponent=K,A.Observer=Y,A.ObserverEventState=rt,A.OnAnimationEnd=ke,A.OnBlur=an,A.OnChanged=hn,A.OnClick=pn,A.OnEnter=un,A.OnFocus=rn,A.OnGizmoEvent=nn,A.OnPointerDown=ln,A.OnPointerLock=Ne,A.OnPointerUUIDEvent=Me,A.OnPointerUp=cn,A.OnTextSubmit=sn,A.OnUUIDEvent=Le,A.ParentChanged=k,A.Path2=ne,A.Path3D=ie,A.PhysicsCast=qe,A.Plane=$t,A.PlaneShape=xe,A.PointerEvent=pt,A.PointerEventComponent=Kt,A.PointerEventSystem=je,A.Quaternion=Ht,A.RAD2DEG=kt,A.RaycastEventSystem=Ye,A.RaycastResponse=ht,A.Scalar=Bt,A.Shape=ge,A.Size=oe,A.SmartItem=Be,A.SphereShape=ve,A.Subscription=te,A.TextShape=Oe,A.Texture=Se,A.ToGammaSpace=Dt,A.ToLinearSpace=Lt,A.Transform=fe,A.UIButton=xn,A.UICanvas=mn,A.UIContainerRect=vn,A.UIContainerStack=bn,A.UIFullScreen=fn,A.UIImage=_n,A.UIInputText=wn,A.UIScrollRect=Cn,A.UIShape=dn,A.UIText=Tn,A.UIValue=U,A.UIWorldSpace=yn,A.UUIDEvent=ut,A.UUIDEventSystem=Xe,A.Vector2=Yt,A.Vector3=Vt,A.Vector4=Ut,A.VideoClip=Ue,A.VideoTexture=He,A._initEventObservables=yt,A.buildArray=v,A.engine=On,A.error=d,A.executeTask=W,A.getComponentClassId=N,A.getComponentId=D,A.getComponentName=L,A.getMessageObserver=gn,A.isDisposableComponent=B,A.log=l,A.newId=f,A.onCameraModeChangedObservable=lt,A.onEnterScene=ft,A.onEnterSceneObservable=dt,A.onIdleStateChangedObservable=ct,A.onLeaveScene=mt,A.onLeaveSceneObservable=gt,A.onPlayerConnectedObservable=_t,A.onPlayerDisconnectedObservable=Ct,A.onPlayerExpressionObservable=bt,A.onPointerLockedStateChange=xt,A.onProfileChanged=wt,A.onRealmChangedObservable=At,A.onSceneReadyObservable=vt,A.onVideoEvent=Tt,A.openExternalURL=function(A){"undefined"!=typeof dcl?dcl.openExternalUrl(A):d("ERROR: openExternalURL dcl is undefined")},A.openNFTDialog=function(A,S){if(void 0===S&&(S=null),"undefined"!=typeof dcl){var E=A.match(/ethereum:\/\/(.+)\/(.+)/);if(!E||E.length<3)return;dcl.openNFTDialog(E[1],E[2],S)}else d("ERROR: openNFTDialog dcl is undefined")},A.pointerEventSystem=Ze,A.raycastEventSystem=Qe,A.teleportTo=function(A){var S;S=[A],void 0===it&&"undefined"!=typeof dcl&&(it=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==it&&"undefined"!=typeof dcl&&it.then((function(A){dcl.callRpc(A.rpcHandle,"requestTeleport",S)}))},A.uuid=y,A.uuidEventSystem=Ke,Object.defineProperty(A,"__esModule",{value:!0})}(this.self=this.self||{}),function(A,S){"object"==typeof exports&&"undefined"!=typeof module?S(exports):"function"==typeof define&&define.amd?define("@dcl/npc-scene-utils",["exports"],S):S((A="undefined"!=typeof globalThis?globalThis:A||self)["@dcl/npc-scene-utils"]={})}(this,(function(A){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(A,S){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,S){A.__proto__=S}||function(A,S){for(var E in S)Object.prototype.hasOwnProperty.call(S,E)&&(A[E]=S[E])})(A,S)};function i(A,S){function o(){this.constructor=A}e(A,S),A.prototype=null===S?Object.create(S):(o.prototype=S.prototype,new o)}function o(A,S,E,R){var I,P=arguments.length,O=P<3?S:null===R?R=Object.getOwnPropertyDescriptor(S,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)O=Reflect.decorate(A,S,E,R);else for(var z=A.length-1;z>=0;z--)(I=A[z])&&(O=(P<3?I(O):P>3?I(S,E,O):I(S,E))||O);return P>3&&O&&Object.defineProperty(S,E,O),O}function n(A){var S="function"==typeof Symbol&&Symbol.iterator,E=S&&A[S],R=0;if(E)return E.call(A);if(A&&"number"==typeof A.length)return{next:function(){return A&&R>=A.length&&(A=void 0),{value:A&&A[R++],done:!A}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}var S=o([Component("trackUserFlag")],(function(A,S,R){this.lockXZRotation=!1,this.active=!1,E||(E=!0,engine.addSystem(new I)),this.lockXZRotation=A||!1,this.rotSpeed=S||2,R&&(this.active=!0)})),E=!1,R=Camera.instance,I=function(){function t(){this.followingNPCs=engine.getComponentGroup(S)}return t.prototype.update=function(A){var E,I;try{for(var P=n(this.followingNPCs.entities),O=P.next();!O.done;O=P.next()){var z=O.value,k=z.getComponent(Transform),U=z.getComponent(S);if(U.active){var H=new Vector3(R.position.x,R.position.y,R.position.z).subtract(k.position);k.rotation=Quaternion.Slerp(k.rotation,Quaternion.LookRotation(H),A*U.rotSpeed),U.lockXZRotation&&(k.rotation.x=0,k.rotation.z=0)}}}catch(A){E={error:A}}finally{try{O&&!O.done&&(I=P.return)&&I.call(P)}finally{if(E)throw E.error}}},t}(),P=new UICanvas;P.visible=!0;var O,z,k=new Font(Fonts.SanFrancisco),U=new Font(Fonts.SanFrancisco_Heavy),H=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),V=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),G=new Texture("https://decentraland.org/images/ui/dialog-bubbles.png");function b(A,S,E,R){void 0===E&&(E=512),void 0===R&&(R=512),function(A,S,E,R,I){A.uvs=[S.x,S.y,E.x,E.y,R.x,R.y,I.x,I.y,S.x,S.y,E.x,E.y,R.x,R.y,I.x,I.y]}(A,new Vector2(S.sourceLeft/E,(R-S.sourceTop-S.sourceHeight)/R),new Vector2((S.sourceLeft+S.sourceWidth)/E,(R-S.sourceTop-S.sourceHeight)/R),new Vector2((S.sourceLeft+S.sourceWidth)/E,(R-S.sourceTop)/R),new Vector2(S.sourceLeft/E,(R-S.sourceTop)/R))}function T(A,S){A.sourceWidth=S.sourceWidth,A.sourceHeight=S.sourceHeight,A.sourceLeft=S.sourceLeft?S.sourceLeft:0,A.sourceTop=S.sourceTop?S.sourceTop:0}function C(A){var S=-10-4*A;return S>-65?S:-65}(O=A.ButtonStyles||(A.ButtonStyles={})).E="e",O.F="f",O.DARK="dark",O.RED="red",O.ROUNDBLACK="roundblack",O.ROUNDWHITE="roundwhite",O.ROUNDSILVER="roundsilver",O.ROUNDGOLD="roundgold",O.SQUAREBLACK="squareblack",O.SQUAREWHITE="squarewhite",O.SQUARESILVER="squaresilver",O.SQUAREGOLD="squaregold",O.WHITE="white",(z=A.NPCState||(A.NPCState={})).STANDING="standing",z.TALKING="talking",z.FOLLOWPATH="followPath";var X,Q={buttons:{buttonE:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonF:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},white:{sourceWidth:174,sourceHeight:46,sourceLeft:698,sourceTop:662},buttonRed:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonDark:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},roundBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},squareBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},roundWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},squareWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},roundSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},squareSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},roundGold:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},squareGold:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567}},buttonLabels:{E:{sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},F:{sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},EBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:766,sourceTop:611},FBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:802,sourceTop:611}},backgrounds:{promptBackground:{sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},promptLargeBackground:{sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},promptSlantedBackground:{sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},NPCDialog:{sourceWidth:766,sourceHeight:248,sourceLeft:22,sourceTop:756}},icons:{closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},checkboxes:{wOff:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},wOn:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},dOff:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},dOn:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},wLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},wLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},dLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},dLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168}},switches:{roundOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},roundRed:{sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},roundGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},squareOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},squareRed:{sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},squareGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501}},bubbles:{short:{sourceWidth:232,sourceHeight:168,sourceLeft:610,sourceTop:834},normal:{sourceWidth:572,sourceHeight:168,sourceLeft:16,sourceTop:834},long:{sourceWidth:994,sourceHeight:306,sourceLeft:12,sourceTop:508},huge:{sourceWidth:994,sourceHeight:478,sourceLeft:12,sourceTop:14}}},Z=function(){function t(S,E){var R=this;J.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=S,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(S){R.onTimeReachedCallback(),S.removeComponent(A)}}var A;return A=t,t.prototype.setCallback=function(A){this.onTimeReachedCallback=A},A=o([Component("npcTimerDelay")],t)}(),K=engine.getComponentGroup(Z),J=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(A){var S,E;try{for(var R=n(K.entities),I=R.next();!I.done;I=R.next()){var P=I.value,O=P.getComponent(Z);O.elapsedTime+=A,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(P)}}catch(A){S={error:A}}finally{try{I&&!I.done&&(E=R.return)&&E.call(R)}finally{if(S)throw S.error}}},t._instance=null,t}();!function(A){A[A.Confirm=0]="Confirm",A[A.Cancel=1]="Cancel",A[A.Next=2]="Next",A[A.Button3=3]="Button3",A[A.Button4=4]="Button4"}(X||(X={}));var $=.75,et=-262.5,nt=262.5,it=37.5,ot=192,rt=192,st=7.5,at=112.5,ut=112.5,ht=-48.75,pt=-48.75,lt=19.5,ct=19.5,dt=function(){function e(S,E,R,I){var O=this;this.NPCScript=[],this.isDialogOpen=!1,this.isQuestionPanel=!1,this.isFixedScreen=!1,this.activeTextId=0,this.UIOpenTime=0,this.defaultSound=null,this.canvas=P,this.ClickAction=null,this.EButtonAction=null,this.FButtonAction=null,this.defaultPortrait=S||null,this.uiTheme=I||(E?V:H),this.container=new UIContainerRect(P),this.container.adaptWidth=!0,this.container.width="100%",this.container.vAlign="bottom",this.container.positionY=105,this.container.visible=!1,this.panel=new UIImage(this.container,this.uiTheme),T(this.panel,Q.backgrounds.NPCDialog),this.panel.width=574.5,this.panel.height=186,this.panel.onClick=new OnClick((function(){O.confirmText(X.Next)})),this.defaultPortraitTexture=new Texture(S?S.path:this.uiTheme.src),this.portrait=new UIImage(this.container,this.defaultPortraitTexture),this.portrait.sourceWidth=S&&S.section?S.section.sourceWidth:256,this.portrait.sourceHeight=S&&S.section?S.section.sourceHeight:256,this.portrait.width=S&&S.width?S.width*$:ot,this.portrait.height=S&&S.height?S.height*$:ot,this.portrait.positionX=S&&S.offsetX?S.offsetX*$+et:et,this.portrait.positionY=S&&S.offsetY?S.offsetY*$+0:0,this.portrait.onClick=new OnClick((function(){O.confirmText(X.Next)})),this.image=new UIImage(this.container,new Texture(this.uiTheme.src)),this.image.sourceWidth=256,this.image.sourceHeight=256,this.image.sourceTop=0,this.image.sourceLeft=0,this.image.width=rt,this.image.height=rt,this.image.positionX=nt,this.image.positionY=it,this.image.onClick=new OnClick((function(){O.confirmText(X.Next)})),this.text=new UIText(this.container),this.text.adaptWidth=!1,this.text.textWrapping=!0,this.text.width=345,this.text.positionX=30,this.text.hAlign="center",this.text.vAlign="center",this.text.font=U,this.text.fontSize=18,this.text.hTextAlign="left",this.text.vTextAlign="center",this.text.positionY=st,this.text.fontWeight="normal",this.text.color=E?Color4.White():Color4.Black(),this.text.isPointerBlocker=!1,this.soundEnt=new Entity,this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(Attachable.AVATAR),R&&(this.soundEnt.addComponent(new AudioSource(new AudioClip(R))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=R),this.button1=new gt(this.container,this.uiTheme,"yes",at,ht,(function(){O.confirmText(X.Confirm)}),!1,A.ButtonStyles.E),this.button1.hide(),this.button2=new gt(this.container,this.uiTheme,"no",-60,pt,(function(){O.confirmText(X.Cancel)}),!1,A.ButtonStyles.F),this.button2.hide(),this.button3=new gt(this.container,this.uiTheme,"maybe",-60,-60,(function(){O.confirmText(X.Button3)}),!1,A.ButtonStyles.DARK),this.button3.hide(),this.button4=new gt(this.container,this.uiTheme,"maybe",ut,-60,(function(){O.confirmText(X.Button4)}),!1,A.ButtonStyles.DARK),this.button4.hide(),this.skipButton=new gt(this.container,this.uiTheme,"Skip",-225,-75,(function(){O.skipDialogs()}),!1,V?A.ButtonStyles.WHITE:A.ButtonStyles.F),this.skipButton.image.width=60,this.skipButton.image.height=22.5,this.skipButton.label.hTextAlign="left",this.skipButton.label.fontSize=9,this.skipButton.label.positionX=30,this.skipButton.label.font=U,this.skipButton.icon.height=15,this.skipButton.icon.width=15,this.skipButton.icon.positionX=-15,this.skipButton.hide(),this.leftClickIcon=new UIImage(this.container,this.uiTheme),this.leftClickIcon.width=24,this.leftClickIcon.height=36,this.leftClickIcon.positionX=255,this.leftClickIcon.positionY=-60,this.leftClickIcon.visible=!1,T(this.leftClickIcon,E?Q.icons.ClickDark:Q.icons.ClickWhite),ft.createAndAddToEngine()}return e.prototype.openDialogWindow=function(A,S){var E=this;this.UIOpenTime=+Date.now(),this.NPCScript=A,this.activeTextId=S?"number"==typeof S?S:F(A,S):0;var R=A[this.activeTextId]?A[this.activeTextId]:{text:""};if(R.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(R.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),R.portrait?(this.portrait.source=new Texture(R.portrait.path),this.portrait.positionX=R.portrait.offsetX?R.portrait.offsetX*$+et:et,this.portrait.positionY=R.portrait.offsetY?R.portrait.offsetY*$+0:0,this.portrait.width=R.portrait.width?R.portrait.width*$:ot,this.portrait.height=R.portrait.height?R.portrait.height*$:ot,R.portrait.section&&T(this.portrait,R.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=this.defaultPortraitTexture,this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*$+et:et,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*$+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*$:ot,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*$:ot,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),R.image){var I=R.image;log("setting image to ",I.path),this.image.source=new Texture(I.path),this.image.positionX=I.offsetX?I.offsetX*$+nt:nt,this.image.positionY=I.offsetY?I.offsetY*$+it:it,this.image.width=I.width?I.width*$:rt,this.portrait.height=I.height?I.height*$:rt,I.section&&T(this.image,I.section),this.image.visible=!0}else this.image.visible=!1;this.text.fontSize=R.fontSize?R.fontSize*$:18,this.text.positionY=R.offsetY?R.offsetY*$+st:st,this.text.positionX=R.offsetX?R.offsetX*$:0,this.text.visible=!0,this.container.visible=!0,ft._instance.newText(this,R.text,this.activeTextId,R.typeSpeed?R.typeSpeed:void 0),this.ClickAction||(this.ClickAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(A){!E.isDialogOpen||+Date.now()-E.UIOpenTime<100||(ft._instance.done?E.isQuestionPanel||E.isFixedScreen||E.confirmText(X.Next):ft._instance.rush())})),this.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(A){E.isDialogOpen&&E.isQuestionPanel&&ft._instance.done&&+Date.now()-E.UIOpenTime>100&&E.confirmText(X.Confirm)})),this.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(A){E.isDialogOpen&&E.isQuestionPanel&&ft._instance.done&&+Date.now()-E.UIOpenTime>100?E.confirmText(X.Cancel):E.isDialogOpen&&R.skipable&&+Date.now()-E.UIOpenTime>100&&E.skipDialogs()}))),this.layoutDialogWindow(this.activeTextId),this.isDialogOpen=!0},e.prototype.confirmText=function(A){var S=this.NPCScript[this.activeTextId];if(A==X.Next&&!S.isQuestion){if(S.triggeredByNext&&S.triggeredByNext(),S.isEndOfDialog)return void this.closeDialogWindow();this.activeTextId++}A==X.Confirm&&S.buttons&&S.buttons.length>=1&&("number"==typeof S.buttons[0].goToDialog?this.activeTextId=S.buttons[0].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[0].goToDialog),S.buttons[0].triggeredActions&&S.buttons[0].triggeredActions()),A==X.Cancel&&S.buttons&&S.buttons.length>=2&&("number"==typeof S.buttons[1].goToDialog?this.activeTextId=S.buttons[1].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[1].goToDialog),S.buttons[1].triggeredActions&&S.buttons[1].triggeredActions()),A==X.Button3&&S.buttons&&S.buttons.length>=3&&("number"==typeof S.buttons[2].goToDialog?this.activeTextId=S.buttons[2].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[2].goToDialog),S.buttons[2].triggeredActions&&S.buttons[2].triggeredActions()),A==X.Button4&&S.buttons&&S.buttons.length>=4&&("number"==typeof S.buttons[3].goToDialog?this.activeTextId=S.buttons[3].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[3].goToDialog),S.buttons[3].triggeredActions&&S.buttons[3].triggeredActions()),S=this.NPCScript[this.activeTextId],ft._instance.newText(this,S.text,this.activeTextId,S.typeSpeed?S.typeSpeed:void 0)},e.prototype.layoutDialogWindow=function(A){var S=this,E=this.NPCScript[A]?this.NPCScript[A]:{text:""},R=E.offsetY?E.offsetY*$+st:st;if(E.buttons&&E.buttons.length>=3?R+=37.5:E.buttons&&E.buttons.length>=1&&(R+=18),this.text.fontSize=E.fontSize?E.fontSize*$:18,this.text.positionY=R,E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),E.portrait?(this.portrait.source=new Texture(E.portrait.path),this.portrait.positionX=E.portrait.offsetX?E.portrait.offsetX*$+et:et,this.portrait.positionY=E.portrait.offsetY?E.portrait.offsetY*$+0:0,this.portrait.width=E.portrait.width?E.portrait.width*$:ot,this.portrait.height=E.portrait.height?E.portrait.height*$:ot,E.portrait.section&&T(this.portrait,E.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=new Texture(this.defaultPortrait.path),this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*$+et:et,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*$+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*$:ot,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*$:ot,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),this.image.visible=!1,E.image){var I=E.image;log("setting image to ",I.path),this.image.source=new Texture(I.path),this.image.positionX=I.offsetX?I.offsetX*$+nt:nt,this.image.positionY=I.offsetY?I.offsetY*$+it:it,this.image.width=E.image.width?E.image.width*$:rt,this.image.height=E.image.height?E.image.height*$:rt,I.section&&T(this.image,I.section),this.image.visible=!0}else this.image.visible=!1;this.isQuestionPanel=!!E.isQuestion&&E.isQuestion,this.isFixedScreen=!!E.isFixedScreen&&E.isFixedScreen,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.leftClickIcon.visible=!1,E.isQuestion?(this.skipButton.hide(),E.buttons&&E.buttons.length>=1&&this.button1.update(E.buttons[0].label,E.buttons[0].offsetX?E.buttons[0].offsetX*$+at:at,E.buttons.length>=3?E.buttons[0].offsetY?E.buttons[0].offsetY*$-15:-15:E.buttons[0].offsetY?E.buttons[0].offsetY*$+ht:ht),E.buttons&&E.buttons.length>=2&&this.button2.update(E.buttons[1].label,E.buttons[1].offsetX*$?E.buttons[1].offsetX*$-60:-60,E.buttons.length>=3?E.buttons[1].offsetY*$?E.buttons[1].offsetY*$-15:-15:E.buttons[1].offsetY*$?E.buttons[1].offsetY*$+pt:pt),E.buttons&&E.buttons.length>=3&&this.button3.update(E.buttons[2].label,E.buttons[2].offsetX*$?E.buttons[2].offsetX*$-60:-60,E.buttons[2].offsetY*$?E.buttons[2].offsetY*$-60:-60),E.buttons&&E.buttons.length>=4&&this.button4.update(E.buttons[3].label,E.buttons[3].offsetX*$?E.buttons[3].offsetX*$+ut:ut,E.buttons[3].offsetY*$?E.buttons[3].offsetY*$-60:-60),mt.addComponentOrReplace(new Z(.7,(function(){E.buttons&&E.buttons.length>=1&&S.button1.show(),E.buttons&&E.buttons.length>=2&&S.button2.show(),E.buttons&&E.buttons.length>=3&&S.button3.show(),E.buttons&&E.buttons.length>=4&&S.button4.show()})))):this.isFixedScreen||(this.leftClickIcon.visible=!0,E.skipable?this.skipButton.show():this.skipButton.hide())},e.prototype.closeDialogWindow=function(){this.isDialogOpen&&(this.isDialogOpen=!1,this.portrait.visible=!1,this.text.value="",this.text.visible=!1,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.skipButton.hide(),this.leftClickIcon.visible=!1,this.container.visible=!1)},e.prototype.skipDialogs=function(){if(this.isDialogOpen&&!(+Date.now()-this.UIOpenTime<100)){for(;this.NPCScript[this.activeTextId]&&this.NPCScript[this.activeTextId].skipable&&!this.NPCScript[this.activeTextId].isQuestion;){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].skipable&&this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}this.confirmText(X.Next)}},e}(),ft=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.UIText=null,this.done=!0,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(A){if(!this.done&&(this.timer+=A,this.timer>=2/this.speed)){var S=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=S,this.closeTag(S),this.visibleChars>=this.fullText.length&&(this.done=!0,this.visibleChars=this.fullText.length),this.UIText&&(this.UIText.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(A,S,E,R){this.timer=0,this.done=!1,this.UIText=A.text,this.fullText=S,this.visibleChars=0,R&&R<=0?this.rush():this.speed=R||45,A.layoutDialogWindow(E)},t.prototype.rush=function(){this.done=!0,this.timer=0,this.visibleChars=this.fullText.length,this.UIText&&(this.UIText.value=this.fullText)},t.prototype.closeTag=function(A){if(0!=this.visibleChars&&0!=A){for(var S=!1,E=!1,R=this.visibleChars-A;R<this.visibleChars;R++)S?">"==this.fullText.substr(R,1)&&(E=!0):"<"==this.fullText.substr(R,1)&&(S=!0);if(S&&!E)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),gt=function(S){function o(E,R,I,P,O,z,U,G){var X=S.call(this)||this;if(X.icon=null,X.image=new UIImage(E,R),X.image.positionX=P,X.image.positionY=O,X.image.width=130.5,X.image.height=34.5,X.label=new UIText(X.image),X.style=G||null,X.onClick=z,X.style)switch(X.style){case A.ButtonStyles.E:T(X.image,Q.buttons.buttonE),X.label.positionX=18.75,X.icon=new UIImage(X.image,1==U?V:H),X.icon.width=lt,X.icon.height=ct,X.icon.hAlign="center",X.icon.vAlign="center",X.icon.isPointerBlocker=!1,T(X.icon,Q.buttonLabels.E),X.icon.positionX=C(I.length);break;case A.ButtonStyles.F:T(X.image,Q.buttons.buttonF),X.label.positionX=18.75,X.icon=new UIImage(X.image,1==U?V:H),X.icon.width=lt,X.icon.height=ct,X.icon.hAlign="center",X.icon.vAlign="center",X.icon.isPointerBlocker=!1,T(X.icon,Q.buttonLabels.F),X.icon.positionX=C(I.length);break;case A.ButtonStyles.WHITE:T(X.image,Q.buttons.white),X.label.positionX=18.75,X.icon=new UIImage(X.image,1==U?V:H),X.icon.width=lt,X.icon.height=ct,X.icon.hAlign="center",X.icon.vAlign="center",X.icon.isPointerBlocker=!1,T(X.icon,Q.buttonLabels.FBlack),X.icon.positionX=C(I.length);break;case A.ButtonStyles.RED:T(X.image,Q.buttons.buttonRed);break;case A.ButtonStyles.DARK:T(X.image,Q.buttons.buttonDark);break;case A.ButtonStyles.ROUNDBLACK:T(X.image,Q.buttons.roundBlack);break;case A.ButtonStyles.ROUNDWHITE:T(X.image,Q.buttons.roundWhite);break;case A.ButtonStyles.ROUNDSILVER:T(X.image,Q.buttons.roundSilver);break;case A.ButtonStyles.ROUNDGOLD:T(X.image,Q.buttons.roundGold);break;case A.ButtonStyles.SQUAREBLACK:T(X.image,Q.buttons.squareBlack);break;case A.ButtonStyles.SQUAREWHITE:T(X.image,Q.buttons.squareWhite);break;case A.ButtonStyles.SQUARESILVER:T(X.image,Q.buttons.squareSilver);break;case A.ButtonStyles.SQUAREGOLD:T(X.image,Q.buttons.squareGold)}else T(X.image,Q.buttons.roundSilver);return X.label.value=I,X.label.hTextAlign="center",X.label.vTextAlign="center",X.label.fontSize=15,X.label.font=k,X.label.color=G==A.ButtonStyles.ROUNDWHITE||G==A.ButtonStyles.SQUAREWHITE||G==A.ButtonStyles.WHITE?Color4.Black():Color4.White(),X.label.isPointerBlocker=!1,X.image.onClick=new OnClick((function(){X.onClick()})),G==A.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(A){X.image.visible&&X.onClick()})):G==A.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(A){X.image.visible&&X.onClick()})),X}return i(o,S),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0},o.prototype.update=function(S,E,R){this.label.value=S,this.image.positionX=E,this.image.positionY=R,!this.icon||this.style!=A.ButtonStyles.E&&this.style!=A.ButtonStyles.F||(this.icon.positionX=C(S.length))},o}(Entity),mt=new Entity;function F(A,S){for(var E=0;E<A.length;E++)if(A[E].name&&A[E].name==S)return E;return 0}engine.addEntity(mt);var vt=function(){function t(){this._triggers={},t._instance=this,this._cameraTriggerWrapper=new xt(new j(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(Tt)}return Object.defineProperty(t,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.setCameraTriggerShape=function(A){this._cameraTriggerWrapper.setShape(A)},t.prototype.update=function(){var A=this,S=this._componentGroup.entities;for(var E in S.forEach((function(S){A.shouldWrapTriggerEntity(S)&&A.wrapTriggerEntity(S)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),t.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),t.removeTriggerFromSystem(R),delete this._triggers[E])}},t.prototype.shouldWrapTriggerEntity=function(A){return null==this._triggers[A.uuid]||null==this._triggers[A.uuid]},t.prototype.wrapTriggerEntity=function(A){this._triggers[A.uuid]=new bt(A)},t.removeTriggerFromSystem=function(A){for(var S,E=A.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(S=t._instance)||void 0===S?void 0:S._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&A.entity&&E[R].trigger.onTriggerExit(A.entity),E[R].disengageActiveCollision(A),A.disengageActiveCollision(E[R])},t.disengageCollision=function(A,S){A.disengageActiveCollision(S),S.disengageActiveCollision(A),A.trigger.onTriggerExit&&S.entity&&A.trigger.onTriggerExit(S.entity),S.trigger.onTriggerExit&&A.entity&&S.trigger.onTriggerExit(A.entity)},t.engageCollision=function(A,S){A.engageCollision(S),S.engageCollision(A),A.trigger.onTriggerEnter&&S.entity&&A.trigger.onTriggerEnter(S.entity),S.trigger.onTriggerEnter&&A.entity&&S.trigger.onTriggerEnter(A.entity)},t.prototype.checkCollisionAgainstCamera=function(A){var S=A.hasActiveCollision(this._cameraTriggerWrapper),E=t.areColliding(A,this._cameraTriggerWrapper);S&&!E?(A.disengageActiveCollision(this._cameraTriggerWrapper),A.trigger.onCameraExit&&A.trigger.onCameraExit()):!S&&E&&(A.engageCollision(this._cameraTriggerWrapper),A.trigger.onCameraEnter&&A.trigger.onCameraEnter())},t.prototype.checkCollisionAgainstOtherTriggers=function(A){for(var S in this._triggers)if(this._triggers.hasOwnProperty(S)&&S!=A.uuid&&this._triggers[S].trigger.enabled&&t.canTriggersCollide(A,this._triggers[S])){var E=A.hasActiveCollision(this._triggers[S]),R=t.areColliding(A,this._triggers[S]);E&&!R?t.disengageCollision(A,this._triggers[S]):!E&&R&&t.engageCollision(A,this._triggers[S])}},t.canTriggersCollide=function(A,S){return 0==A.trigger.triggeredByLayer||0!=(S.trigger.layer&A.trigger.triggeredByLayer)},t.areColliding=function(A,S){return A.getShape()instanceof j&&S.getShape()instanceof j?t.areCollidingAABB(A.getGlobalPosition(),A.getShape(),S.getGlobalPosition(),S.getShape()):A.getShape()instanceof q&&S.getShape()instanceof q?t.areCollidingSphere(A.getGlobalPosition(),A.getShape(),S.getGlobalPosition(),S.getShape()):A.getShape()instanceof j&&S.getShape()instanceof q?t.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),S.getGlobalPosition(),S.getShape()):A.getShape()instanceof q&&S.getShape()instanceof j&&t.areCollidingAABBSphere(S.getGlobalPosition(),S.getShape(),A.getGlobalPosition(),A.getShape())},t.areCollidingAABB=function(A,S,E,R){var I=t.getBoxShapeValues(A,S),P=t.getBoxShapeValues(E,R);return I.min.x<=P.max.x&&I.max.x>=P.min.x&&I.min.y<=P.max.y&&I.max.y>=P.min.y&&I.min.z<=P.max.z&&I.max.z>=P.min.z},t.areCollidingSphere=function(A,S,E,R){return Vector3.DistanceSquared(A.add(S.position),E.add(R.position))<S.radius*S.radius+R.radius*R.radius},t.areCollidingAABBSphere=function(A,S,E,R){var I=t.getBoxShapeValues(A,S),P=E.add(R.position),O=R.radius,z=0;return P.x<I.min.x&&(z+=(I.min.x-P.x)*(I.min.x-P.x)),P.x>I.max.x&&(z+=(P.x-I.max.x)*(P.x-I.max.x)),P.y<I.min.y&&(z+=(I.min.y-P.y)*(I.min.y-P.y)),P.y>I.max.y&&(z+=(P.y-I.max.y)*(P.y-I.max.y)),P.z<I.min.z&&(z+=(I.min.z-P.z)*(I.min.z-P.z)),P.z>I.max.z&&(z+=(P.z-I.max.z)*(P.z-I.max.z)),z<O*O},t.getBoxShapeValues=function(A,S){var E=A.add(S.position);return{center:E,min:E.subtract(S.size.scale(.5)),max:E.add(S.size.scale(.5))}},t._instance=null,t}(),bt=function(){function t(A){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=A,A&&(this._trigger=A.getComponent(Tt),this._uuid=A.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),t.prototype.getGlobalPosition=function(){return this._entity?t.getEntityWorldPosition(this._entity):Vector3.Zero()},t.prototype.getShape=function(){return this._trigger.shape},t.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},t.prototype.getActiveCollisions=function(){var A=[];for(var S in this._collidingWith)this._collidingWith.hasOwnProperty(S)&&A.push(this._collidingWith[S]);return A},t.prototype.hasActiveCollision=function(A){return null!=this._collidingWith[A.uuid]&&null!=this._collidingWith[A.uuid]},t.prototype.disengageActiveCollision=function(A){delete this._collidingWith[A.uuid]},t.prototype.engageCollision=function(A){this._collidingWith[A.uuid]=A},t.prototype.isDebugging=function(){return this._isDebug},t.prototype.addDebugEntity=function(){if(t._debugMaterial||(t._debugMaterial=new Material,t._debugMaterial.alphaTest=.5),null==this._debugEntity){this._debugEntity=new Entity;var A=new Transform;if(this._debugEntity.addComponent(A),this._debugEntity.addComponent(t._debugMaterial),this.getShape()instanceof j&&((S=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(S),A.scale=this.getShape().size),this.getShape()instanceof q){var S;(S=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(S);var E=this.getShape().radius;A.scale=new Vector3(E,E,E)}}engine.addEntity(this._debugEntity)},t.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},t.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},t.getEntityWorldPosition=function(A){var S=A.hasComponent(Transform)?A.getComponent(Transform).position.clone():Vector3.Zero(),E=A.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(S.rotate(R))}return S},t._debugMaterial=null,t}(),xt=function(A){function e(S){var E=A.call(this)||this;return E._shape=S,E._uuid="cameraTrigger",E}return i(e,A),e.prototype.getGlobalPosition=function(){return Camera.instance.position},e.prototype.getShape=function(){return this._shape},e.prototype.setShape=function(A){this._shape=A},e.prototype.isInEngine=function(){return!1},e.prototype.hasActiveCollision=function(A){return!1},e.prototype.disengageActiveCollision=function(A){},e.prototype.engageCollision=function(A){},e.prototype.isDebugging=function(){return!1},e}(bt),Tt=function(){function t(A,S){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,vt.createAndAddToEngine(),this.shape=A,this.layer=S&&S.layer?S.layer:0,this.triggeredByLayer=S&&S.triggeredByLayer?S.triggeredByLayer:0,this.onTriggerEnter=S&&S.onTriggerEnter?S.onTriggerEnter:void 0,this.onTriggerExit=S&&S.onTriggerExit?S.onTriggerExit:void 0,this.onCameraEnter=S&&S.onCameraEnter?S.onCameraEnter:void 0,this.onCameraExit=S&&S.onCameraExit?S.onCameraExit:void 0,this._debugEnabled=!(!S||!S.enableDebug)&&S.enableDebug}return Object.defineProperty(t.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),o([Component("npcTriggerComponent")],t)}(),j=function(A,S){this.size=A,this.position=S},q=function(A,S){this.radius=A,this.position=S},wt=function(){function t(A){this.origin=0,this.target=1,this.fraction=0,this.totalDuration=0,this.speed=[],this.loop=!1,this.path=A,Ct.createAndAddToEngine()}return t.prototype.setIndex=function(A){this.fraction=0,this.origin=A,this.target=A+1<this.path.length?A+1:0},o([Component("npclerpData")],t)}(),_t=[],Ct=function(){function e(){e._instance=this}return e.prototype.update=function(S){var E,R;try{for(var I=n(_t),P=I.next();!P.done;P=I.next()){var O=P.value;if(O.state==A.NPCState.FOLLOWPATH){var z=O.getComponent(Transform),k=O.getComponent(wt);if(k.fraction<1)k.fraction+=S*k.speed[k.origin],z.position=Vector3.Lerp(k.path[k.origin],k.path[k.target],k.fraction);else{if(k.origin=k.target,k.target+=1,k.target>=k.path.length){if(!k.loop)return O.stopWalking(),k.onFinishCallback&&k.onFinishCallback(),void(k.fraction=1);k.target=0}else k.onReachedPointCallback&&k.onReachedPointCallback();k.fraction=0,z.lookAt(k.path[k.target])}}}}catch(A){E={error:A}}finally{try{P&&!P.done&&(R=I.return)&&R.call(I)}finally{if(E)throw E.error}}},e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e._instance=null,e}(),At=100,St=function(){function t(A,S,E){this.NPCScript=[],this.isBubleOpen=!1,this.activeTextId=0,this.defaultSound=null,this.baseYOffset=2.5,this.baseYOffset=S||2.5,this.rootEntity=new Entity,this.rootEntity.addComponent(new Billboard(!1,!0,!1)),this.rootEntity.addComponent(new Transform),this.rootEntity.setParent(A),this.container=new Entity,this.container.addComponent(new Transform({position:new Vector3(-.1,this.baseYOffset,0)})),this.container.setParent(this.rootEntity),this.material=new BasicMaterial,this.material.texture=G,this.panel=new Entity,this.panel.addComponent(new Transform({scale:new Vector3(2,1,1)})),this.panel.setParent(this.container),this.panel.addComponent(new PlaneShape),this.panel.addComponent(this.material),this.panel.getComponent(PlaneShape).visible=!1,b(this.panel.getComponent(PlaneShape),Q.bubbles.normal,1024,1024),this.text=new Entity,this.text.addComponent(new Transform({position:new Vector3(0,0,.05),rotation:Quaternion.Euler(0,180,0)})),this.text.addComponent(new TextShape("")),this.text.setParent(this.container),this.text.getComponent(TextShape).textWrapping=!0,this.text.getComponent(TextShape).font=U,this.text.getComponent(TextShape).hTextAlign="center",this.text.getComponent(TextShape).vTextAlign="center",this.text.getComponent(TextShape).fontSize=1,this.text.getComponent(TextShape).fontWeight="normal",this.text.getComponent(TextShape).color=Color3.Black(),this.text.getComponent(TextShape).visible=!1,this.soundEnt=new Entity,E&&(this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(this.container),this.soundEnt.addComponent(new AudioSource(new AudioClip(E))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=E),Et.createAndAddToEngine()}return t.prototype.openDialogWindow=function(A,S){this.NPCScript=A,this.activeTextId=S?"number"==typeof S?S:function(A,S){for(var E=0;E<A.length;E++)if(A[E].name&&A[E].name==S)return E;return 0}(A,S):0;var E=A[this.activeTextId]?A[this.activeTextId]:{text:""};E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),this.text.getComponent(TextShape).fontSize=E.fontSize?E.fontSize:1,this.text.getComponent(Transform).position.y=E.offsetY?E.offsetY+0:0,this.text.getComponent(Transform).position.x=E.offsetX?E.offsetX:0,this.text.getComponent(TextShape).visible=!0,this.panel.getComponent(PlaneShape).visible=!0,this.text.getComponent(TextShape).value="",E.text.length<At&&E.text.slice(0,At),Et._instance.newText(this,E.text,this.activeTextId,E.timeOn?E.timeOn:void 0,E.typeSpeed?E.typeSpeed:void 0),this.adjustBubble(E.text.length),this.layoutDialogWindow(this.activeTextId),this.isBubleOpen=!0},t.prototype.adjustBubble=function(A){A<8?(b(this.panel.getComponent(PlaneShape),Q.bubbles.short,1024,1024),this.panel.getComponent(Transform).scale.x=.58,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.1,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=.7):A<25?(b(this.panel.getComponent(PlaneShape),Q.bubbles.normal,1024,1024),this.panel.getComponent(Transform).scale.x=1.43,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.5,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=1.5):A<50?(b(this.panel.getComponent(PlaneShape),Q.bubbles.long,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=.765,this.container.getComponent(Transform).position.y=this.baseYOffset+0,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2):(b(this.panel.getComponent(PlaneShape),Q.bubbles.huge,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=1.195,this.container.getComponent(Transform).position.y=this.baseYOffset+.2,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2)},t.prototype.next=function(){var A=this.NPCScript[this.activeTextId];A||(A=this.NPCScript[this.activeTextId-1]),A.triggeredByNext&&A.triggeredByNext(),A.isEndOfDialog?this.closeDialogWindow():(this.activeTextId++,(A=this.NPCScript[this.activeTextId]).text.length<At&&A.text.slice(0,At),this.text.getComponent(TextShape).value="",this.adjustBubble(A.text.length),Et._instance.newText(this,A.text,this.activeTextId,A.timeOn?A.timeOn:void 0,A.typeSpeed?A.typeSpeed:void 0),this.layoutDialogWindow(this.activeTextId))},t.prototype.layoutDialogWindow=function(A){var S=this.NPCScript[A]?this.NPCScript[A]:{text:""},E=S.offsetY?S.offsetY+0:0;S.buttons&&S.buttons.length>=3?E+=50:S.buttons&&S.buttons.length>=1&&(E+=24),this.text.getComponent(TextShape).fontSize=S.fontSize?S.fontSize:1,this.text.getComponent(Transform).position.y=E,S.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(S.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce())},t.prototype.closeDialogWindow=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.closeDialogEndAll=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1,Et._instance.Dialog==this&&(Et._instance.done=!0))},t.prototype.skipDialogs=function(){if(this.isBubleOpen)for(;this.NPCScript[this.activeTextId];){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}},t}(),Et=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.Text=null,this.textId=0,this.done=!0,this.showing=!1,this.timeOn=3,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(A){if(!this.done)if(this.timer+=A,this.showing)this.timer>this.timeOn&&(this.showing=!1,this.done=!0,this.timer=0,this.window.next());else if(this.timer>=2/this.speed){var S=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=S,this.closeTag(S),this.visibleChars>=this.fullText.length&&(this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length),this.Text&&(this.Text.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(A,S,E,R,I){if(A!=this.Dialog||E!=this.textId){var P=this.Dialog;this.Dialog=A,this.Text=this.Dialog.text.getComponent(TextShape),this.textId=E,P&&A!=P&&P.skipDialogs(),this.timer=0,this.done=!1,this.showing=!1,this.fullText=S,this.visibleChars=0,this.window=A,I&&I<=0?this.rush():this.speed=I||45,this.timeOn=R||3}},t.prototype.rush=function(){this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length,this.Text&&(this.Text.value=this.fullText)},t.prototype.closeTag=function(A){if(0!=this.visibleChars&&0!=A){for(var S=!1,E=!1,R=this.visibleChars-A;R<this.visibleChars;R++)S?">"==this.fullText.substr(R,1)&&(E=!0):"<"==this.fullText.substr(R,1)&&(S=!0);if(S&&!E)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Rt=function(E){function o(R,I,P,O){var z=E.call(this)||this;z.introduced=!1,z.onWalkAway=null,z.inCooldown=!1,z.coolDownDuration=5,z.faceUser=!1,z.walkingAnim=null,z.walkingSpeed=2,z.bubbleHeight=2,z.addComponent(new GLTFShape(I)),z.addComponent(new Transform(R)),engine.addEntity(z),z.state=A.NPCState.STANDING,O&&O.noUI||(O&&O.portrait?z.dialog=new dt("string"==typeof O.portrait?{path:O.portrait}:O.portrait,!(!O||!O.darkUI)&&O.darkUI,O.dialogSound?O.dialogSound:void 0):z.dialog=new dt(void 0,!(!O||!O.darkUI)&&O.darkUI,O&&O.dialogSound?O.dialogSound:void 0)),O&&O.textBubble&&(O&&O.bubbleHeight&&(z.bubbleHeight=O.bubbleHeight),z.bubble=new St(z,z.bubbleHeight,O.dialogSound?O.dialogSound:void 0)),z.addComponent(new Animator),z.idleAnim=new AnimationState(O&&O.idleAnim?O.idleAnim:"Idle",{looping:!0}),z.getComponent(Animator).addClip(z.idleAnim),z.lastPlayedAnim=z.idleAnim,z.idleAnim.play(),O&&O.walkingAnim&&(z.walkingAnim=new AnimationState(O.walkingAnim,{looping:!0}),z.getComponent(Animator).addClip(z.walkingAnim)),z.onActivate=P,O&&O.onWalkAway&&(z.onWalkAway=O.onWalkAway),z.endAnimTimer=new Entity,engine.addEntity(z.endAnimTimer),z.closeDialogTimer=new Entity,engine.addEntity(z.closeDialogTimer),z.pauseWalkingTimer=new Entity,engine.addEntity(z.pauseWalkingTimer);var k=O&&O.onlyClickTrigger?ActionButton.POINTER:ActionButton.PRIMARY;z.addComponent(new OnPointerDown((function(A){z.inCooldown||z.dialog&&z.dialog.isDialogOpen||z.activate()}),{button:k,hoverText:O&&O.hoverText?O.hoverText:"Talk",showFeedback:!O||!O.onlyExternalTrigger})),O&&O.onlyExternalTrigger&&z.removeComponent(OnPointerDown);var U={};return(!O||O&&!O.continueOnWalkAway)&&(U.onCameraExit=function(){z.handleWalkAway()}),O&&(!O||O.onlyExternalTrigger||O.onlyClickTrigger||O.onlyETrigger)||(U.onCameraEnter=function(){z.inCooldown?log(z.name," in cooldown"):z.dialog&&z.dialog.isDialogOpen||O&&O.onlyExternalTrigger||O&&O.onlyClickTrigger||z.activate()}),(U.onCameraEnter||U.onCameraExit)&&z.addComponent(new Tt(new q(O&&O.reactDistance?O.reactDistance:6,Vector3.Zero()),U)),O&&O.faceUser&&(z.addComponent(new S(!0,O.turningSpeed?O.turningSpeed:void 0)),z.faceUser=!0),O&&O.walkingSpeed&&(z.walkingSpeed=O.walkingSpeed),O&&O.coolDownDuration&&(z.coolDownDuration=O.coolDownDuration),O&&O.path&&(z.addComponent(new wt(O.path?O.path:[])),z.getComponent(wt).loop=!0,_t.push(z),z.followPath()),z}return i(o,E),o.prototype.activate=function(){var A=this;this.faceUser&&(this.getComponent(S).active=!0),this.inCooldown=!0,this.addComponentOrReplace(new Z(this.coolDownDuration,(function(){A.inCooldown=!1}))),this.onActivate()},o.prototype.endInteraction=function(){this.faceUser&&(this.getComponent(S).active=!1),this.dialog&&this.dialog.isDialogOpen&&this.dialog.closeDialogWindow(),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.state=A.NPCState.STANDING},o.prototype.handleWalkAway=function(){this.state!=A.NPCState.FOLLOWPATH&&(this.endInteraction(),this.onWalkAway&&this.onWalkAway())},o.prototype.talk=function(S,E,R){var I=this;this.introduced=!0,this.state=A.NPCState.TALKING,this.closeDialogTimer.hasComponent(Z)&&this.closeDialogTimer.removeComponent(Z),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.dialog.openDialogWindow(S,E||0),R&&this.closeDialogTimer.addComponentOrReplace(new Z(R,(function(){I.dialog.closeDialogWindow()})))},o.prototype.talkBubble=function(A,S){this.bubble||(this.bubble=new St(this,this.bubbleHeight)),this.bubble.openDialogWindow(A,S||0)},o.prototype.playAnimation=function(A,S,E){var R=this;this.lastPlayedAnim.stop(),this.endAnimTimer.hasComponent(Z)&&this.endAnimTimer.removeComponent(Z);var I=this.getComponent(Animator).getClip(A);S&&(I.looping=!1,E&&this.endAnimTimer.addComponentOrReplace(new Z(E,(function(){I.stop(),R.idleAnim&&(R.idleAnim.play(),R.lastPlayedAnim=R.idleAnim)})))),I.stop(),I.play(),this.lastPlayedAnim=I},o.prototype.changeIdleAnim=function(A,S){this.idleAnim.stop(),this.idleAnim=new AnimationState(A,{looping:!0}),this.getComponent(Animator).addClip(this.idleAnim),S&&(this.lastPlayedAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim)},o.prototype.followPath=function(E){if(!this.hasComponent(wt)){if(!E)return;this.addComponent(new wt(E.path?E.path:[])),_t.push(this)}this.faceUser&&(this.getComponent(S).active=!1);var R=this.getComponent(wt);if(E){if(E.path)if(E.curve){var I=Curve3.CreateCatmullRomSpline(E.path,4*E.path.length,!!E.loop).getPoints();E.loop&&I.pop(),R.path=I}else R.path=E.path;null!=E.loop&&(R.loop=E.loop),null!=E.startingPoint&&R.setIndex(E.startingPoint),E.onFinishCallback&&(R.onFinishCallback=E.onFinishCallback),E.onReachedPointCallback&&(R.onReachedPointCallback=E.onReachedPointCallback)}var P=this.getComponent(Transform).position;(0==R.fraction&&R.path[R.origin].subtract(P).lengthSquared()>.1||R.fraction>0&&P.subtract(R.path[R.origin]).normalize()==R.path[R.target].subtract(R.path[R.origin]).normalize())&&(R.path.splice(R.origin,0,this.getComponent(Transform).position),R.fraction=0),this.getComponent(Transform).lookAt(R.path[R.target]);for(var O=0,z=[],k=0;k<R.path.length-1;k++){var U;O+=U=Vector3.Distance(R.path[k],R.path[k+1]),z.push(U)}for(R.loop&&(O+=U=Vector3.Distance(R.path[R.path.length-1],R.path[0]),z.push(U)),E&&E.totalDuration?R.totalDuration=E.totalDuration:E&&E.speed?R.totalDuration=O/E.speed:R.totalDuration||(R.totalDuration=O/this.walkingSpeed),R.speed=[],k=0;k<z.length;k++)R.speed.push(1/(z[k]/O*R.totalDuration));this.walkingAnim&&(this.endAnimTimer.hasComponent(Z)&&this.endAnimTimer.removeComponent(Z),this.idleAnim.stop(),this.lastPlayedAnim.stop(),this.walkingAnim.play(),this.lastPlayedAnim=this.walkingAnim),this.state=A.NPCState.FOLLOWPATH},o.prototype.stopWalking=function(S){var E=this;this.state=A.NPCState.STANDING,this.walkingAnim&&(this.walkingAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim),S&&this.pauseWalkingTimer.addComponentOrReplace(new Z(S,(function(){E.dialog&&E.dialog.isDialogOpen||(E.lastPlayedAnim.stop(),E.walkingAnim&&(E.walkingAnim.play(),E.lastPlayedAnim=E.walkingAnim),E.endAnimTimer.hasComponent(Z)&&E.endAnimTimer.removeComponent(Z),E.state=A.NPCState.FOLLOWPATH)})))},o}(Entity);A.CustomDialogButton=gt,A.DialogTypeInSystem=ft,A.DialogWindow=dt,A.NPC=Rt,A.NPCDelay=Z,A.NPCLerpData=wt,A.NPCTriggerComponent=Tt,A.SFFont=k,A.SFHeavyFont=U,A.TrackUserFlag=S,A.TriggerBoxShape=j,A.TriggerSphereShape=q,A.canvas=P,A.darkTheme=V,A.lightTheme=H,Object.defineProperty(A,"__esModule",{value:!0})}));var __awaiter=this&&this.__awaiter||function(A,S,E,R){return new(E||(E=Promise))((function(I,P){function fulfilled(A){try{step(R.next(A))}catch(A){P(A)}}function rejected(A){try{step(R.throw(A))}catch(A){P(A)}}function step(A){var S;A.done?I(A.value):(S=A.value,S instanceof E?S:new E((function(A){A(S)}))).then(fulfilled,rejected)}step((R=R.apply(A,S||[])).next())}))},__generator=this&&this.__generator||function(A,S){var E,R,I,P,O={label:0,sent:function(){if(1&I[0])throw I[1];return I[1]},trys:[],ops:[]};return P={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(P[Symbol.iterator]=function(){return this}),P;function verb(P){return function(z){return function(P){if(E)throw new TypeError("Generator is already executing.");for(;O;)try{if(E=1,R&&(I=2&P[0]?R.return:P[0]?R.throw||((I=R.return)&&I.call(R),0):R.next)&&!(I=I.call(R,P[1])).done)return I;switch(R=0,I&&(P=[2&P[0],I.value]),P[0]){case 0:case 1:I=P;break;case 4:return O.label++,{value:P[1],done:!1};case 5:O.label++,R=P[1],P=[0];continue;case 7:P=O.ops.pop(),O.trys.pop();continue;default:if(!((I=(I=O.trys).length>0&&I[I.length-1])||6!==P[0]&&2!==P[0])){O=0;continue}if(3===P[0]&&(!I||P[1]>I[0]&&P[1]<I[3])){O.label=P[1];break}if(6===P[0]&&O.label<I[1]){O.label=I[1],I=P;break}if(I&&O.label<I[2]){O.label=I[2],O.ops.push(P);break}I[2]&&O.ops.pop(),O.trys.pop();continue}P=S.call(A,O)}catch(A){P=[6,A],R=0}finally{E=I=0}if(5&P[0])throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}([P,z])}}};define("game",["require","exports","@dcl/npc-scene-utils"],(function(A,S,E){Object.defineProperty(S,"__esModule",{value:!0}),S.ILoveCats=S.myNPC=S.myNPC_A=void 0;var R=new UICanvas,I=new UIInputText(R);I.width="80%",I.height="25px",I.vAlign="bottom",I.hAlign="center",I.fontSize=10,I.placeholder="Write message here",I.positionY="200px",I.isPointerBlocker=!0,I.visible=!1,I.onTextSubmit=new OnTextSubmit((function(A){executeTask((function(){return __awaiter(void 0,void 0,void 0,(function(){var E;return __generator(this,(function(R){switch(R.label){case 0:I.visible=!1,R.label=1;case 1:return R.trys.push([1,4,,5]),[4,fetch(A.text.trim())];case 2:return[4,R.sent().json()];case 3:return E=R.sent(),log(E),function(A){S.ILoveCats=[];for(var _loop_1=function(E){var R=A.episodes[0].story[E].voice.split(",")[1],I=U[R].name,P=U[U[R].other].npc;if("story"==A.episodes[0].story[E].type){var O=getDataFrom(A,A.episodes[0].story[E].id,0);S.ILoveCats.push({text:I+": "+O.text,name:A.episodes[0].story[E].id,triggeredByNext:function(){S.myNPC.playAnimation("Idle"),S.myNPC_A.playAnimation("Idle");var R=getDataFrom(A,A.episodes[0].story[E+1].id,0);"raise_golfclub"==R.action?R.npc.playAnimation("Hello"):R.npc.playAnimation("Talk")}})}else if("simple"==A.episodes[0].story[E].type){var z=A.episodes[0].story[E].id+"yes",k=A.episodes[0].story[E].id+"no";S.ILoveCats.push({text:I+": "+A.episodes[0].story[E].content[0],name:A.episodes[0].story[E].id,isQuestion:!0,buttons:[{label:"Yes",goToDialog:z},{label:"No",goToDialog:k}]}),S.ILoveCats.push({text:I+": "+A.episodes[0].story[E].content[1],name:z,triggeredByNext:function(){S.myNPC.talk(S.ILoveCats,k),S.myNPC.playAnimation("Idle"),S.myNPC_A.playAnimation("Idle"),P.playAnimation("Talk")}}),S.ILoveCats.push({text:I+": "+A.episodes[0].story[E].content[2],name:k,triggeredByNext:function(){S.myNPC.talk(S.ILoveCats,k),S.myNPC.playAnimation("Idle"),S.myNPC_A.playAnimation("Idle"),P.playAnimation("Talk")}})}},E=0;E<A.episodes[0].story.length;E++)_loop_1(E);S.ILoveCats[S.ILoveCats.length-1].isEndOfDialog=!0}(E),[3,5];case 4:return R.sent(),log("failed to reach URL"),[3,5];case 5:return[2]}}))}))}))}));var P=new Entity;P.addComponent(new BoxShape),P.addComponent(new Transform({position:new Vector3(10,2,-10)})),P.addComponent(new OnPointerDown((function(A){I.visible=!0}))),engine.addEntity(P),S.myNPC_A=new E.NPC({position:new Vector3(10,1.5,8)},"models/bela.glb",(function(){}),{faceUser:!0,idleAnim:"Idle"});var O=new Transform({position:new Vector3(0,.7,0),rotation:Quaternion.Euler(0,180,0),scale:new Vector3(.35,.35,.35)}),z=new Entity;z.addComponent(new TextShape("Mickey")),z.addComponent(O),z.setParent(S.myNPC_A),S.myNPC=new E.NPC({position:new Vector3(10,1.5,10)},"models/alice.glb",(function(){S.myNPC.talk(S.ILoveCats,0)}),{faceUser:!0,idleAnim:"Hello"});var k=new Entity;k.addComponent(new TextShape("Arnold")),k.addComponent(O),k.setParent(S.myNPC),S.ILoveCats=[];var U={Matthew:{name:"Arnold",npc:S.myNPC,other:"Joanna"},Joanna:{name:"Mickey",npc:S.myNPC_A,other:"Matthew"},Brian:{name:"Scamjack",npc:S.myNPC,other:"Joanna"}};function getDataFrom(A,E,R){void 0===R&&(R=0);for(var I={npc:S.myNPC,action:"",text:""},P=0;P<A.episodes[0].story.length;P++)if(A.episodes[0].story[P].id==E){var O=""+A.episodes[0].story[P].content[R],z=""+O;O=(O=(O=(O=O.replace(/\\raise_golfclub/g,"")).replace(/\\goto_training_leaderboard/g,"")).replace(/\\goto_training_board/g,"")).replace(/\\goto_level_board/g,""),-1!==z.indexOf("\\raise_golfclub")?I.action="raise_golfclub":-1!==z.indexOf("\\goto_training_leaderboard")?I.action="goto_training_leaderboard":-1!==z.indexOf("\\goto_training_board")?I.action="goto_training_board":-1!==z.indexOf("\\goto_level_board")&&(I.action="goto_level_board");var k=A.episodes[0].story[P].voice.split(",")[1];I.npc=U[k].npc,I.text=O;break}return I}}));